
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{compozition}[2026/02/22 v2.0.0 drawing macros]





\RequirePackage{tikz}




\RequirePackage{etoolbox} % \ifstrequal alternative to \iftheneles and provides \newrobustcmd. % I think I never used this package - should check.


\usetikzlibrary{patterns}



\RequirePackage{stackengine}\stackMath


\RequirePackage{xspace}

\RequirePackage{mathtools} % for \prescript command for pre subscripts and superscripts


\RequirePackage{xstring}

% \pgfmathdeclarefunction{ifthenelsefpu}{3}{ %}
%   \pgfmathparse{#1*#2 + !#1*#3} %
% }



%% This is a small set of commands for drawing graphs with circles and squares and joining lines.
%The default font is mathsf.

%% The commands are based on Tikz.  The z in compozition is hommage to tikz.

%% compozition.sty
  %% Copyright 2013 Lucien Hardy
  %
  % This work may be distributed and/or modified under the
  % conditions of the LaTeX Project Public License, either version 1.3
  % of this license or (at your option) any later version.
  % The latest version of this license is in
  %   http://www.latex-project.org/lppl.txt
  % and version 1.3 or later is part of all distributions of LaTeX
  % version 2005/12/01 or later.
  % This work consists of the files compozition.sty

%% This file has been updated multiple times since 2013.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%% Tikz Packages %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\usetikzlibrary{calc}
\usetikzlibrary{arrows}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{decorations.markings}
\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{patterns.meta}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%      arrows of various sorts         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%standard arrows


\tikzset{->-/.style={decoration={
  markings,
  mark=at position #1 with {\arrow{>}}},postaction={decorate}}}

%\usetikzlibrary{decorations.markings}
\tikzset{-<-/.style={decoration={
  markings,
  mark=at position #1 with {\arrow{<}}},postaction={decorate}}}
%%%%%%

\tikzset{-left-/.style={decoration={
  markings,
  mark=at position #1 with {\arrow{left to}}},postaction={decorate}}}

\tikzset{-right-/.style={decoration={
  markings,
  mark=at position #1 with {\arrow{right to}}},postaction={decorate}}}

%black square arrow on left (right) side of line.

\tikzset{-leftl-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\filldraw[black] (-1.5pt, 0pt) rectangle (1.5pt, 1.5pt);
\path (0,8pt) coordinate (fontlocationbw);   \path (0,-8pt) coordinate (fontlocationbwunder);
}},
postaction={decorate}}}


\tikzset{-rightl-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\filldraw[black] (-1.5pt, 0pt) rectangle (1.5pt, -1.5pt);
\path (0,8pt) coordinate (fontlocationbw);   \path (0,-8pt) coordinate (fontlocationbwunder);
}},
postaction={decorate}}}


% black and white triangle arrows Under construction
\tikzset{-triangleblack-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\filldraw[black] (-2pt, 1.8pt) -- (-2pt, -1.8pt) -- (2pt, 0) -- cycle; \path
(0,8pt) coordinate (fontlocationbw);   \path (0,-8pt) coordinate
(fontlocationbwunder); }}, postaction={decorate}}}

\tikzset{-trianglewhite-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\draw[fill=white] (-2pt, 1.8pt) -- (-2pt, -1.8pt) -- (2pt, 0) -- cycle; \path
(0,8pt) coordinate (fontlocationbw);   \path (0,-8pt) coordinate
(fontlocationbwunder); }}, postaction={decorate}}}

\tikzset{-triangleblackR-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\filldraw[black] (2pt, 1.8pt) -- (2pt, -1.8pt) -- (-2pt, 0) -- cycle; \path
(0,8pt) coordinate (fontlocationbw);   \path (0,-8pt) coordinate
(fontlocationbwunder); }}, postaction={decorate}}}

\tikzset{-trianglewhiteR-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\draw[fill=white] (2pt, 1.8pt) -- (2pt, -1.8pt) -- (-2pt, 0) -- cycle; \path
(0,8pt) coordinate (fontlocationbw);   \path (0,-8pt) coordinate
(fontlocationbwunder); }}, postaction={decorate}}}



%black and white squares on left (right) of line for arrow.

\tikzset{-leftlbw-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\filldraw[black] (-1.5pt, 0pt) rectangle (0pt, 1.5pt);
\draw[thin] (1.5pt, 0pt) rectangle (0pt, 1.5pt);
\path (0,8pt) coordinate (fontlocationbw);   \path (0,-8pt) coordinate (fontlocationbwunder);
}},
postaction={decorate}}}


\tikzset{-rightlbw-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\filldraw[black] (-1.5pt, 0pt) rectangle (0pt, -1.5pt);
\draw[thin] (1.5pt, 0pt) rectangle (0pt, -1.5pt);
\path (0,8pt) coordinate (fontlocationbw);   \path (0,-8pt) coordinate (fontlocationbwunder);
}},
postaction={decorate}}}



%square "arrow" heads


\tikzset{-bsq/.style={decoration={
  markings,
  mark=at position #1 with
  {
\filldraw[black] (-1.8pt, -1.8pt) rectangle (1.8pt, 1.8pt);
}},
postaction={decorate}}}

\tikzset{-wsq/.style={decoration={
  markings,
  mark=at position #1 with
  {
\filldraw[white] (-1.8pt, -1.8pt) rectangle (1.8pt, 1.8pt);
\draw[thin] (-1.8pt, -1.8pt) rectangle (1.8pt, 1.8pt);
}},
postaction={decorate}}}

\tikzset{-bsqw-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\filldraw[white] (-0.8pt,-1.3pt) rectangle (+0.8pt, 1.3pt); \filldraw[black] (-3.4pt, -1.3pt) rectangle (-0.8pt, 1.3pt);\filldraw[white] (0.8pt, 1.3pt) rectangle (3.4pt,-1.3pt);
\draw (0.8pt, 1.3pt) rectangle (3.4pt,-1.3pt);
\path (0,8pt) coordinate (fontlocationbw);   \path (0,-8pt) coordinate (fontlocationbwunder);
}},
postaction={decorate}}}



\tikzset{-wsqb-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\filldraw[white] (-0.8pt,-1.3pt) rectangle (+0.8pt, 1.3pt); \filldraw[white] (-3.4pt, -1.3pt) rectangle (-0.8pt, 1.3pt); \draw (-3.4pt, -1.3pt) rectangle (-0.8pt, 1.3pt);
\filldraw[black] (0.8pt, 1.3pt) rectangle (3.4pt,-1.3pt);
\path (0,8pt) coordinate (fontlocationwb);  \path (0,-8pt) coordinate (fontlocationwbunder);
}},
postaction={decorate}}}




% circle arrow heads.


\tikzset{-bcir/.style={decoration={
  markings,
  mark=at position #1 with
  {
\filldraw[black] (0pt, 0pt) circle (2pt);
}},
postaction={decorate}}}

\tikzset{-wcir/.style={decoration={
  markings,
  mark=at position #1 with
  {
\filldraw[white] (0pt, 0pt) circle (2pt);
\draw[thin] (0pt, 0pt) circle (2pt);
}},
postaction={decorate}}}




%\usetikzlibrary{decorations.markings}
\tikzset{-*o-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\draw[ultra thick, draw=white] (-2.3pt, 0pt) -- (2.3pt,0pt);
\filldraw[black] (-2.3pt, 0pt) circle (1.85pt);
\filldraw[white] (+2.3pt, 0pt) circle (1.85pt);
\draw (+2.3pt, 0pt) circle (1.85pt);
\path (0,8pt) coordinate (fontlocationbw);   \path (0,-8pt) coordinate (fontlocationbwunder);
}},
postaction={decorate}}}

%\usetikzlibrary{decorations.markings}
\tikzset{-o*-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\draw[ultra thick, draw=white] (-2.3pt, 0pt) -- (2.3pt,0pt);
\filldraw[white] (-2.3pt, 0pt) circle (1.85pt);\draw (-2.3pt, 0pt) circle (1.85pt);
\filldraw[black] (+2.3pt, 0pt) circle (1.85pt);
\path (0,8pt) coordinate (fontlocationwb);   \path (0,-8pt) coordinate (fontlocationwbunder);
}},
postaction={decorate}}}

% this is the fusion decoration for \joinccfusion
\tikzset{-oWo-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\draw[ultra thick, draw=white] (-6pt, 0pt) -- (6pt,0pt);
\draw[ultra thin, decorate, decoration={snake,amplitude=0.4mm,segment length=0.57mm}] (-3pt, 0pt) -- (3pt,0pt);
\filldraw[white] (-6pt, 0pt) circle (3pt);  \draw (-6pt, 0pt) circle (3pt);
\filldraw[white] (+6pt, 0pt) circle (3pt);  \draw (+6pt, 0pt) circle (3pt);
\path (0,8pt) coordinate (fontlocationwb);   \path (0,-8pt) coordinate (fontlocationwbunder);
}},
postaction={decorate}}}


%% haven't used the -o*-*o- decoration below - can probably get rid of it. Also, now it has the wrong size circles and spacing.

%\usetikzlibrary{decorations.markings}
\tikzset{-o*-*o-/.style={decoration={
  markings, mark=at position #1 with
  {
\draw[ultra thick, draw=white] (-13pt, 0pt) -- (-7pt,0pt);
\filldraw[white] (-13pt, 0pt) circle (0.077);
\draw (-13pt, 0pt) circle (0.077);
\filldraw[black] (-7pt, 0pt) circle (0.077);
\draw[ultra thick, draw=white] (7pt, 0pt) -- (13pt,0pt);
\filldraw[black] (7pt, 0pt) circle (0.077);
\filldraw[white] (13pt, 0pt) circle (0.077);
\draw (13pt, 0pt) circle (0.077);
}},
postaction={decorate}}}



% under constuction 4Nov2024.
\tikzset{-wdiamond-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\draw[thin] +(-3pt,0) -- +(0,2.6pt) -- +(3pt,0) -- +(0,-2.6pt) -- cycle;
%\draw[thin] +(-3.4pt,0) -- +(0,3pt) -- +(3.4pt,0) -- +(0,-3pt) -- cycle;
}},
postaction={decorate}}}


\tikzset{-xarrow-/.style={decoration={
  markings,
  mark=at position #1 with
  {
\draw +(-3pt,-2.6pt) -- + (3pt,2.6pt);
\draw +(-3pt,2.6pt) -- + (3pt,-2.6pt);
%\draw +(-3.4pt,-3pt) -- + (3.4pt,3pt);
%\draw +(-3.4pt,3pt) -- + (3.4pt,-3pt);
}},
postaction={decorate}}}




%%%% to fine tune from above type commands.
\usetikzlibrary{positioning}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%% wavy line%%%%%%%%% might want this
%\tikzset{snake it/.style={decorate, decoration=snake}}






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%% FONT COMMANDS  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\defaultfont}{\mathsf}

\newcommand{\secondfont}{ {} }

\newcommand{\thirdfont}{ {} }

\newcommand{\fourthfont}{ {} }

\newcommand{\fifthfont}{ {} }

% These commands can be used to change the fonts used.

\newcommand{\setdefaultfont}[1]{\renewcommand{\defaultfont}{#1}}

\newcommand{\setsecondfont}[1]{\renewcommand{\secondfont}{#1}}

\newcommand{\setthirdfont}[1]{\renewcommand{\thirdfont}{#1}}

\newcommand{\setfourthfont}[1]{\renewcommand{\fourthfont}{#1}}

\newcommand{\setfifthfont}[1]{\renewcommand{\fifthfont}{#1}}

\newcommand{\defaultarrow}{stealth}

\newcommand{\setdefaultarrow}[1]{\renewcommand{\defaultarrow}{#1}}

%% I have defined arrowheadA and arrowheadB much later to provide additional arrowhead options in same diagram.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%% ENVIRONMENTS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% compose environment  \begin{compose}[scale] optional argument is scale. Default is 1=0.25cm

\newenvironment{compose}[1][1]{\begin{tikzpicture}[scale=#1*0.25, >=\defaultarrow]
\path (0,0) coordinate (XYshift); }{\end{tikzpicture}}


% Compose environment \begin{Compose}[scale]{Xshift}{voffset}  has a verticle offset and a horizontal shift
% note added 1st June 2024 - the horizontal shift seems to compose badly with relpoint. Also with
%\crectangledleft[-1].... (the little square dot does not stay in position).  The vertical shift works fine.

\newenvironment{Compose}[3][1]{\begin{tikzpicture}
[scale=#1*0.25, baseline=-5-#3cm, >=\defaultarrow]
\path (0,0)+(#2*4/#1,0) coordinate (XYshift);}{\end{tikzpicture}}


\newcommand{\bcomp}{\begin{compose}}
\newcommand{\ecomp}{\end{compose}}


\newcommand{\bComp}[1][0]{\begin{Compose}{0}{#1}}
\newcommand{\eComp}{\end{Compose}}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%% OBJECTS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% define circle, rectangle, other shapes.


\newcommand{\arectangle}[2]{ +(-#1, -#2) rectangle + (+#1,+#2) }

\newcommand{\adiamond}[2]{ +(-#1,0) -- +(0,#2) -- +(#1,0) -- +(0,-#2) -- cycle }

\newcommand{\arightcutdiamond}[2]{ +(-#1,0) -- +(#1/3,#2) -- +(#1,#2/2) -- +(#1,-#2/2) --+(#1/3,-#2) -- cycle }

\newcommand{\aleftcutdiamond}[2]{ +(#1,0) -- +(-#1/3,#2) -- +(-#1,#2/2) -- +(-#1,-#2/2) --+(-#1/3,-#2) -- cycle }

\newcommand{\atriangle}[2]{ +(-#1,-#2) -- +(#1,-#2) -- +(-#1,#2) -- cycle }

% an income is a rectangle but with a semicircle on the left.  An outcome is a rectangle but with a semicircle on the right.
\newcommand{\anincome}[2]{ +(-#1, -#2) -- +(+#1,-#2) -- +(+#1, +#2) -- +(-#1,+#2) arc(90:-90:-#1*0.7 and #2) }
\newcommand{\anoutcome}[2]{ +(+#1, -#2) -- +(-#1,-#2) -- +(-#1, +#2) -- +(+#1,+#2) arc(90:-90:#1*0.7 and #2) }

\newcommand{\aleftdatafid}[2]{ +(-#1, -#2) -- +(+#1,-1.6*#2) -- +(+#1, +1.6*#2) -- +(-#1,+#2) --cycle}
\newcommand{\arightdatafid}[2]{ +(-#1, -1.6*#2) -- +(+#1,-#2) -- +(+#1, +#2) -- +(-#1,+1.6*#2) --cycle}

\newcommand{\anupsysfid}[2]{ +(-#1, -#2) -- +(+#1,-#2) -- +(+1.6*#1, +#2) -- +(-1.6*#1,+#2) --cycle}
\newcommand{\adownsysfid}[2]{ +(-1.6*#1,-#2) -- +(+1.6*#1,-#2) -- +(+#1, +#2) -- +(-#1,+#2) --cycle}


\newcommand{\acircle}[2]{ circle (#1) }

\newcommand{\anellipse}[2]{ ellipse(#1 and #2) }

\newcommand{\aleftterminal}[2]{  +(-#1,-0.25*#2) -- + (-#1,0.25*#2)
                    +(0,-0.65*#2) -- + (0,0.65*#2)
                    +(#1,-#2) -- + (#1,#2)  }

\newcommand{\arightterminal}[2]{  +(#1,-0.25*#2) -- + (#1,0.25*#2)
                    +(0,-0.65*#2) -- + (0,0.65*#2)
                    +(-#1,-#2) -- + (-#1,#2)  }



\newcommand{\aupterminal}[2]{  +(-0.25*#1, -#2) -- + (0.25*#1, -#2)
                    +(-0.65*#1, 0) -- + (0.65*#1, 0)
                    +(-#1,#2) -- + (#1,#2)  }

\newcommand{\adownterminal}[2]{  +(-0.25*#1, #2) -- + (0.25*#1, #2)
                    +(-0.65*#1, 0) -- + (0.65*#1, 0)
                    +(-#1,-#2) -- + (#1,-#2)  }



\newcommand{\apreselect}[2]{ +(-#1, -#2) -- +(+#1,-#2) -- +(+#1, #2) -- +(-#1,+#2) -- + (-1.6*#1,0) -- cycle}

\newcommand{\apremeasure}[2]{ +(-#1, -#2) -- +(+#1,-#2) -- +(+#1, #2) -- +(-#1,+#2) -- + (-0.6*#1,0) -- cycle}

\newcommand{\apostselect}[2]{ +(-#1, -#2) -- +(+#1,-#2)-- +(1.6*#1,0) -- +(+#1, #2) -- +(-#1,+#2) -- cycle}

\newcommand{\apostmeasure}[2]{ +(-#1, -#2) -- +(+#1,-#2) -- +(0.6*#1,0) -- +(+#1, #2) -- +(-#1,+#2)  -- cycle}

\newcommand{\aupselect}[2]{ +(-#1, -#2) -- +(-#1,#2) -- +(#1, #2) -- +(#1,-#2) -- + (0,-1.6*#2) -- cycle}

\newcommand{\adownselect}[2]{ +(#1, #2) -- +(#1,-#2) -- +(-#1,-#2) -- +(-#1,#2) -- + (0,1.6*#2) -- cycle}


\newcommand{\apreflag}[2]{ +(-1.6*#1, -#2) -- +(+#1,-#2) -- +(+#1, #2) -- +(-1.6*#1,+#2) -- + (-#1,0) -- cycle}

\newcommand{\apostflag}[2]{ +(-#1, -#2) -- +(+1.6*#1,-#2)-- +(#1,0) -- +(+1.6*#1, #2) -- +(-#1,+#2) -- cycle}

% used to define \cmirrordownphys etc.
\newcommand{\azigzagtoprectangle}[2]{[decoration={zigzag, segment length=2.5mm,amplitude=0.25mm}] decorate{+(-#1,#2) -- +(#1,#2)} -- +(#1,-#2) -- +(-#1,-#2) -- cycle }

\newcommand{\azigzagbottomrectangle}[2]{[decoration={zigzag, segment length=2.5mm,amplitude=0.25mm}]
decorate{+(-#1,-#2) -- +(#1,-#2)} -- +(#1,#2) -- +(-#1,#2) -- cycle }

\newcommand{\azigzagrightrectangle}[2]{[decoration={zigzag, segment length=2.5mm,amplitude=0.25mm}]
decorate{+(#1,#2) -- +(#1,-#2)} -- +(-#1,-#2) -- +(-#1,#2) -- cycle }

\newcommand{\azigzagleftrectangle}[2]{[decoration={zigzag, segment length=2.5mm,amplitude=0.25mm}]
decorate{+(-#1,-#2) -- +(-#1,#2)} -- +(#1,#2) -- +(-#1,#2) -- cycle }


\newcommand{\asnaketoprectangle}[2]{[decoration={snake, pre length=1mm,segment length=2.5mm,amplitude=0.25mm}]
decorate{+(-#1,#2) -- +(#1,#2)} -- +(#1,-#2) -- +(-#1,-#2) -- cycle }

\newcommand{\asnakebottomrectangle}[2]{[decoration={snake, pre length=1mm, segment length=2.5mm,amplitude=0.25mm}]
decorate{+(-#1,-#2) -- +(#1,-#2)} -- +(#1,#2) -- +(-#1,#2) -- cycle }

\newcommand{\asnakerightrectangle}[2]{[decoration={snake, pre length=1mm, segment length=2.5mm,amplitude=0.25mm}]
decorate{+(#1,#2) -- +(#1,-#2)} -- +(-#1,-#2) -- +(-#1,#2) -- cycle }

\newcommand{\asnakeleftrectangle}[2]{[decoration={snake, pre length=1mm, segment length=2.5mm,amplitude=0.25mm}]
decorate{+(-#1,-#2) -- +(-#1,#2)} -- +(#1,#2) -- +(-#1,#2) -- cycle }



%%% need to define this in two parts
\newcommand{\aleftthinboxPartA}[2]{ [thin]  +(-#1, -#2) rectangle + (+#1,+#2)  }
\newcommand{\aleftthinboxPartB}[2]{ [thick, double distance=0.3pt, cap=round] +(#1,#2)  --  +(-#1,#2) -- +(-#1,-#2) -- +(#1,-#2) }


\newcommand{\arightthinboxPartA}[2]{ [thin]  +(-#1, -#2) rectangle + (+#1,+#2) }
\newcommand{\arightthinboxPartB}[2]{ [thick, double distance=0.3pt, cap=round] +(-#1,#2)  --  +(#1,#2) -- +(#1,-#2) -- +(-#1,-#2) }



%%% three parts
\newcommand{\atransposeboxZPartA}[2]{ [thin]  +(-#1,0) -- +(-#1,#2)  --  +(#1,#2) -- +(#1,0) -- +(#1,-#2) -- +(-#1,-#2) -- +(-#1,0) }
\newcommand{\atransposeboxZPartB}[2]{ [thick, double distance=0.3pt, cap=round] +(-#1,#2)  --  +(#1,#2) -- +(#1,0) }
\newcommand{\atransposeboxZPartC}[2]{ [thick, double distance=0.3pt, cap=round] +(#1,-#2) -- +(-#1,-#2) -- +(-#1,0) }

\newcommand{\atransposeboxSPartA}[2]{ [thin]  +(-#1,0) -- +(-#1,#2)  --  +(#1,#2) -- +(#1,0) -- +(#1,-#2) -- +(-#1,-#2) -- +(-#1,0) }
\newcommand{\atransposeboxSPartB}[2]{ [thick, double distance=0.3pt, cap=round] +(#1,#2)  --  +(-#1,#2) -- +(-#1,0) }
\newcommand{\atransposeboxSPartC}[2]{ [thick, double distance=0.3pt, cap=round] +(-#1,-#2) -- +(#1,-#2) -- +(#1,0) }



%%% four parts
\newcommand{\aeggSthinpartR}[2]{ [thin] +(#1,0) -- +(#1,#2) }
\newcommand{\aeggSthinpartL}[2]{ [thin] +(-#1,0) -- +(-#1,-#2) }
\newcommand{\aeggSdoubleU}[2]{ +(#1,#2) [double distance=0.3pt, cap=round] arc[start angle=0, end angle =180, radius=#1] -- +(0,-#2) }
\newcommand{\aeggSdoubleD}[2]{ [double distance=0.3pt, cap=round] +(-#1,-#2) arc[start angle=-180, end angle =0, radius=#1] -- +(0,#2) }

\newcommand{\aeggZthinpartR}[2]{ [thin] +(#1,0) -- +(#1,-#2) }
\newcommand{\aeggZthinpartL}[2]{ [thin] +(-#1,0) -- +(-#1,#2) }
\newcommand{\aeggZdoubleU}[2]{ +(-#1,#2) [double distance=0.3pt, cap=round] arc[start angle=180, end angle =0, radius=#1] -- +(0,-#2) }
\newcommand{\aeggZdoubleD}[2]{ [double distance=0.3pt, cap=round] +(#1,-#2) arc[start angle=-0, end angle =-180, radius=#1] -- +(0,#2) }






\newcommand{\acap}[2]{ +(#1, -#2) arc (0:180:#1) }


\newcommand{\acup}[2]{ +(-#1, #2) arc (0:180:-#1) }


\newcommand{\ahcap}[2]{ +(#2, -#1) arc (-90:90:#1) }


\newcommand{\ahcup}[2]{ +(-#2, #1) arc (-90:90:-#1) }

% the below shapes are blob-like.  I don't think they will work with the join commands. The rounded corners command
%is put under strain if xscale and yscale are too different.
% they can be used inside \cshape, etc. For example \cshape{\atooth}{A}{1}{1}{4,5}
% actually, I am using them inside \cobject. for example \cobject{\thetooth}{A}{1}{1}{1,-0.07}
%\atooth{xscale}{yscale}  various names like tooth.



\newcommand{\thetooth}{ +(-7.25,-1.90) -- +(-1.25,0) -- +(-5.25,3.25) -- +(-5.25, 6.25) --
                               +(-0.75, 3.25) -- +(4.25, 3.25) -- +(1.75,0.25) -- +(1.75, -3.75) -- +(0.25, -5.25) -- +(-1.70, -2.50)  -- cycle }

\newcommand{\theblob}{ +(1,4.25) -- +(4,-0.75) -- +(0, -4.75) -- +(-2, -2.75) -- +(-4,2.75) -- cycle }

\newcommand{\theflag}{ +(-4.75,-3) -- +(4.25, -4) -- +(-0.74,9) -- cycle}

\newcommand{\thegelato}{ +(-3,2) -- +(0,5) -- +(2, 3) -- +(3, -7) -- +(0, -3) -- cycle}


% thehuman





%%%%%%%%%% \Cobject[6][thick]{\theblob}{B}{1}{1}{4,5} for placing for named shapes, \thetooth, \theblob, ...
%(having no arguments) with rounded corners


\newcommand{\Cobject}[6][thick]{
\path ($(#6)+(XYshift)$) coordinate (#3);
\draw[#1, shift={(#3)}, xscale=#4, yscale=#5, rounded corners=#4*4pt+#5*4pt] #2;
\path (#3) coordinate (fontlocation);
\path (#4, 0) coordinate (#3 right);
\path (0, #5) coordinate (#3 top);
\path (#3) node {\ensuremath{\defaultfont #3}};
}

\newcommand{\cobject}[6][thick]{
\path ($(#6)+(XYshift)$) coordinate (#3);
\draw[#1, shift={(#3)}, xscale=#4, yscale=#5, rounded corners=#4*4pt+#5*4pt] #2;
\path (#3) coordinate (fontlocation);
\path (#4, 0) coordinate (#3 right);
\path (0, #5) coordinate (#3 top);
}

\newcommand{\Cobjectwhite}[6][thick]{
\path ($(#6)+(XYshift)$) coordinate (#3);
\filldraw[#1, fill=white, shift={(#3)}, xscale=#4, yscale=#5, rounded corners=#4*4pt+#5*4pt] #2;
\path (#3) coordinate (fontlocation);
\path (#4, 0) coordinate (#3 right);
\path (0, #5) coordinate (#3 top);
\path (#3) node {\ensuremath{\defaultfont #3}};
}

\newcommand{\cobjectwhite}[6][thick]{
\path ($(#6)+(XYshift)$) coordinate (#3);
\filldraw[#1, fill=white, shift={(#3)}, xscale=#4, yscale=#5, rounded corners=#4*4pt+#5*4pt] #2;
\path (#3) coordinate (fontlocation);
\path (#4, 0) coordinate (#3 right);
\path (0, #5) coordinate (#3 top);
}

%%% testing below command.  Probably won't work.
\newcommand{\cobjectclip}[6][thick]{
\path ($(#6)+(XYshift)$) coordinate (#3);
\draw[#1, shift={(#3)}, xscale=#4, yscale=#5, rounded corners=#4*4pt+#5*4pt, clip] #2;
\path (#3) coordinate (fontlocation);
\path (#4, 0) coordinate (#3 right);
\path (0, #5) coordinate (#3 top);
}


%%%%%%%%%%%%%%\Cshape[thick]{\ashapename}{node name}{hsize}{vsize}{x,y}


\newcommand{\Cshape}[6][thick]{\draw[#1] ($(#6)+(XYshift)$) node (#3) {\ensuremath{\defaultfont #3}}
#2{#4}{#5};
\path ($(#6)+(XYshift)$) coordinate (fontlocation);
\path (#4, 0) coordinate (#3 right);
\path (0, #5) coordinate (#3 top);
}

\newcommand{\Cshapedouble}[6][thick, double distance=0.3pt]{\draw[#1] ($(#6)+(XYshift)$) node (#3) {\ensuremath{\defaultfont #3}}
#2{#4}{#5};
\path ($(#6)+(XYshift)$) coordinate (fontlocation);
\path ($(#4, 0)+(0.8pt,0)$) coordinate (#3 right);
\path ($(0, #5)+(0,0.8pt)$) coordinate (#3 top);
}

%\cshape[thick]{\ashapename}{node name}{hsize}{vsize}{x,y}

\newcommand{\cshape}[6][thick]{\draw[#1] ($(#6)+(XYshift)$) coordinate (#3)
#2{#4}{#5};
\path ($(#6)+(XYshift)$) coordinate (fontlocation);
\path (#4, 0) coordinate (#3 right);
\path (0, #5) coordinate (#3 top);
}


\newcommand{\cshapedouble}[6][thick, double distance=0.3pt]{\draw[#1] ($(#6)+(XYshift)$) coordinate (#3)
#2{#4}{#5};
\path ($(#6)+(XYshift)$) coordinate (fontlocation);
\path ($(#4, 0)+(0.8pt,0)$) coordinate (#3 right);
\path ($(0, #5)+(0,0.8pt)$) coordinate (#3 top);
}

\newcommand{\cshapefill}[6][thick]{\filldraw[fill=black, #1] ($(#6)+(XYshift)$) coordinate (#3)
#2{#4}{#5};
\path ($(#6)+(XYshift)$) coordinate (fontlocation);
\path (#4, 0) coordinate (#3 right);
\path (0, #5) coordinate (#3 top);
}

\newcommand{\Cshapewhite}[6][thick]{\filldraw[fill=white, #1] ($(#6)+(XYshift)$) coordinate (#3)
#2{#4}{#5};
\path ($(#6)+(XYshift)$) coordinate (fontlocation);
\path (#4, 0) coordinate (#3 right);
\path (0, #5) coordinate (#3 top);
\path (#3) node {\ensuremath{\defaultfont #3}};
}

\newcommand{\cshapewhite}[6][thick]{\filldraw[fill=white, #1] ($(#6)+(XYshift)$) coordinate (#3)
#2{#4}{#5};
\path ($(#6)+(XYshift)$) coordinate (fontlocation);
\path (#4, 0) coordinate (#3 right);
\path (0, #5) coordinate (#3 top);
}


% \cshapeghostwidgetdouble{A}{upper}{xsize}{ysize}{offset}  creates a ghost shape at (A)+(offsett)
%with xsize and ysize.  Can be used in join commands, for example
%using \joincc{A upper}{30}{B lower}{-60}.  This is used in the definition of \ceggS and \ceggZ
\newcommand{\cshapeghostwidgetdouble}[5]{
\path ($(#1)+(XYshift)+(#5)$) coordinate (#1 #2);
\path ($(#3, 0)+(0.8pt,0)$) coordinate (#1 #2 right);
\path ($(0, #4)+(0,0.8pt)$) coordinate (#1 #2 top);
}


%%% All the parts for defining \Cleftdoublesemi are here - though in tscustomcommands are commands to put markers in.



%% draws double left semicircle bit
\newcommand{\aleftdoublesemiPartB}[2]
{ [thick, double distance=0.3pt, cap=round] +(0,#1) arc [start angle=-90, end
angle =90, radius=-#1] }

%% draws straight bit
\newcommand{\aleftdoublesemiPartA}[2]
{  +(0,#2)-- +(0,-#2) }

%% draws double left semicircle bit
\newcommand{\arightdoublesemiPartB}[2]
{ [thick, double distance=0.3pt, cap=round] +(0,-#1) arc [start angle=-90, end
angle =90, radius=#1] }

%% draws straight bit
\newcommand{\arightdoublesemiPartA}[2]
{  +(0,#2)-- +(0,-#2) }



\newcommand{\Cleftdoublesemi}[4][thin]{ \cshape[#1]{\aleftdoublesemiPartA}{#2}{#3}{#3}{#4}
\cshapedouble[#1]{\aleftdoublesemiPartB}{#2}{#3}{#3}{#4}
\draw[#1]($(#4)+(XYshift)-0.4*(#3,0)$) node (fontlocation)
{\ensuremath{\defaultfont #2}};
%\path ($(#4)+(XYshift)-0.4*(#3,0)$) coordinate
%(fontlocation);
%
\path (0,0) coordinate (#2 right);
  }

\newcommand{\Crightdoublesemi}[4][thin]{ \cshape[#1]{\arightdoublesemiPartA}{#2}{#3}{#3}{#4}
  \cshapedouble[#1]{\arightdoublesemiPartB}{#2}{#3}{#3}{#4}
\draw[#1] ($(#4)+(XYshift)+0.4*(#3,0)$) node (fontlocation)
{\ensuremath{\defaultfont #2}};
%\path ($(#4)+(XYshift)+0.4*(#3,0)$) coordinate
%(fontlocation);
\path (0,0) coordinate (#2 right);
  }


\newcommand{\cleftdoublesemi}[4][thin]{ \cshape[#1]{\aleftdoublesemiPartA}{#2}{#3}{#3}{#4}
\cshapedouble[#1]{\aleftdoublesemiPartB}{#2}{#3}{#3}{#4}
%\draw[#1]($(#4)+(XYshift)-0.4*(#3,0)$) node (fontlocation)
%{\ensuremath{\defaultfont #2}};
%
\path ($(#4)+(XYshift)-0.4*(#3,0)$) coordinate (fontlocation);
%
\path (0,0) coordinate (#2 right);
  }

\newcommand{\crightdoublesemi}[4][thin]{ \cshape[#1]{\arightdoublesemiPartA}{#2}{#3}{#3}{#4}
\cshapedouble[#1]{\arightdoublesemiPartB}{#2}{#3}{#3}{#4}
%\draw[#1] ($(#4)+(XYshift)+0.4*(#3,0)$) node (fontlocation)
%{\ensuremath{\defaultfont #2}};
%
\path ($(#4)+(XYshift)+0.4*(#3,0)$) coordinate (fontlocation); \path (0,0)
coordinate (#2 right);
  }

%%%%%%%%%% end of doublesemi commands.



%\Crectangle[thick]{A}{1}{1}{0,0} \Ccircle[thin]{A}{radius}{2,4}

\newcommand{\Ccircle}[4][thick]{ \Cshape[#1]{\acircle}{#2}{#3}{#3}{#4} }
\newcommand{\ccircle}[4][thick]{\cshape[#1]{\acircle}{#2}{#3}{#3}{#4} }

\newcommand{\ccirclefill}[4][thick]{\cshapefill[#1]{\acircle}{#2}{#3}{#3}{#4} }


\newcommand{\Ccircledouble}[4][thick, double distance=0.3pt]{\Cshapedouble[#1]{\acircle}{#2}{#3}{#3}{#4}}
\newcommand{\ccircledouble}[4][thick, double distance=0.3pt]{\cshapedouble[#1]{\acircle}{#2}{#3}{#3}{#4}}

\newcommand{\Ccircledoublethin}[4][thin, double distance=0.3pt]{\Cshapedouble[#1]{\acircle}{#2}{#3}{#3}{#4}}
\newcommand{\ccircledoublethin}[4][thin, double distance=0.3pt]{\cshapedouble[#1]{\acircle}{#2}{#3}{#3}{#4}}

\newcommand{\Ccirclegray}[4][thick, fill=lightgray]{ \Cshape[#1]{\acircle}{#2}{#3}{#3}{#4} }
\newcommand{\ccirclegray}[4][thick, fill=lightgray]{\cshape[#1]{\acircle}{#2}{#3}{#3}{#4} }


\newcommand{\Ccircledoublegray}[4][thick, fill=lightgray, double distance=0.3pt]{\Cshapedouble[#1]{\acircle}{#2}{#3}{#3}{#4}}
\newcommand{\ccircledoublegray}[4][thick, fill=lightgray, double distance=0.3pt]{\cshapedouble[#1]{\acircle}{#2}{#3}{#3}{#4}}


\newcommand{\Crectangle}[5][thick]{\Cshape[#1]{\arectangle}{#2}{#3}{#4}{#5}}
\newcommand{\crectangle}[5][thick]{\cshape[#1]{\arectangle}{#2}{#3}{#4}{#5}}


%% under construction!!!

\newcommand{\czigzagtoprectangle}[5][thick]{\cshape[#1]{\asnaketoprectangle}{#2}{#3}{#4}{#5}}

\newcommand{\csnaketoprectangle}[5][thick]{\cshape[#1]{\asnaketoprectangle}{#2}{#3}{#4}{#5}}

\newcommand{\csnakebottomrectangle}[5][thick]{\cshape[#1]{\asnakebottomrectangle}{#2}{#3}{#4}{#5}}

\newcommand{\csnakeleftrectangle}[5][thick]{\cshape[#1]{\asnakeleftrectangle}{#2}{#3}{#4}{#5}}

\newcommand{\csnakerightrectangle}[5][thick]{\cshape[#1]{\asnakerightrectangle}{#2}{#3}{#4}{#5}}



\newcommand{\Cdiamond}[5][thick]{\Cshape[#1]{\adiamond}{#2}{#3}{#4}{#5}}
\newcommand{\cdiamond}[5][thick]{\cshape[#1]{\adiamond}{#2}{#3}{#4}{#5}}


%note that the font placement in \Crightcutdiamond and \Cleftcutdiamond do not work well.  This would be an
%easy fix but I don't intend to use font inside them.
\newcommand{\Crightcutdiamond}[5][thick]{\Cshape[#1]{\arightcutdiamond}{#2}{#3}{#4}{#5}}
\newcommand{\crightcutdiamond}[5][thick]{\cshape[#1]{\arightcutdiamond}{#2}{#3}{#4}{#5}}

\newcommand{\Cleftcutdiamond}[5][thick]{\Cshape[#1]{\aleftcutdiamond}{#2}{#3}{#4}{#5}}
\newcommand{\cleftcutdiamond}[5][thick]{\cshape[#1]{\aleftcutdiamond}{#2}{#3}{#4}{#5}}


\newcommand{\Ctriangle}[5][thick]{\Cshape[#1]{\atriangle}{#2}{#3}{#4}{#5}}
\newcommand{\ctriangle}[5][thick]{\cshape[#1]{\atriangle}{#2}{#3}{#4}{#5}}


%\crectanglerelpoint[thick]{A}{2}{3}{B}{4,5}   draws a rectangle named A at (B)+(4,5)
\newcommand{\crectanglerelpoint}[6][thick]{\cshape[#1]{\arectangle}{#2}{#3}{#4}{$(#5)+(#6)$}}

\newcommand{\crectangledoublerelpoint}[6][thick, double]{\cshapedouble[#1]{\arectangle}{#2}{#3}{#4}{$(#5)+(#6)$}}



\newcommand{\Crectangledouble}[5][thick, double distance=0.3pt]{\Cshapedouble[#1]{\arectangle}{#2}{#3}{#4}{#5}}
\newcommand{\crectangledouble}[5][thick, double distance=0.3pt]{\cshapedouble[#1]{\arectangle}{#2}{#3}{#4}{#5}}

\newcommand{\crectanglefill}[5][thick]{\cshapefill[#1]{\arectangle}{#2}{#3}{#4}{#5}}


\newcommand{\Cellipse}[5][thick]{\Cshape[#1]{\anellipse}{#2}{#3}{#4}{#5}}
\newcommand{\cellipse}[5][thick]{\cshape[#1]{\anellipse}{#2}{#3}{#4}{#5}}


\newcommand{\Csquare}[4][thick]{\Cshape[#1]{\arectangle}{#2}{#3}{#3}{#4}}
\newcommand{\csquare}[4][thick]{\cshape[#1]{\arectangle}{#2}{#3}{#3}{#4}}

\newcommand{\Ucircle}[2]{ \Cshape[thick]{\acircle}{#1}{1}{1}{#2} }
\newcommand{\ucircle}[2]{ \cshape[thick]{\acircle}{#1}{1}{1}{#2} }

\newcommand{\Scircle}[2]{ \Cshape[thick]{\acircle}{#1}{0.77}{0.77}{#2} }   %small circle
\newcommand{\scircle}[2]{ \cshape[thick]{\acircle}{#1}{0.77}{0.77}{#2} }

\newcommand{\Mcircle}[2]{ \Cshape[thin]{\acircle}{#1}{0.25}{0.25}{#2} }   %mini circle
\newcommand{\mcircle}[2]{ \cshape[thin]{\acircle}{#1}{0.25}{0.25}{#2} }

\newcommand{\Hatcircle}[2]{ \Cshape[thick]{\acircle}{#1}{0.82}{0.82}{#2} }   %small circle - slightly bigger to contain \hat{X}
\newcommand{\hatcircle}[2]{ \cshape[thick]{\acircle}{#1}{0.82}{0.82}{#2} }

\newcommand{\Cleftthinbox}[5][thick]{\cshape[#1]{\aleftthinboxPartA}{#2}{#3}{#4}{#5} \Cshapedouble[#1]{\aleftthinboxPartB}{#2}{#3}{#4}{#5}
                                     \path (#3, 0) coordinate (#2 right);  }
\newcommand{\cleftthinbox}[5][thick]{\cshape[#1]{\aleftthinboxPartA}{#2}{#3}{#4}{#5} \cshapedouble[#1]{\aleftthinboxPartB}{#2}{#3}{#4}{#5}
                                     \path (#3, 0) coordinate (#2 right);  }

\newcommand{\Crightthinbox}[5][thick]{\cshape[#1]{\arightthinboxPartA}{#2}{#3}{#4}{#5} \Cshapedouble[#1]{\arightthinboxPartB}{#2}{#3}{#4}{#5}
                                      \path (#3, 0) coordinate (#2 right); }
\newcommand{\crightthinbox}[5][thick]{\cshape[#1]{\arightthinboxPartA}{#2}{#3}{#4}{#5} \cshapedouble[#1]{\arightthinboxPartB}{#2}{#3}{#4}{#5}
                                      \path (#3, 0) coordinate (#2 right); }


%\CtransposeS
\newcommand{\CtransposeboxS}[5][thick]{\cshape[#1]{\atransposeboxSPartA}{#2}{#3}{#4}{#5}
                                       \cshape[#1]{\atransposeboxSPartB}{#2}{#3}{#4}{#5}
                                       \Cshapedouble[#1]{\atransposeboxSPartC}{#2}{#3}{#4}{#5}  }

\newcommand{\ctransposeboxS}[5][thick]{ \cshape[#1]{\atransposeboxSPartA}{#2}{#3}{#4}{#5}
                                        \cshape[#1]{\atransposeboxSPartB}{#2}{#3}{#4}{#5}
                                        \cshapedouble[#1]{\atransposeboxSPartC}{#2}{#3}{#4}{#5}  }


\newcommand{\CtransposeboxZ}[5][thick]{\cshape[#1]{\atransposeboxZPartA}{#2}{#3}{#4}{#5}
                                       \cshape[#1]{\atransposeboxZPartB}{#2}{#3}{#4}{#5}
                                       \Cshapedouble[#1]{\atransposeboxZPartC}{#2}{#3}{#4}{#5}  }

\newcommand{\ctransposeboxZ}[5][thick]{ \cshape[#1]{\atransposeboxZPartA}{#2}{#3}{#4}{#5}
                                        \cshape[#1]{\atransposeboxZPartB}{#2}{#3}{#4}{#5}
                                        \cshapedouble[#1]{\atransposeboxZPartC}{#2}{#3}{#4}{#5}  }




% these create the egg shaped objects with partial double borders I use for general complex Hilbert objects.
% note, in particular, that to join to the upper semicircle or lower semicircle must append upper or lower
% to object name.  E.g. \joincc{A upper}{60}{B lower}{-120}
\newcommand{\CeggS}[5][thick]{
\cshape[#1]{\aeggSthinpartR}{#2}{#3}{#4}{#5}
\cshape[#1]{\aeggSthinpartL}{#2}{#3}{#4}{#5}
\cshapedouble[#1]{\aeggSdoubleU}{#2}{#3}{#4}{#5}
\Cshapedouble[#1]{\aeggSdoubleD}{#2}{#3}{#4}{#5}
%
\cshapeghostwidgetdouble{#2}{upper}{#3}{#4}{0,#4}
\cshapeghostwidgetdouble{#2}{lower}{#3}{#4}{0,-#4}
}

\newcommand{\CeggZ}[5][thick]{
\cshape[#1]{\aeggZthinpartR}{#2}{#3}{#4}{#5}
\cshape[#1]{\aeggZthinpartL}{#2}{#3}{#4}{#5}
\cshapedouble[#1]{\aeggZdoubleU}{#2}{#3}{#4}{#5}
\Cshapedouble[#1]{\aeggZdoubleD}{#2}{#3}{#4}{#5}
%
\cshapeghostwidgetdouble{#2}{upper}{#3}{#4}{0,#4}
\cshapeghostwidgetdouble{#2}{lower}{#3}{#4}{0,-#4}
}

\newcommand{\ceggS}[5][thick]{
\cshape[#1]{\aeggSthinpartR}{#2}{#3}{#4}{#5}
\cshape[#1]{\aeggSthinpartL}{#2}{#3}{#4}{#5}
\cshapedouble[#1]{\aeggSdoubleU}{#2}{#3}{#4}{#5}
\cshapedouble[#1]{\aeggSdoubleD}{#2}{#3}{#4}{#5}
%
\cshapeghostwidgetdouble{#2}{upper}{#3}{#4}{0,#4}
\cshapeghostwidgetdouble{#2}{lower}{#3}{#4}{0,-#4}
}

\newcommand{\ceggZ}[5][thick]{
\cshape[#1]{\aeggZthinpartR}{#2}{#3}{#4}{#5}
\cshape[#1]{\aeggZthinpartL}{#2}{#3}{#4}{#5}
\cshapedouble[#1]{\aeggZdoubleU}{#2}{#3}{#4}{#5}
\cshapedouble[#1]{\aeggZdoubleD}{#2}{#3}{#4}{#5}
%
\cshapeghostwidgetdouble{#2}{upper}{#3}{#4}{0,#4}
\cshapeghostwidgetdouble{#2}{lower}{#3}{#4}{0,-#4}
}




%%%%%%%%%%%%%%%%




% cup and cap

\newcommand{\Ccup}[5][thin]{ \Cshape[#1]{\acup}{#2}{#3}{#4}{#5} }
\newcommand{\ccup}[5][thin]{\cshape[#1]{\acup}{#2}{#3}{#4}{#5} }

\newcommand{\Ccap}[5][thin]{ \Cshape[#1]{\acap}{#2}{#3}{#4}{#5}  }
\newcommand{\ccap}[5][thin]{\cshape[#1]{\acap}{#2}{#3}{#4}{#5} }

\newcommand{\Chcup}[5][thick]{ \Cshape[#1]{\ahcup}{#2}{#3}{#4}{#5} }
\newcommand{\chcup}[5][thick]{\cshape[#1]{\ahcup}{#2}{#3}{#4}{#5} }

\newcommand{\Chcap}[5][thick]{ \Cshape[#1]{\ahcap}{#2}{#3}{#4}{#5}  }
\newcommand{\chcap}[5][thick]{\cshape[#1]{\ahcap}{#2}{#3}{#4}{#5} }



% radius below was changed from 0.3 (to 1.85pt)

\newcommand{\blackdot}[2]{ \cshapefill[thin]{\acircle}{#1}{0.25}{0.25}{#2} }
\newcommand{\whitedot}[2]{ \cshape[thin]{\acircle}{#1}{0.25}{0.25}{#2} }

\newcommand{\blackdotsq}[2]{ \cshapefill[thin]{\arectangle}{#1}{5pt}{5pt}{#2} }
\newcommand{\whitedotsq}[2]{ \cshape[thin]{\arectangle}{#1}{5pt}{5pt}{#2} }


\newcommand{\Usquare}[2]{ \Cshape[thick]{\arectangle}{#1}{1}{1}{#2} }
\newcommand{\usquare}[2]{ \cshape[thick]{\arectangle}{#1}{1}{1}{#2} }

\newcommand{\Ssquaredotted}[2]{ \Cshape[thick, densely dotted]{\arectangle}{#1}{0.7}{0.7}{#2} }
\newcommand{\ssquaredotted}[2]{ \cshape[thick, densely dotted]{\arectangle}{#1}{0.7}{0.7}{#2} }


\newcommand{\Cincome}[5][thick]{\Cshape[#1]{\anincome}{#2}{#3}{#4}{#5}\path ($(fontlocation)+(-0.2*#3,0)$) coordinate (fontlocation);}
\newcommand{\Coutcome}[5][thick]{\Cshape[#1]{\anoutcome}{#2}{#3}{#4}{#5}\path ($(fontlocation)+(0.2*#3,0)$) coordinate (fontlocation);}
\newcommand{\cincome}[5][thick]{\cshape[#1]{\anincome}{#2}{#3}{#4}{#5}\path ($(fontlocation)+(-0.2*#3,0)$) coordinate (fontlocation);}
\newcommand{\coutcome}[5][thick]{\cshape[#1]{\anoutcome}{#2}{#3}{#4}{#5}\path ($(fontlocation)+(0.2*#3,0)$) coordinate (fontlocation);}

\newcommand{\cincomerelpoint}[6][thick]{\cshape[#1]{\anincome}{#2}{#3}{#4}{$(#5)+(#6)$}
\path ($(fontlocation)+(-0.2*#3,0)$) coordinate (fontlocation);
}
\newcommand{\coutcomerelpoint}[6][thick]{\cshape[#1]{\anoutcome}{#2}{#3}{#4}{$(#5)+(#6)$}
\path ($(fontlocation)+(0.2*#3,0)$) coordinate (fontlocation);
}

\newcommand{\cleftdatafid}[5][thick]{\cshape[#1]{\aleftdatafid}{#2}{#3}{#4}{#5}\path ($(fontlocation)+(-0.2*#3,0)$)
coordinate (fontlocation);}

\newcommand{\crightdatafid}[5][thick]{\cshape[#1]{\arightdatafid}{#2}{#3}{#4}{#5}\path ($(fontlocation)+(-0.2*#3,0)$)
coordinate (fontlocation);}

\newcommand{\sleftdatafid}[3][fill=lightgray]{\cleftdatafid[#1]{#2}{0.5}{0.4}{#3}   }
\newcommand{\srightdatafid}[3][fill=lightgray]{\crightdatafid[#1]{#2}{0.5}{0.4}{#3} }

\newcommand{\cleftvecfid}[5][thick]{\cshapedouble{\aleftdatafid}{#2}{#3}{#4}{#5}\path ($(fontlocation)+(-0.2*#3,0)$)
coordinate (fontlocation);}

\newcommand{\crightvecfid}[5][thick]{\cshapedouble{\arightdatafid}{#2}{#3}{#4}{#5}\path ($(fontlocation)+(-0.2*#3,0)$)
coordinate (fontlocation);}

\newcommand{\sleftvecfid}[3][thick]{\cleftvecfid{#2}{0.5}{0.4}{#3}   }
\newcommand{\srightvecfid}[3][thick]{\crightvecfid{#2}{0.5}{0.4}{#3} }


\newcommand{\cupsysfid}[5][thick]{\cshape[#1]{\anupsysfid}{#2}{#3}{#4}{#5}\path ($(fontlocation)+(-0.2*#3,0)$)
coordinate (fontlocation);}

\newcommand{\cdownsysfid}[5][thick]{\cshape[#1]{\adownsysfid}{#2}{#3}{#4}{#5}\path ($(fontlocation)+(-0.2*#3,0)$)
coordinate (fontlocation);}

\newcommand{\supsysfid}[3][fill=lightgray]{\cupsysfid[#1]{#2}{0.5}{0.4}{#3}   }
\newcommand{\sdownsysfid}[3][fill=lightgray]{\cdownsysfid[#1]{#2}{0.5}{0.4}{#3} }

%construction starts

\newcommand{\cupopfid}[5][thick]{\cshapedouble{\anupsysfid}{#2}{#3}{#4}{#5}\path ($(fontlocation)+(-0.2*#3,0)$)
coordinate (fontlocation);}

\newcommand{\cdownopfid}[5][thick]{\cshapedouble{\adownsysfid}{#2}{#3}{#4}{#5}\path ($(fontlocation)+(-0.2*#3,0)$)
coordinate (fontlocation);}


\newcommand{\supopfid}[3][thick]{\cupopfid[#1]{#2}{0.5}{0.4}{#3}   }
\newcommand{\sdownopfid}[3][thick]{\cdownopfid[#1]{#2}{0.5}{0.4}{#3} }
%construction ends

\newcommand{\cleftterminal}[5][thick]{\cshape[#1]{\aleftterminal}{#2}{#3}{#4}{#5}  }

\newcommand{\crightterminal}[5][thick]{\cshape[#1]{\arightterminal}{#2}{#3}{#4}{#5} }



\newcommand{\sleftterminal}[2]{ \cshape[thick]{\aleftterminal}{#1}{0.3}{0.6}{#2} }
\newcommand{\srightterminal}[2]{ \cshape[thick]{\arightterminal}{#1}{0.3}{0.6}{#2} }


\newcommand{\cdownterminal}[5][thick]{\cshape[#1]{\adownterminal}{#2}{#3}{#4}{#5}  }

\newcommand{\cupterminal}[5][thick]{\cshape[#1]{\aupterminal}{#2}{#3}{#4}{#5} }



\newcommand{\sdownterminal}[2]{ \cshape[thick]{\adownterminal}{#1}{0.6}{0.3}{#2} }
\newcommand{\supterminal}[2]{ \cshape[thick]{\aupterminal}{#1}{0.6}{0.3}{#2} }


\newcommand{\cpreselect}[5][thick]{\cshape[#1]{\apreselect}{#2}{#3}{#4}{#5}   }
\newcommand{\cpostselect}[5][thick]{\cshape[#1]{\apostselect}{#2}{#3}{#4}{#5} }

\newcommand{\Cpreselect}[5][thick]{\Cshape[#1]{\apreselect}{#2}{#3}{#4}{#5}   }
\newcommand{\Cpostselect}[5][thick]{\Cshape[#1]{\apostselect}{#2}{#3}{#4}{#5} }

\newcommand{\cpreselectdouble}[5][thick, double distance=0.3pt]{\cshapedouble[#1]{\apreselect}{#2}{#3}{#4}{#5}   }
\newcommand{\cpostselectdouble}[5][thick, double distance=0.3pt]{\cshapedouble[#1]{\apostselect}{#2}{#3}{#4}{#5} }

\newcommand{\Cpreselectdouble}[5][thick, double distance=0.3pt]{\Cshapedouble[#1]{\apreselect}{#2}{#3}{#4}{#5}   }
\newcommand{\Cpostselectdouble}[5][thick, double distance=0.3pt]{\Cshapedouble[#1]{\apostselect}{#2}{#3}{#4}{#5} }



\newcommand{\cselectup}[5][thick]{\cshape[#1]{\aupselect}{#2}{#3}{#4}{#5}   }
\newcommand{\cselectdown}[5][thick]{\cshape[#1]{\adownselect}{#2}{#3}{#4}{#5} }

\newcommand{\Cselectup}[5][thick]{\Cshape[#1]{\aupselect}{#2}{#3}{#4}{#5}   }
\newcommand{\Cselectdown}[5][thick]{\Cshape[#1]{\adownselect}{#2}{#3}{#4}{#5} }


\newcommand{\cpreflag}[5][thick]{\cshape[#1]{\apreflag}{#2}{#3}{#4}{#5}   }
\newcommand{\cpostflag}[5][thick]{\cshape[#1]{\apostflag}{#2}{#3}{#4}{#5} }

\newcommand{\Cpreflag}[5][thick]{\Cshape[#1]{\apreflag}{#2}{#3}{#4}{#5}   }
\newcommand{\Cpostflag}[5][thick]{\Cshape[#1]{\apostflag}{#2}{#3}{#4}{#5} }



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%% JOINS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% (more JOIN later in file look for \joinA and \joinB can choose arrowhead %
%% type with \setarrowheadA,B)  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% First we define a few useful join commands.

% \joinstraight[thin]{A}{B}  this is a simple join drawing a straight line.  All
% the other commands also specify an angle or position
\newcommand{\joinstraight}[3][thin]{ \draw[#1] (#2) -- (#3); }

% \joinstraightdisplacement{4,5}{1,-1}  joins (4,5) to (4,5)+(1,-1)
\newcommand{\joinstraightdisplace}[3][thin]{ \draw[#1] (#2) -- ($(#2)+(#3)$) ; }

%\joincc[above]{A}{30}{B}{-90}

\newcommand{\joincc}[5][above]{\draw[thin,->-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

%
\newcommand{\joinccarrows}[5][above]{\draw[thin, ->-=0.9999, -<-=0.03, >=angle 60]
                                           ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


\newcommand{\joinccthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccdashed}[5][above]{\draw[thick, dashed] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccthindashed}[5][above]{\draw[thin, dashed] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

%
\newcommand{\joinccdashedarrows}[5][above]{\draw[thin, dashed, ->-=0.999, -<-=0.03, >=angle 60]
                                           ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}



\newcommand{\joinccthick}[5][above]{\draw[thick,->-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


%the following four commands are useful when have overlapping lines

\newcommand{\joinccthickwhite}[5][above]{\draw[white, ultra thick] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccontop}[5][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5} \joincc[#1]{#2}{#3}{#4}{#5}}

% \joinccontopnoarrow defined later



%\joinccvararrow[above]{A}{30}{B}{-90}{0.7}  puts arrowhead 0.7 of way along line

\newcommand{\joinccvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccontopvararrow}[6][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5}
\joinccvararrow[#1]{#2}{#3}{#4}{#5}{#6}}


\newcommand{\joinccthickvararrow}[6][above]{\draw[thick,->-=#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccthickontopvararrow}[6][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5}
\joinccthickvararrow[#1]{#2}{#3}{#4}{#5}{#6}}


%

\newcommand{\joinccvartriangleb}[6][above]{\draw[thin,-triangleblack-=#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccontopvartriangleb}[6][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5}
\joinccvartriangleb[#1]{#2}{#3}{#4}{#5}{#6}}

\newcommand{\joinccvartrianglew}[6][above]{\draw[thin,-trianglewhite-=#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccontopvartrianglew}[6][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5}
\joinccvartrianglew[#1]{#2}{#3}{#4}{#5}{#6}}


% joinccwb[above]{A}{30}{B}{-90}   with white and black dot on path.

\newcommand{\joinccwb}[5][above]{\draw[thin,->-=0.20,->-=-0.10,-o*-=0.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.08] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccbw}[5][above]{\draw[thin,->-=0.20,->-=-0.10,-*o-=0.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.08] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


\newcommand{\joinccwbbw}[5][above]{\draw[thin,->-=0.53,->-=0.14,->-=-0.09,-o*-=0.3,-*o-=-0.3] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccbwwb}[5][above]{\draw[thin,->-=0.53,->-=0.14,->-=-0.09,-*o-=0.3,-o*-=-0.3] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


\newcommand{\joinccwbsq}[5][above]{\draw[thin,->-=0.20,->-=-0.10,-wsqb-=0.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.08] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccbwsq}[5][above]{\draw[thin,->-=0.20,->-=-0.10,-bsqw-=0.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.08] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


\newcommand{\joinccwbbwsq}[5][above]{\draw[thin,->-=0.53,->-=0.14,->-=-0.09,-wsqb-=0.3,-bsqw-=-0.3] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccbwwbsq}[5][above]{\draw[thin,->-=0.53,->-=0.14,->-=-0.09,-bsqw-=0.3,-wsqb-=-0.3] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}



\newcommand{\joinccwbold}[5][above]{
\path ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) coordinate (left);
\path ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) coordinate (right);
\path ($0.5*(left) + 0.5*(right)$) coordinate (middle);
\path ($0.501*(left) + 0.499*(right)$) coordinate (bmiddle);
\draw[-o,->-=.5] (left) to [out=#3, in=0.5*#3+270+0.5*#5] ($(bmiddle)!-1.5pt!(middle)$) ;
\draw[-*,-<-=.5] (right) to [out=#5, in=0.5*#3+90+0.5*#5] ($(bmiddle)!1.5pt!(middle)$);
\path ($(bmiddle)!-1.5pt!(middle)$) to node[#1=0.09] (fontlocation){} ($(bmiddle)!1.5pt!(middle)$);  }


\newcommand{\joinccbwold}[5][above]{
\path ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) coordinate (left);
\path ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) coordinate (right);
\path ($0.5*(left) + 0.5*(right)$) coordinate (middle);
\path ($0.501*(left) + 0.499*(right)$) coordinate (bmiddle);
\draw[-*,->-=.5] (left) to [out=#3, in=0.5*#3+270+0.5*#5] ($(bmiddle)!-1.5pt!(middle)$) ;
\draw[-o,-<-=.5] (right) to [out=#5, in=0.5*#3+90+0.5*#5] ($(bmiddle)!1.5pt!(middle)$);
\path ($(bmiddle)!-1.5pt!(middle)$) to node[#1=0.09] (fontlocation){} ($(bmiddle)!1.5pt!(middle)$);  }



% join cc and add decorations to arrow by hand \joinccdecorate[above]{A}{60}{B}{120}{,->-=0.5, *-*} in last argument - remember first comma.


\newcommand{\joinccdecorate}[6][above]{\draw[thin #6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

% %%%%%%%%%%%%%%%%%%%%%%%%
% this widget rotates the double corrected top into rightdoub.
% This is used in defining commands that connect to the semicircle stuff like \csemidleft
\newcommand{\rightdoubwidget}[2]{\path ($(0,0)!1!-90:(#1 top)$) coordinate (#1 rightdoub); \path
($(0,0)!1!-90:(#2 top)$) coordinate (#2 rightdoub);}

% when joining to semicircle need this rather than \joinccnoarrow.
\newcommand{\joinccnoarrowforsemid}[5][above]{
\rightdoubwidget{#2}{#4} \draw[thin] ($(#2)+ cos(#3)*(#2
rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node [#1=0.07]
(fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4 top)$);}



\newcommand{\joinccbwleft}[5][above]{
\rightdoubwidget{#2}{#4} \draw[thin,-leftlbw-=.5] ($(#2)+ cos(#3)*(#2
rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node [#1=0.07]
(fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4 top)$);}

\newcommand{\joinccbwright}[5][above]{
\rightdoubwidget{#2}{#4} \draw[thin,-rightlbw-=.5] ($(#2)+ cos(#3)*(#2
rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node [#1=0.07]
(fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4 top)$);}


%%%%%%%%%
%% these triangleb and trianglew commands work on \csemidleft and \csemidright.  I have also defined
%%  some triangleb and trianglew commands below that work on joinrl, etc.
%%%%%%%%%
\newcommand{\joincctriangleb}[5][above]{
\rightdoubwidget{#2}{#4} \draw[thin,-triangleblack-=.5] ($(#2)+ cos(#3)*(#2
rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node [#1=0.07]
(fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4 top)$);}

\newcommand{\joincctrianglew}[5][above]{
\rightdoubwidget{#2}{#4} \draw[thin,-trianglewhite-=.5] ($(#2)+ cos(#3)*(#2
rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node [#1=0.07]
(fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4 top)$);}

\newcommand{\joincctrianglebvar}[6][above]{
\rightdoubwidget{#2}{#4} \draw[thin,-triangleblack-=#6] ($(#2)+ cos(#3)*(#2
rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node [#1=0.07]
(fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4 top)$);}

\newcommand{\joincctrianglewvar}[6][above]{
\rightdoubwidget{#2}{#4} \draw[thin,-trianglewhite-=#6] ($(#2)+ cos(#3)*(#2
rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node [#1=0.07]
(fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4 top)$);}



% This command uses widget so it can join semid's but has noarrow
\newcommand{\joinccseminoarrow}[5][above]{
\rightdoubwidget{#2}{#4} \draw[thin] ($(#2)+ cos(#3)*(#2
rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node [#1=0.07]
(fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4 top)$);}


%%
\newcommand{\joincctrianglebwtowards}[5][above]{
\rightdoubwidget{#2}{#4} \draw[thin,-triangleblack-=0.3,-trianglewhiteR-=.7]
($(#2)+ cos(#3)*(#2 rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node
[#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4
top)$);}

\newcommand{\joincctrianglebwaway}[5][above]{
\rightdoubwidget{#2}{#4} \draw[thin,-triangleblackR-=0.3,-trianglewhite-=.7]
($(#2)+ cos(#3)*(#2 rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node
[#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4
top)$);}

\newcommand{\joincctrianglebw}[5][above]{
\rightdoubwidget{#2}{#4} \draw[thin,-triangleblack-=0.3,-trianglewhite-=.7]
($(#2)+ cos(#3)*(#2 rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node
[#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4
top)$);}

\newcommand{\joincctrianglewb}[5][above]{
\rightdoubwidget{#2}{#4} \draw[thin,-trianglewhite-=0.3,-triangleblack-=.7]
($(#2)+ cos(#3)*(#2 rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node
[#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4
top)$);}

\newcommand{\joincctrianglebb}[5][above]{
\rightdoubwidget{#2}{#4} \draw[thin,-triangleblack-=0.3,-triangleblack-=.7]
($(#2)+ cos(#3)*(#2 rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node
[#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4
top)$);}

\newcommand{\joincctriangleww}[5][above]{
\rightdoubwidget{#2}{#4} \draw[thin,-trianglewhite-=0.3,-trianglewhite-=.7]
($(#2)+ cos(#3)*(#2 rightdoub) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node
[#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 rightdoub) + sin(#5)*(#4
top)$);}


%\newcommand{\joinccwbbw}[5][above]{
%\path ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) coordinate (left);
%\path ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) coordinate (right);
%\path ($0.5*(left) + 0.5*(right)$) coordinate (middle);
%\path ($0.501*(left) + 0.499*(right)$) coordinate (bmiddle);
%\path ($0.501*(right) + 0.499*(left)$) coordinate (amiddle);
%\draw[-o,->-=.5] (left) to [out=#3, in=0.5*#3+270+0.5*#5] ($(bmiddle)!-1.5cm-1.5pt!(middle)$) ;
%\draw[*-*,->-=.5] ($(bmiddle)!-1.5cm+1.5pt!(amiddle)$) to [out=0.5*#3+90+0.5*#5, in=0.5*#3+270+0.5*#5] ($(bmiddle)!1.5cm-1.5pt!(amiddle)$);
%\draw[-o,-<-=.5] (right) to [out=#5, in=0.5*#3+90+0.5*#5] ($(bmiddle)!1.5cm+1.5pt!(middle)$);
%\path ($(bmiddle)!-1.5pt!(middle)$) to node[#1=0.09] (fontlocation){} ($(bmiddle)!+1.5pt!(middle)$);  }

%\newcommand{\joinccbwwb}[5][above]{
%\path ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) coordinate (left);
%\path ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) coordinate (right);
%\path ($0.5*(left) + 0.5*(right)$) coordinate (middle);
%\path ($0.501*(left) + 0.499*(right)$) coordinate (bmiddle);
%\path ($0.501*(right) + 0.499*(left)$) coordinate (amiddle);
%\draw[-*,->-=.5] (left) to [out=#3, in=0.5*#3+270+0.5*#5] ($(bmiddle)!-1.5cm-1.5pt!(middle)$) ;
%\draw[o-o,->-=.5] ($(bmiddle)!-1.5cm+1.5pt!(amiddle)$) to [out=0.5*#3+90+0.5*#5, in=0.5*#3+270+0.5*#5] ($(bmiddle)!1.5cm-1.5pt!(amiddle)$);
%\draw[-*,-<-=.5] (right) to [out=#5, in=0.5*#3+90+0.5*#5] ($(bmiddle)!1.5cm+1.5pt!(middle)$);
%\path ($(bmiddle)!-1.5pt!(middle)$) to node[#1=0.09] (fontlocation){} ($(bmiddle)!+1.5pt!(middle)$);  }






% \jointb[above]{A}{3}{B}{-4}

\newcommand{\jointb}[5][above]{\draw[thin,->-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbt}[5][above]{\draw[thin,->-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointt}[5][above]{\draw[thin,->-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbb}[5][above]{\draw[thin,->-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointl}[5][above]{\draw[thin,->-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointr}[5][above]{\draw[thin,->-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinbl}[5][above]{\draw[thin,->-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbr}[5][above]{\draw[thin,->-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinll}[5][above]{\draw[thin,->-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlr}[5][above]{\draw[thin,->-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrl}[5][above]{\draw[thin,->-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrr}[5][above]{\draw[thin,->-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlt}[5][above]{\draw[thin,->-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlb}[5][above]{\draw[thin,->-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrt}[5][above]{\draw[thin,->-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrb}[5][above]{\draw[thin,->-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% \jointc[above]{A}{3}{B}{60}

\newcommand{\jointc}[5][above]{\draw[thin,->-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinbc}[5][above]{\draw[thin,->-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinct}[5][above]{\draw[thin,->-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincb}[5][above]{\draw[thin,->-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joincl}[5][above]{\draw[thin,->-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincr}[5][above]{\draw[thin,->-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlc}[5][above]{\draw[thin,->-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinrc}[5][above]{\draw[thin,->-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


% these allow for the arrow to be placed at a variable position along wire \joinrlvararrow{A}{0}{B}{1}{0.65} places arrow at 0.65 along from A to B.
\newcommand{\jointbvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% \jointc[above]{A}{3}{B}{60}

\newcommand{\jointcvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinbcvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinctvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincbvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinclvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincrvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlcvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinrcvararrow}[6][above]{\draw[thin,->-=#6] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}



% arrowhead on left side or on right side only

\newcommand{\jointbleft}[5][above]{\draw[thin,-leftl-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtleft}[5][above]{\draw[thin,-rightl-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}

\newcommand{\jointbright}[5][above]{\draw[thin,-rightl-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtright}[5][above]{\draw[thin,-leftl-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}


%thick line versions

\newcommand{\jointbthick}[5][above]{\draw[thick,->-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtthick}[5][above]{\draw[thick,->-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtthick}[5][above]{\draw[thick,->-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbthick}[5][above]{\draw[thick,->-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlthick}[5][above]{\draw[thick,->-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrthick}[5][above]{\draw[thick,->-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblthick}[5][above]{\draw[thick,->-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrthick}[5][above]{\draw[thick,->-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllthick}[5][above]{\draw[thick,->-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrthick}[5][above]{\draw[thick,->-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlthick}[5][above]{\draw[thick,->-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrthick}[5][above]{\draw[thick,->-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltthick}[5][above]{\draw[thick,->-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbthick}[5][above]{\draw[thick,->-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtthick}[5][above]{\draw[thick,->-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbthick}[5][above]{\draw[thick,->-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}



\newcommand{\jointcthick}[5][above]{\draw[thick,->-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinbcthick}[5][above]{\draw[thick,->-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinctthick}[5][above]{\draw[thick,->-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincbthick}[5][above]{\draw[thick,->-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinclthick}[5][above]{\draw[thick,->-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincrthick}[5][above]{\draw[thick,->-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlcthick}[5][above]{\draw[thick,->-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinrcthick}[5][above]{\draw[thick,->-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


%%%


\newcommand{\jointbtriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbttriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointttriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbtriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointltriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrtriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinbltriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrtriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlltriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrtriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrltriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrtriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlttriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbtriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrttriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbtriangleb}[5][above]{\draw[thin,-triangleblack-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

\newcommand{\jointbtrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbttrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointttrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbtrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointltrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrtrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinbltrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrtrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlltrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrtrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrltrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrtrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlttrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbtrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrttrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbtrianglew}[5][above]{\draw[thin,-trianglewhite-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}



%\jointbxarrow - puts an X at the centre of the line.

\newcommand{\joinccxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


\newcommand{\jointbxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% \jointc[above]{A}{3}{B}{60}

\newcommand{\jointcxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinbcxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinctxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincbxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinclxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincrxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlcxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinrcxarrow}[5][above]{\draw[thin,-xarrow-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}




% \jointbdiamond[above]{A}{3}{B}{-4}

\newcommand{\joinccdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


\newcommand{\jointbdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointldiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinbldiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlldiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrldiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% \jointc[above]{A}{3}{B}{60}

\newcommand{\jointcdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinbcdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinctdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincbdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joincldiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincrdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlcdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinrcdiamond}[5][above]{\draw[thin,-wdiamond-=.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}






% dashed line
\newcommand{\jointbdashed}[5][above]{\draw[thin,dashed] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtdashed}[5][above]{\draw[thin,dashed] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtdashed}[5][above]{\draw[thin,dashed] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbdashed}[5][above]{\draw[thin,dashed] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointldashed}[5][above]{\draw[thin,dashed] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrdashed}[5][above]{\draw[thin,dashed] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinbldashed}[5][above]{\draw[thin,dashed] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrdashed}[5][above]{\draw[thin,dashed] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlldashed}[5][above]{\draw[thin,dashed] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrdashed}[5][above]{\draw[thin,dashed] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrldashed}[5][above]{\draw[thin,dashed] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrdashed}[5][above]{\draw[thin,dashed] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltdashed}[5][above]{\draw[thin,dashed] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbdashed}[5][above]{\draw[thin,dashed] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtdashed}[5][above]{\draw[thin,dashed] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbdashed}[5][above]{\draw[thin,dashed] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% very thick dotted line


\newcommand{\jointbthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbthickdotted}[5][above]{\draw[very thick, dotted] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}



%\linebyhand[thin, ->-=.5]{position1}{position2}

\newcommand{\linebyhand}[3][thin, ->-=.5]{\draw[#1] (#2) to (#3); \path ($0.5*(#2)+0.5*(#3)$) coordinate (fontlocation); }

\newcommand{\linebyhanddashed}[3][thin, dashed]{\draw[#1] (#2) to (#3); \path ($0.5*(#2)+0.5*(#3)$) coordinate (fontlocation); }

% this puts small circles on each end.
\newcommand{\linedashedcircles}[3][thin, dashed]{ \draw (#2) circle (0.25); \draw (#3) circle (0.25);
\draw[#1] ($(#2)+(0,0.25)$) to ($(#3)-(0,0.25)$); \path ($0.5*(#2)+0.5*(#3)$) coordinate (fontlocation); }


%\indashedout[thin,dashed]{A}{-2,-3}{-3,4}{aa} draws dashedline with circles from A+(-2,-3) to A+(-2,4).
%Names these points A inaa and A outaa
\newcommand{\indashedout}[5][thin, dashed]{ \draw ($(#2)+(#3)$) circle (0.25); \draw ($(#2)+(#4)$) circle (0.25);
\draw ($(#2)+(#3)$) coordinate (#2 in#5); \path (0,0) coordinate (#2 in#5 top); \path (0,0) coordinate (#2 in#5 right);
\draw ($(#2)+(#4)$) coordinate (#2 out#5); \path (0,0) coordinate (#2 out#5 top); \path (0,0) coordinate (#2 out#5 right);
\draw[#1] ($(#2 in#5)+(0,0.25)$) to ($(#2 out#5)-(0,0.25)$); \path ($0.5*(#2 in#5)+0.5*(#2 out#5)$) coordinate (fontlocation); }


% same as above, but no out circle.
\newcommand{\indasheddot}[5][thin, dashed]{ \draw ($(#2)+(#3)$) circle (0.25);  \draw[fill] ($(#2)+(#4)$) circle (0.125);
\draw ($(#2)+(#3)$) coordinate (#2 in#5); \path (0,0) coordinate (#2 in#5 top); \path (0,0) coordinate (#2 in#5 right);
\draw ($(#2)+(#4)$) coordinate (#2 out#5); \path (0,0) coordinate (#2 out#5 top); \path (0,0) coordinate (#2 out#5 right);
\draw[#1] ($(#2 in#5)+(0,0.25)$) to ($(#2 out#5)-(0,0.25)$); \path ($0.5*(#2 in#5)+0.5*(#2 out#5)$) coordinate (fontlocation); }

\newcommand{\dotdashedout}[5][thin, dashed]{ \draw[fill] ($(#2)+(#3)$) circle (0.125);
\draw ($(#2)+(#4)$) circle (0.25);
\draw ($(#2)+(#3)$) coordinate (#2 in#5); \path (0,0) coordinate (#2 in#5 top); \path (0,0) coordinate (#2 in#5 right);
\draw ($(#2)+(#4)$) coordinate (#2 out#5); \path (0,0) coordinate (#2 out#5 top); \path (0,0) coordinate (#2 out#5 right);
\draw[#1] ($(#2 in#5)+(0,0.25)$) to ($(#2 out#5)-(0,0.25)$); \path ($0.5*(#2 in#5)+0.5*(#2 out#5)$) coordinate (fontlocation); }

%%%\indottedout  same as above, but with dots.

\newcommand{\indottedout}[5][thin, densely dotted]{ \draw ($(#2)+(#3)$) circle (0.25); \draw ($(#2)+(#4)$) circle (0.25);
\draw ($(#2)+(#3)$) coordinate (#2 in#5); \path (0,0) coordinate (#2 in#5 top); \path (0,0) coordinate (#2 in#5 right);
\draw ($(#2)+(#4)$) coordinate (#2 out#5); \path (0,0) coordinate (#2 out#5 top); \path (0,0) coordinate (#2 out#5 right);
\draw[#1] ($(#2 in#5)+(0,0.25)$) to ($(#2 out#5)-(0,0.25)$); \path ($0.5*(#2 in#5)+0.5*(#2 out#5)$) coordinate (fontlocation); }


% same as above, but no out circle.
\newcommand{\indotteddot}[5][thin, densely dotted]{ \draw ($(#2)+(#3)$) circle (0.25);  \draw[fill] ($(#2)+(#4)$) circle (0.125);
\draw ($(#2)+(#3)$) coordinate (#2 in#5); \path (0,0) coordinate (#2 in#5 top); \path (0,0) coordinate (#2 in#5 right);
\draw ($(#2)+(#4)$) coordinate (#2 out#5); \path (0,0) coordinate (#2 out#5 top); \path (0,0) coordinate (#2 out#5 right);
\draw[#1] ($(#2 in#5)+(0,0.25)$) to ($(#2 out#5)-(0,0.25)$); \path ($0.5*(#2 in#5)+0.5*(#2 out#5)$) coordinate (fontlocation); }

\newcommand{\dotdottedout}[5][thin, densely dotted]{ \draw[fill] ($(#2)+(#3)$) circle (0.125);
\draw ($(#2)+(#4)$) circle (0.25);
\draw ($(#2)+(#3)$) coordinate (#2 in#5); \path (0,0) coordinate (#2 in#5 top); \path (0,0) coordinate (#2 in#5 right);
\draw ($(#2)+(#4)$) coordinate (#2 out#5); \path (0,0) coordinate (#2 out#5 top); \path (0,0) coordinate (#2 out#5 right);
\draw[#1] ($(#2 in#5)+(0,0.25)$) to ($(#2 out#5)-(0,0.25)$); \path ($0.5*(#2 in#5)+0.5*(#2 out#5)$) coordinate (fontlocation); }



%% \flagsquare[2]{A inaa}{0,3}{T=0}{4,0}   draws a flag of width 2 with T=0 at A inas+(0,4) with a black dot at A inaa+(0,3)

\newcommand{\flagsquare}[5][2]{
\draw[ultra thick, white] ($(#2)+(#3)$) to ($(#2)+(#3)+(#5)$);
\draw ($(#2)+(#3)$) to ($(#2)+(#3)+(#5)$);
%\draw[fill] ($(#2)+(#3)$) circle (0.125);
\draw[fill=white]  ($(#2)+(#3)+(-0.25,-0.25)$) rectangle ($(#2)+(#3)+(0.25,0.25)$);
\draw  ($(#2)+(#3)+(0,-0.25)$) to ($(#2)+(#3)+(0,0.25)$);
\draw[thin, fill=white]  ($(#2)+(#3)+(#5)+(-#1,-1)$) rectangle ($(#2)+(#3)+(#5)+(#1,1)$);
\path ($(#2)+(#3)+(#5)$) node {\ensuremath{#4}};
\path ($(#2)+(#3)+(#5)$) coordinate (fontlocation);
}


%\leftflagsquare{A in7}{2,0}{S_2=1}{-4,0}
\newcommand{\leftflagsquare}[5][2]{
\draw[ultra thick, white] ($(#2)+(#3)+(-0.25,0)$) to [out=180, in=0] ($(#2)+(#3)+(#5)+(#1,0)$);
\draw[->] ($(#2)+(#3)+(-0.25,0)$) to [out=180, in=0]  ($(#2)+(#3)+(#5)+(#1,0)$);
%\draw[fill] ($(#2)+(#3)$) circle (0.125);
\draw[fill=white]  ($(#2)+(#3)+(-0.25,-0.25)$) rectangle ($(#2)+(#3)+(0.25,0.25)$);
\draw  ($(#2)+(#3)+(0,-0.25)$) to ($(#2)+(#3)+(0,0.25)$);
\draw[thin]  ($(#2)+(#3)+(#5)+(-#1,-1)$) rectangle ($(#2)+(#3)+(#5)+(#1,1)$);
\path ($(#2)+(#3)+(#5)$) node {\ensuremath{#4}};
\path ($(#2)+(#3)+(#5)$) coordinate (fontlocation);
}

\newcommand{\rightflagsquare}[5][2]{
\draw[ultra thick, white] ($(#2)+(#3)+(0.25,0)$) to [out=0, in=180] ($(#2)+(#3)+(#5)+(-#1,0)$);
\draw[->] ($(#2)+(#3)+(0.25,0)$) to [out=0, in=180]  ($(#2)+(#3)+(#5)+(-#1,0)$);
%\draw[fill] ($(#2)+(#3)$) circle (0.125);
\draw[fill=white]  ($(#2)+(#3)+(-0.25,-0.25)$) rectangle ($(#2)+(#3)+(0.25,0.25)$);
\draw  ($(#2)+(#3)+(0,-0.25)$) to ($(#2)+(#3)+(0,0.25)$);
\draw[thin]  ($(#2)+(#3)+(#5)+(-#1,-1)$) rectangle ($(#2)+(#3)+(#5)+(#1,1)$);
\path ($(#2)+(#3)+(#5)$) node {\ensuremath{#4}};
\path ($(#2)+(#3)+(#5)$) coordinate (fontlocation);
}

\newcommand{\leftflagsquaredotted}[5][2]{
\draw[ultra thick, white] ($(#2)+(#3)+(-0.25,0)$) to [out=180, in=0] ($(#2)+(#3)+(#5)+(#1,0)$);
\draw[->] ($(#2)+(#3)+(-0.25,0)$) to [out=180, in=0]  ($(#2)+(#3)+(#5)+(#1,0)$);
%\draw[fill] ($(#2)+(#3)$) circle (0.125);
\draw[fill=white]  ($(#2)+(#3)+(-0.25,-0.25)$) rectangle ($(#2)+(#3)+(0.25,0.25)$);
\draw  ($(#2)+(#3)+(0,-0.25)$) to ($(#2)+(#3)+(0,0.25)$);
\draw[thin, densely dotted]  ($(#2)+(#3)+(#5)+(-#1,-1)$) rectangle ($(#2)+(#3)+(#5)+(#1,1)$);
\path ($(#2)+(#3)+(#5)$) node {\ensuremath{#4}};
\path ($(#2)+(#3)+(#5)$) coordinate (fontlocation);
}

\newcommand{\rightflagsquaredotted}[5][2]{
\draw[ultra thick, white] ($(#2)+(#3)+(0.25,0)$) to [out=0, in=180] ($(#2)+(#3)+(#5)+(-#1,0)$);
\draw[->] ($(#2)+(#3)+(0.25,0)$) to [out=0, in=180]  ($(#2)+(#3)+(#5)+(-#1,0)$);
%\draw[fill] ($(#2)+(#3)$) circle (0.125);
\draw[fill=white]  ($(#2)+(#3)+(-0.25,-0.25)$) rectangle ($(#2)+(#3)+(0.25,0.25)$);
\draw  ($(#2)+(#3)+(0,-0.25)$) to ($(#2)+(#3)+(0,0.25)$);
\draw[thin, densely dotted]  ($(#2)+(#3)+(#5)+(-#1,-1)$) rectangle ($(#2)+(#3)+(#5)+(#1,1)$);
\path ($(#2)+(#3)+(#5)$) node {\ensuremath{#4}};
\path ($(#2)+(#3)+(#5)$) coordinate (fontlocation);
}

\newcommand{\leftflagdot}[5][2]{
%\draw[ultra thick, white] ($(#2)+(#3)+(-0.25,0)$) to [out=180, in=0] ($(#2)+(#3)+(#5)+(#1,0)$);
\draw[-<-=.65] ($(#2)+(#3)+(0,0)$) to [out=180, in=0]  ($(#2)+(#3)+(#5)+(#1,0)$);
\draw[fill] ($(#2)+(#3)$) circle (0.125);
%\draw[fill=white]  ($(#2)+(#3)+(-0.25,-0.25)$) rectangle ($(#2)+(#3)+(0.25,0.25)$);
\draw  ($(#2)+(#3)+(0,-0.25)$) to ($(#2)+(#3)+(0,0.25)$);
\draw[thin]  ($(#2)+(#3)+(#5)+(-#1,-1)$) rectangle ($(#2)+(#3)+(#5)+(#1,1)$);
\path ($(#2)+(#3)+(#5)$) node {\ensuremath{#4}};
\path ($(#2)+(#3)+(#5)$) coordinate (fontlocation);
}

\newcommand{\rightflagdot}[5][2]{
%\draw[ultra thick, white] ($(#2)+(#3)+(0.25,0)$) to [out=0, in=180] ($(#2)+(#3)+(#5)+(-#1,0)$);
\draw[-<-=.65] ($(#2)+(#3)+(0,0)$) to [out=0, in=180]  ($(#2)+(#3)+(#5)+(-#1,0)$);
\draw[fill] ($(#2)+(#3)$) circle (0.125);
%\draw[fill=white]  ($(#2)+(#3)+(-0.25,-0.25)$) rectangle ($(#2)+(#3)+(0.25,0.25)$);
\draw  ($(#2)+(#3)+(0,-0.25)$) to ($(#2)+(#3)+(0,0.25)$);
\draw[thin]  ($(#2)+(#3)+(#5)+(-#1,-1)$) rectangle ($(#2)+(#3)+(#5)+(#1,1)$);
\path ($(#2)+(#3)+(#5)$) node {\ensuremath{#4}};
\path ($(#2)+(#3)+(#5)$) coordinate (fontlocation);
}

\newcommand{\leftflag}[5][2]{
%\draw[ultra thick, white] ($(#2)+(#3)+(-0.25,0)$) to [out=180, in=0] ($(#2)+(#3)+(#5)+(#1,0)$);
\draw[-<-=.65] ($(#2)+(#3)+(0,0)$) to [out=180, in=0]  ($(#2)+(#3)+(#5)+(#1,0)$);
%\draw[fill] ($(#2)+(#3)$) circle (0.125);
%\draw[fill=white]  ($(#2)+(#3)+(-0.25,-0.25)$) rectangle ($(#2)+(#3)+(0.25,0.25)$);
\draw  ($(#2)+(#3)+(0,-0.25)$) to ($(#2)+(#3)+(0,0.25)$);
\draw[thin]  ($(#2)+(#3)+(#5)+(-#1,-1)$) rectangle ($(#2)+(#3)+(#5)+(#1,1)$);
\path ($(#2)+(#3)+(#5)$) node {\ensuremath{#4}};
\path ($(#2)+(#3)+(#5)$) coordinate (fontlocation);
}

\newcommand{\rightflag}[5][2]{
%\draw[ultra thick, white] ($(#2)+(#3)+(0.25,0)$) to [out=0, in=180] ($(#2)+(#3)+(#5)+(-#1,0)$);
\draw[-<-=.65] ($(#2)+(#3)+(0,0)$) to [out=0, in=180]  ($(#2)+(#3)+(#5)+(-#1,0)$);
%\draw[fill] ($(#2)+(#3)$) circle (0.125);
%\draw[fill=white]  ($(#2)+(#3)+(-0.25,-0.25)$) rectangle ($(#2)+(#3)+(0.25,0.25)$);
\draw  ($(#2)+(#3)+(0,-0.25)$) to ($(#2)+(#3)+(0,0.25)$);
\draw[thin]  ($(#2)+(#3)+(#5)+(-#1,-1)$) rectangle ($(#2)+(#3)+(#5)+(#1,1)$);
\path ($(#2)+(#3)+(#5)$) node {\ensuremath{#4}};
\path ($(#2)+(#3)+(#5)$) coordinate (fontlocation);
}


% \flag[2]{A}{2,3}{hello}\leftellipseline[thin]{A}{2}{A in7}{2}

\newcommand{\flag}[4][2]{
\draw[thin] ($(#2)+(#3)+(-#1,-1)$) rectangle ($(#2)+(#3)+(#1,1)$);
\path ($(#2)+(#3)$) node {\ensuremath{#4}};
\path ($(#2)+(#3)+(-#1,0)$) coordinate (#2 flagleft);
\path ($(#2)+(#3)+(#1,0)$) coordinate (#2 flagright);
\path ($(#2)+(#3)$) node {\ensuremath{#4}};
}


%\leftellipseline[thin]{A in7}{3}{A}{0.5} draws line from (A in7)+(0,3) to (A flagright) + (0,0.5)
\newcommand{\leftellipseline}[5][thin, ->]{
\draw[ultra thick, white] ($(#4 flagright)+(0.125,#5)$) to [out=0, in=180]  ($(#2)+(0,#3)+(-0.4,0)$);
\draw[#1] ($(#2)+(0,#3)+(-0.4,0)$) to [out=180, in=0]($(#4 flagright)+(0,#5)$);
\draw ($(#2)+(0,#3)+(-0.4,0)$) arc (180:420:0.4 and 0.2); \draw ($(#2)+(0,#3)+(-0.4,0)$) arc (180:120:0.4 and 0.2);
}

\newcommand{\rightellipseline}[5][thin, ->]{
\draw[ultra thick, white] ($(#4 flagleft)+(-0.125,#5)$) to [out=0, in=180]  ($(#2)+(0,#3)+(0.4,0)$);
\draw[#1] ($(#2)+(0,#3)+(0.4,0)$) to [out=0, in=180]($(#4 flagleft)+(0,#5)$);
\draw ($(#2)+(0,#3)+(0.4,0)$) arc (0:60:0.4 and 0.2);  \draw ($(#2)+(0,#3)+(0.4,0)$) arc (0:-240:0.4 and 0.2);
}








\newcommand{\leftflagthick}[5][2]{
%\draw[ultra thick, white] ($(#2)+(#3)+(-0.25,0)$) to [out=180, in=0] ($(#2)+(#3)+(#5)+(#1,0)$);
\draw ($(#2)+(#3)+(0,0)$) to [out=180, in=0]  ($(#2)+(#3)+(#5)+(#1,0)$);
\draw[fill] ($(#2)+(#3)+(-0.125,-1)$) rectangle ($(#2)+(#3)+(0.125,1)$);
%\draw[fill=white]  ($(#2)+(#3)+(-0.25,-0.25)$) rectangle ($(#2)+(#3)+(0.25,0.25)$);
\draw  ($(#2)+(#3)+(0,-0.25)$) to ($(#2)+(#3)+(0,0.25)$);
\draw[thin]  ($(#2)+(#3)+(#5)+(-#1,-1)$) rectangle ($(#2)+(#3)+(#5)+(#1,1)$);
\path ($(#2)+(#3)+(#5)$) node {\ensuremath{#4}};
\path ($(#2)+(#3)+(#5)$) coordinate (fontlocation);
}

\newcommand{\rightflagthick}[5][2]{
%\draw[ultra thick, white] ($(#2)+(#3)+(0.25,0)$) to [out=0, in=180] ($(#2)+(#3)+(#5)+(-#1,0)$);
\draw ($(#2)+(#3)+(0,0)$) to [out=0, in=180]  ($(#2)+(#3)+(#5)+(-#1,0)$);
\draw[fill] ($(#2)+(#3)+(-0.125,-1)$) rectangle ($(#2)+(#3)+(0.125,1)$);
%\draw[fill=white]  ($(#2)+(#3)+(-0.25,-0.25)$) rectangle ($(#2)+(#3)+(0.25,0.25)$);
\draw  ($(#2)+(#3)+(0,-0.25)$) to ($(#2)+(#3)+(0,0.25)$);
\draw[thin]  ($(#2)+(#3)+(#5)+(-#1,-1)$) rectangle ($(#2)+(#3)+(#5)+(#1,1)$);
\path ($(#2)+(#3)+(#5)$) node {\ensuremath{#4}};
\path ($(#2)+(#3)+(#5)$) coordinate (fontlocation);
}

%\groupblock[ultra thick]{A}{-3}{-1}

\newcommand{\groupblockb}[4][ultra thick]{\draw[#1] ($(#2)-(#2 top)+(#3,0)-(0.4,0)$) to ($(#2)-(#2 top)+(#4,0)+(0.4,0)$);  }

\newcommand{\groupblockt}[4][ultra thick]{\draw[#1] ($(#2)+(#2 top)+(#3,0)-(0.4,0)$) to ($(#2)+(#2 top)+(#4,0)+(0.4,0)$);  }


% \jointbnoarrow[above]{A}{3}{B}{-4}

\newcommand{\joinccnoarrow}[5][above]{\draw[thin] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccontopnoarrow}[5][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5} \joinccnoarrow[#1]{#2}{#3}{#4}{#5}}


\newcommand{\jointbnoarrow}[5][above]{\draw[thin] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtnoarrow}[5][above]{\draw[thin] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrow}[5][above]{\draw[thin] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrow}[5][above]{\draw[thin] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrow}[5][above]{\draw[thin] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrow}[5][above]{\draw[thin] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrow}[5][above]{\draw[thin] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrow}[5][above]{\draw[thin] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrow}[5][above]{\draw[thin] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrow}[5][above]{\draw[thin] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrow}[5][above]{\draw[thin] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrow}[5][above]{\draw[thin] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrow}[5][above]{\draw[thin] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrow}[5][above]{\draw[thin] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrow}[5][above]{\draw[thin] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrow}[5][above]{\draw[thin] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% \jointc[above]{A}{3}{B}{60}

\newcommand{\jointcnoarrow}[5][above]{\draw[thin] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinbcnoarrow}[5][above]{\draw[thin] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinctnoarrow}[5][above]{\draw[thin] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincbnoarrow}[5][above]{\draw[thin] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinclnoarrow}[5][above]{\draw[thin] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincrnoarrow}[5][above]{\draw[thin] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlcnoarrow}[5][above]{\draw[thin] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinrcnoarrow}[5][above]{\draw[thin] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


\newcommand{\jointbnoarrowthick}[5][above]{\draw[thick] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtnoarrowthick}[5][above]{\draw[thick] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrowthick}[5][above]{\draw[thick] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrowthick}[5][above]{\draw[thick] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrowthick}[5][above]{\draw[thick] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrowthick}[5][above]{\draw[thick] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrowthick}[5][above]{\draw[thick] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrowthick}[5][above]{\draw[thick] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrowthick}[5][above]{\draw[thick] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrowthick}[5][above]{\draw[thick] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrowthick}[5][above]{\draw[thick] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrowthick}[5][above]{\draw[thick] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrowthick}[5][above]{\draw[thick] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrowthick}[5][above]{\draw[thick] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrowthick}[5][above]{\draw[thick] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrowthick}[5][above]{\draw[thick] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% \jointc[above]{A}{3}{B}{60}

\newcommand{\jointcnoarrowthick}[5][above]{\draw[thick] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinbcnoarrowthick}[5][above]{\draw[thick] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinctnoarrowthick}[5][above]{\draw[thick] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincbnoarrowthick}[5][above]{\draw[thick] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinclnoarrowthick}[5][above]{\draw[thick] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincrnoarrowthick}[5][above]{\draw[thick] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlcnoarrowthick}[5][above]{\draw[thick] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinrcnoarrowthick}[5][above]{\draw[thick] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}



\newcommand{\jointbnoarrowdouble}[5][above]{\draw[double] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtnoarrowdouble}[5][above]{\draw[double] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrowdouble}[5][above]{\draw[double] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrowdouble}[5][above]{\draw[double] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrowdouble}[5][above]{\draw[double] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrowdouble}[5][above]{\draw[double] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrowdouble}[5][above]{\draw[double] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrowdouble}[5][above]{\draw[double] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrowdouble}[5][above]{\draw[double] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrowdouble}[5][above]{\draw[double] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrowdouble}[5][above]{\draw[double] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrowdouble}[5][above]{\draw[double] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrowdouble}[5][above]{\draw[double] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrowdouble}[5][above]{\draw[double] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrowdouble}[5][above]{\draw[double] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrowdouble}[5][above]{\draw[double] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% \jointc[above]{A}{3}{B}{60}

\newcommand{\jointcnoarrowdouble}[5][above]{\draw[double] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinbcnoarrowdouble}[5][above]{\draw[double] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinctnoarrowdouble}[5][above]{\draw[double] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincbnoarrowdouble}[5][above]{\draw[double] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinclnoarrowdouble}[5][above]{\draw[double] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincrnoarrowdouble}[5][above]{\draw[double] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlcnoarrowdouble}[5][above]{\draw[double] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinrcnoarrowdouble}[5][above]{\draw[double] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


% \tointc[above]{A}{3}{B}{60}

\newcommand{\jointbnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% \jointc[above]{A}{3}{B}{60}

\newcommand{\jointcnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinbcnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinctnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincbnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinclnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincrnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlcnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinrcnoarrowthickwhite}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}



%% following insert a white then a black square

\newcommand{\jointbnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrowwb}[5][above]{\draw[thin, -wsqb-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}


%% inserts a black then white square

\newcommand{\jointbnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrowbw}[5][above]{\draw[thin, -bsqw-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}


%% following insert a white then a black dot

\newcommand{\jointbnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrowdotswb}[5][above]{\draw[thin, -o*-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}


%% inserts a black then white dot

\newcommand{\jointbnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrowdotsbw}[5][above]{\draw[thin, -*o-=0.5] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}




\newcommand{\jointbnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrowdotsbwwb}[5][above]{\draw[thin, -*o-=0.3,-o*-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}



\newcommand{\jointbnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrowdotswbbw}[5][above]{\draw[thin, -o*-=0.3,-*o-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}




\newcommand{\jointbnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrowsqbwwb}[5][above]{\draw[thin, -bsqw-=0.3,-wsqb-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}



\newcommand{\jointbnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinbtnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrowsqwbbw}[5][above]{\draw[thin, -wsqb-=0.3,-bsqw-=-0.3] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}


% the first one gives a white border to a thin black line. The others need to be worked on.

%jointbover{A}{2}{B}{0} draws a thin line with a white border (so it goes over other wires).

\newcommand{\jointbnover}[5][above]{\draw[ultra thick, white]
($(#2)+(#2 top)+(#3,0)+(0,0.06)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)+(0,-0.06)$);
\draw[thin] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);
}
% the below commands haven't been completed yet.

\newcommand{\jointbnoarrowontop}[5][above]{\draw[ultra thick, white]
($(#2)+(#2 top)+(#3,0)+(0,0.06)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)+(0,-0.06)$);
\draw[thin] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);
}


\newcommand{\joinbtnoarrowwhiteborder}[5][above]{\draw[ultra thick, white]
($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\jointtnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinbbnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointlnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\jointrnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinblnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinbrnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinllnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinlrnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinrlnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinrrnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinltnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinlbnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinrtnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinrbnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\jointcnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinbcnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinctnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincbnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinclnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincrnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinlcnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinrcnoarrowwhiteborder}[5][above]{\draw[ultra thick, white] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


\newcommand{\joinrlnoarrowontop}[5][above]{\joinrlnoarrowwhiteborder[#1]{#2}{#3}{#4}{#5}
                                     \joinrlnoarrow[#1]{#2}{#3}{#4}{#5} }


% \jointbdouble[above]{A}{2}{B}{3}

\newcommand{\jointbdouble}[5][above]{\draw[double, thin,->-=.75] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

%below has arrow head at end

\newcommand{\jointbdoubleend}[5][above]{\draw[double, thin,->] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%% Hopping matrix %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% in equations - can put a superscript above.
% \bbmatrix[size]{h}{x,y}




%horizontal round
\newcommand{\bbmatrix}[3][1]{ \draw[thin, ->-=0.5, *-*] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\bwmatrix}[3][1]{ \draw[thin, ->-=0.5, *-o] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wbmatrix}[3][1]{ \draw[thin, ->-=0.5, o-*] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wwmatrix}[3][1]{ \draw[thin, ->-=0.5, o-o] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\bbmatrixr}[3][1]{ \draw[thin, -<-=0.5, *-*] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\bwmatrixr}[3][1]{ \draw[thin, -<-=0.5, *-o] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wbmatrixr}[3][1]{ \draw[thin, -<-=0.5, o-*] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wwmatrixr}[3][1]{ \draw[thin, -<-=0.5, o-o] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}

%horizontal square
\newcommand{\bbmatrixsq}[3][1]{ \draw[thin, ->-=0.5, -bsq=0, -bsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\bwmatrixsq}[3][1]{ \draw[thin, ->-=0.5, -bsq=0, -wsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wbmatrixsq}[3][1]{ \draw[thin, ->-=0.5, -wsq=0, -bsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wwmatrixsq}[3][1]{ \draw[thin, ->-=0.5, -wsq=0, -wsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\bbmatrixrsq}[3][1]{ \draw[thin, -<-=0.5, -bsq=0, -bsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\bwmatrixrsq}[3][1]{ \draw[thin, -<-=0.5, -bsq=0, -wsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wbmatrixrsq}[3][1]{ \draw[thin, -<-=0.5, -wsq=0, -bsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wwmatrixrsq}[3][1]{ \draw[thin, -<-=0.5, -wsq=0, -wsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}



%horizontal round no arrow
\newcommand{\bbmatrixnoarrow}[3][1]{ \draw[thin, ->-=0.5, *-*] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\bwmatrixnoarrow}[3][1]{ \draw[thin,  *-o] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wbmatrixnoarrow}[3][1]{ \draw[thin,  o-*] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wwmatrixnoarrow}[3][1]{ \draw[thin,  o-o] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\bbmatrixnoarrowr}[3][1]{ \draw[thin, -<-=0.5, *-*] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\bwmatrixnoarrowr}[3][1]{ \draw[thin, -<-=0.5, *-o] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wbmatrixnoarrowr}[3][1]{ \draw[thin, -<-=0.5, o-*] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wwmatrixnoarrowr}[3][1]{ \draw[thin, -<-=0.5, o-o] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}

%horizontal square no arrow
\newcommand{\bbmatrixnoarrowsq}[3][1]{ \draw[thin,  -bsq=0, -bsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\bwmatrixnoarrowsq}[3][1]{ \draw[thin,  -bsq=0, -wsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wbmatrixnoarrowsq}[3][1]{ \draw[thin,  -wsq=0, -bsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wwmatrixnoarrowsq}[3][1]{ \draw[thin,  -wsq=0, -wsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\bbmatrixnoarrowrsq}[3][1]{ \draw[thin, -<-=0.5, -bsq=0, -bsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\bwmatrixnoarrowrsq}[3][1]{ \draw[thin, -<-=0.5, -bsq=0, -wsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wbmatrixnoarrowrsq}[3][1]{ \draw[thin, -<-=0.5, -wsq=0, -bsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\wwmatrixnoarrowrsq}[3][1]{ \draw[thin, -<-=0.5, -wsq=0, -wsq=1] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}



%vertical
\newcommand{\vbbmatrix}[3][1]{ \draw[thin, ->-=0.5, *-*] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vbwmatrix}[3][1]{ \draw[thin, ->-=0.5, *-o] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vwbmatrix}[3][1]{ \draw[thin, ->-=0.5, o-*] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vwwmatrix}[3][1]{ \draw[thin, ->-=0.5, o-o] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vbbmatrixr}[3][1]{ \draw[thin, -<-=0.5, *-*] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vbwmatrixr}[3][1]{ \draw[thin, -<-=0.5, *-o] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vwbmatrixr}[3][1]{ \draw[thin, -<-=0.5, o-*] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vwwmatrixr}[3][1]{ \draw[thin, -<-=0.5, o-o] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}

%vertical
\newcommand{\vbbmatrixsq}[3][1]{ \draw[thin, ->-=0.5, -bsq=0, -bsq=1] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vbwmatrixsq}[3][1]{ \draw[thin, ->-=0.5, -bsq=0, -wsq=1] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vwbmatrixsq}[3][1]{ \draw[thin, ->-=0.5, -wsq=0, -bsq=1] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vwwmatrixsq}[3][1]{ \draw[thin, ->-=0.5, -wsq=0, -wsq=1] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vbbmatrixrsq}[3][1]{ \draw[thin, -<-=0.5, -bsq=0, -bsq=1] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vbwmatrixrsq}[3][1]{ \draw[thin, -<-=0.5, -bsq=0, -wsq=1] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vwbmatrixrsq}[3][1]{ \draw[thin, -<-=0.5, -wsq=0, -bsq=1] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}
\newcommand{\vwwmatrixrsq}[3][1]{ \draw[thin, -<-=0.5, -wsq=0, -wsq=1] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}


% custom \custommatrix[size]{h}{1,3}{,->-=0.5, -bsq=0}  don't forget first comma.
\newcommand{\custommatrix}[4][1]{ \draw[thin #4] ($(#3)+(XYshift)+(-0.9*#1*2 + 0.2 ,0)$) --  node [above=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0.9*#1*2 -0.2,0)$);}
\newcommand{\vcustommatrix}[4][1]{\draw[thin #4] ($(#3)+(XYshift)+(0,-0.9*#1*2 + 0.2)$) --  node [left=0.07] (fontlocation){}   ($(#3)+(XYshift)+ (0,0.9*#1*2 -0.2)$);}



% in text

% round
\newcommand{\bbdots}{\tikz[baseline=-3pt]\path[draw, ->-=0.5, *-*] (0,0) -- (6mm,0);\xspace}
\newcommand{\bwdots}{\tikz[baseline=-3pt]\path[draw, ->-=0.5, *-o] (0,0) -- (6mm,0);\xspace}
\newcommand{\wbdots}{\tikz[baseline=-3pt]\path[draw, ->-=0.5, o-*] (0,0) -- (6mm,0);\xspace}
\newcommand{\wwdots}{\tikz[baseline=-3pt]\path[draw, ->-=0.5, o-o] (0,0) -- (6mm,0);\xspace}

\newcommand{\bbdotsr}{\tikz[baseline=-3pt]\path[draw, -<-=0.5, *-*] (0,0) -- (6mm,0);\xspace}
\newcommand{\bwdotsr}{\tikz[baseline=-3pt]\path[draw, -<-=0.5, *-o] (0,0) -- (6mm,0);\xspace}
\newcommand{\wbdotsr}{\tikz[baseline=-3pt]\path[draw, -<-=0.5, o-*] (0,0) -- (6mm,0);\xspace}
\newcommand{\wwdotsr}{\tikz[baseline=-3pt]\path[draw, -<-=0.5, o-o] (0,0) -- (6mm,0);\xspace}

\newcommand{\nbdots}{\tikz[baseline=-3pt]\path[draw, ->-=0.5,-*] (0,0) -- (6mm,0);\xspace}
\newcommand{\nwdots}{\tikz[baseline=-3pt]\path[draw, ->-=0.5,-o] (0,0) -- (6mm,0);\xspace}
\newcommand{\bndots}{\tikz[baseline=-3pt]\path[draw, ->-=0.5,*-] (0,0) -- (6mm,0);\xspace}
\newcommand{\wndots}{\tikz[baseline=-3pt]\path[draw, ->-=0.5,o-] (0,0) -- (6mm,0);\xspace}

% square
\newcommand{\bbdotssq}{\tikz[baseline=-3pt]\path[draw, ->-=0.5, -bsq=0, -bsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\bwdotssq}{\tikz[baseline=-3pt]\path[draw, ->-=0.5, -bsq=0, -wsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\wbdotssq}{\tikz[baseline=-3pt]\path[draw, ->-=0.5, -wsq=0, -bsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\wwdotssq}{\tikz[baseline=-3pt]\path[draw, ->-=0.5, -wsq=0, -wsq=1] (0,0) -- (6mm,0);\xspace}

\newcommand{\bbdotssqr}{\tikz[baseline=-3pt]\path[draw, -<-=0.5, -bsq=0, -bsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\bwdotssqr}{\tikz[baseline=-3pt]\path[draw, -<-=0.5, -bsq=0, -wsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\wbdotssqr}{\tikz[baseline=-3pt]\path[draw, -<-=0.5, -wsq=0, -bsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\wwdotssqr}{\tikz[baseline=-3pt]\path[draw, -<-=0.5, -wsq=0, -wsq=1] (0,0) -- (6mm,0);\xspace}

\newcommand{\nbdotssq}{\tikz[baseline=-3pt]\path[draw, ->-=0.5,-bsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\nwdotssq}{\tikz[baseline=-3pt]\path[draw, ->-=0.5,-wsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\bndotssq}{\tikz[baseline=-3pt]\path[draw, ->-=0.5,-bsq=0] (0,0) -- (6mm,0);\xspace}
\newcommand{\wndotssq}{\tikz[baseline=-3pt]\path[draw, ->-=0.5,-wsq=0] (0,0) -- (6mm,0);\xspace}


% custom \customdots[, ->-=0.5, *-*]   remember first comma
\newcommand{\customdots}[1][, ->-=0.5, *-*]{\tikz[baseline=-3pt]\path[draw #1] (0,0) -- (6mm,0);\xspace}

% round
\newcommand{\bbdotsnoarrow}{\tikz[baseline=-3pt]\path[draw, *-*] (0,0) -- (6mm,0);\xspace}
\newcommand{\bwdotsnoarrow}{\tikz[baseline=-3pt]\path[draw , *-o] (0,0) -- (6mm,0);\xspace}
\newcommand{\wbdotsnoarrow}{\tikz[baseline=-3pt]\path[draw , o-*] (0,0) -- (6mm,0);\xspace}
\newcommand{\wwdotsnoarrow}{\tikz[baseline=-3pt]\path[draw , o-o] (0,0) -- (6mm,0);\xspace}

\newcommand{\bbdotsnoarrowr}{\tikz[baseline=-3pt]\path[draw, -<-=0.5, *-*] (0,0) -- (6mm,0);\xspace}
\newcommand{\bwdotsnoarrowr}{\tikz[baseline=-3pt]\path[draw,  *-o] (0,0) -- (6mm,0);\xspace}
\newcommand{\wbdotsnoarrowr}{\tikz[baseline=-3pt]\path[draw,  o-*] (0,0) -- (6mm,0);\xspace}
\newcommand{\wwdotsnoarrowr}{\tikz[baseline=-3pt]\path[draw,  o-o] (0,0) -- (6mm,0);\xspace}

\newcommand{\nbdotsnoarrow}{\tikz[baseline=-3pt]\path[draw ,-*] (0,0) -- (6mm,0);\xspace}
\newcommand{\nwdotsnoarrow}{\tikz[baseline=-3pt]\path[draw ,-o] (0,0) -- (6mm,0);\xspace}
\newcommand{\bndotsnoarrow}{\tikz[baseline=-3pt]\path[draw ,*-] (0,0) -- (6mm,0);\xspace}
\newcommand{\wndotsnoarrow}{\tikz[baseline=-3pt]\path[draw ,o-] (0,0) -- (6mm,0);\xspace}

% square
\newcommand{\bbdotsnoarrowsq}{\tikz[baseline=-3pt]\path[draw , -bsq=0, -bsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\bwdotsnoarrowsq}{\tikz[baseline=-3pt]\path[draw , -bsq=0, -wsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\wbdotsnoarrowsq}{\tikz[baseline=-3pt]\path[draw , -wsq=0, -bsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\wwdotsnoarrowsq}{\tikz[baseline=-3pt]\path[draw , -wsq=0, -wsq=1] (0,0) -- (6mm,0);\xspace}

\newcommand{\bbdotsnoarrowsqr}{\tikz[baseline=-3pt]\path[draw,  -bsq=0, -bsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\bwdotsnoarrowsqr}{\tikz[baseline=-3pt]\path[draw,  -bsq=0, -wsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\wbdotsnoarrowsqr}{\tikz[baseline=-3pt]\path[draw,  -wsq=0, -bsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\wwdotsnoarrowsqr}{\tikz[baseline=-3pt]\path[draw,  -wsq=0, -wsq=1] (0,0) -- (6mm,0);\xspace}

\newcommand{\nbdotsnoarrowsq}{\tikz[baseline=-3pt]\path[draw ,-bsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\nwdotsnoarrowsq}{\tikz[baseline=-3pt]\path[draw ,-wsq=1] (0,0) -- (6mm,0);\xspace}
\newcommand{\bndotsnoarrowsq}{\tikz[baseline=-3pt]\path[draw ,-bsq=0] (0,0) -- (6mm,0);\xspace}
\newcommand{\wndotsnoarrowsq}{\tikz[baseline=-3pt]\path[draw ,-wsq=0] (0,0) -- (6mm,0);\xspace}

% custom \customdotsnoarrow[ , *-*]   remember first comma
\newcommand{\customdotsnoarrow}[1][ , *-*]{\tikz[baseline=-3pt]\path[draw #1] (0,0) -- (6mm,0);\xspace}

\newcommand{\customdotsnoarrowvar}[2][ , *-*]{\tikz[baseline=-3pt]\path[draw #1] (0,0) -- (#1,0);\xspace}

% \placesymbol[1,3]{a} places an a at (1,3)

\newcommand{\placesymbol}[2][0,0]{\tikz\path(0,0) to (#1) node {\ensuremath{#2}};}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%% FONT PLACEMENT %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newcommand{\csymbol}[2][0,0]{ \path ($0.0352777778*(#1)+(fontlocation)$) node {\ensuremath{\defaultfont{#2}}};}

\newcommand{\csymbolalt}[2][0,0]{ \path ($0.0352777778*(#1)+(fontlocation)$) node {\ensuremath{\secondfont{#2}}};}

%\csymbolsecond does same as \csymbolalt
\newcommand{\csymbolsecond}[2][0,0]{ \path ($0.0352777778*(#1)+(fontlocation)$) node {\ensuremath{\secondfont{#2}}};}

\newcommand{\csymbolthird}[2][0,0]{ \path ($0.0352777778*(#1)+(fontlocation)$) node {\ensuremath{\thirdfont{#2}}};}

\newcommand{\csymbolfourth}[2][0,0]{ \path ($0.0352777778*(#1)+(fontlocation)$) node {\ensuremath{\fourthfont{#2}}};}

\newcommand{\csymbolfifth}[2][0,0]{ \path ($0.0352777778*(#1)+(fontlocation)$) node {\ensuremath{\fourthfont{#2}}};}

\newcommand{\csymbolnorm}[2][0,0]{ \path ($0.0352777778*(#1)+(fontlocation)$) node {\ensuremath{#2}};}


\newcommand{\otherside}{\coordinate (fontlocation) at (fontlocationb);}

% \csymbol[0,0]{0.3}{a}  - where (font 0.3) is the name of the coordinate (these are at 0.3 and -0.3)

\newcommand{\csymbolbw}[2][0,0]{ \path ($0.0352777778*(#1)+(fontlocationbw)$) node {\ensuremath{#2}};}

\newcommand{\csymbolwb}[2][0,0]{ \path ($0.0352777778*(#1)+(fontlocationwb)$) node {\ensuremath{#2}};}

\newcommand{\csymbolbwunder}[2][0,0]{ \path ($0.0352777778*(#1)+(fontlocationbwunder)$) node {\ensuremath{#2}};}

\newcommand{\csymbolwbunder}[2][0,0]{ \path ($0.0352777778*(#1)+(fontlocationwbunder)$) node {\ensuremath{#2}};}



% The below command is to put text on top of a white square.  It doesn't work very well.  Haven't used it.
\newcommand{\csymbolwhitesquare}[2][0,0]{
\draw[white, fill=white] ($(fontlocation)+(-0.5,-0.5)$)
                                               rectangle ($(fontlocation)+(0.5,0.5)$);
\path ($0.0352777778*(#1)+(fontlocation)$)   node {\ensuremath{#2}};}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%GRIDS %%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\Cgrid[->]{0.5}{11}{11}{4,5}

\newrobustcmd{\Cgrid}[5][->]{
\foreach \x in {0,#2,...,#3}
\draw[#1] ($(#5)+(XYshift)$)  [xshift=-\x cm, yshift=\x cm]  +($(-0.5,-#3-0.5)$) -- +($(#3+0.5,0.5)$);
\foreach \x in {0,#2,...,#4}
\draw[#1]  ($(#5)+(XYshift)$) [xshift=\x cm, yshift=\x cm] +($(0.5,-#3-0.5)$) -- +($(-#3-0.5,0.5)$);
}

\newrobustcmd{\Cgridtwo}[5][->]{
\foreach \x in {0,#2,...,#3}
\draw[#1] ($(#5)+(XYshift)$)  [xshift=-\x cm, yshift=\x cm]  +($(-0.6,-#3-0.6)$) -- +($(#3+0.6,0.6)$);
\foreach \x in {0,#2,...,#4}
\draw[#1]  ($(#5)+(XYshift)$) [xshift=\x cm, yshift=\x cm] +($(0.6,-#3-0.6)$) -- +($(-#3-0.6,0.6)$);
}


\newcommand{\Ctestgrid}{
\foreach \x in {1,1.5,...,11}
\draw[xshift=-\x cm, yshift=\x cm, ->] (0,-12) -- (12,0);
\foreach \x in {1,1.5,...,11}
\draw[xshift=\x cm, yshift=\x cm, ->] (0,-12) -- (-12,0);
}



% \Cgridnetwork[thin,->]{0.75}{11}  for best results the last argument should be a multiple of the penultimate one
\newrobustcmd{\Cgridnetwork}[3][thin]{
\foreach \x in {0,#2,...,#3}
\draw[#1] (XYshift)  [xshift=-\x cm, yshift=\x cm]  +($(-0.5,-#3-0.5)$) -- +($(#3+0.5,0.5)$);
\foreach \x in {0,#2,...,#3}
\draw[#1]  (XYshift) [xshift=\x cm, yshift=\x cm] +($(0.5,-#3-0.5)$) -- +($(-#3-0.5,0.5)$);
\foreach \y in {0,#2,...,#3}
\foreach \x in {0,#2,...,#3}
\draw[thick, fill=white] (XYshift) [shift={(+\x-\y, -#3  +\x + \y)}] + (-0.35,-0.15) rectangle + (0.35,0.15);
}

% \Cgridnetwork[thin,->]{0.75}{11}{2}  the last variable scales the size of the boxes.
%  For best results, the penultimate variable should be a multiple of the antepenultimate variable
%(#3/#2 is the number of boxes in along one line).
\newrobustcmd{\Cgridnetworkscale}[4][thin]{
\foreach \x in {0,#2,...,#3}
\draw[thin] (XYshift)  [shift={(-\x,\x)}]  +($(-#2*0.5,-#3-#2*0.5)$) -- +($(#3+#2*0.5,#2*0.5)$);
\foreach \x in {0,#2,...,#3}
\draw[thin]  (XYshift) [shift={(\x,\x)}] +($(#2*0.5,-#3-#2*0.5)$) -- +($(-#3-#2*0.5,#2*0.5)$);
\foreach \y in {0,#2,...,#3}
\foreach \x in {0,#2,...,#3}
\draw[#1, fill=white] (XYshift) [shift={(+\x-\y, -#3  +\x + \y)}] +
(-0.35*#4,-0.15*#4) rectangle + (0.35*#4,0.15*#4);
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%% miscelaneous%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \shapethrupoints{(0,0) (1,1) (2,0) (3,1) (2,1) (3,1) (0,0)}  plots a closed curve through these points.
% The optional argument makes it more smooth for bigger values (default is set to 2).
% Comment: This command is not very well formed because.  I don't think it will displace when we change the XYshift
% settings (since there are no +'s in front of the coordinates.  If we put +'s in front then it might - I haven't
% tested it yet.
\newcommand{\shapethrupoints}[2][2]{
\draw[thick, smooth cycle, tension =#1] plot coordinates {#2};
}

%\clipobject{A}{closed path}  encapsulates the tikz \clip command. It clips A to the closed path. the optional
%argument is to use any options for the clip command
\newcommand{\clipobject}[3][]{\begin{scope} \clip[#1] #3; #2 \end{scope}} % I haven't tested this yet.

% below just clips what follows like the tikz command
\newcommand{\clipfollowing}[2][]{\clip[#1] #2;}





%\thispoint{A}{x,y}

\newcommand{\thispoint}[2]{\path ($(#2)+(XYshift)$) coordinate (#1) {};
\path ($(#2)+(XYshift)$) coordinate (fontlocation);
\path (0, 0) coordinate (#1 right);
\path (0, 0) coordinate (#1 top);
}

\newcommand{\Thispoint}[2]{\path ($(#2)+(XYshift)$) coordinate (#1)   {\ensuremath{\defaultfont #1}};
\path ($(#2)+(XYshift)$) coordinate (fontlocation);
\path (0, 0) coordinate (#1 right);
\path (0, 0) coordinate (#1 top);
}

%\relpoint{A}{6,-4}{B} places a point named B at A+(6,-4)


\newcommand{\relpoint}[3]{\path ($(#1)+(#2)+(XYshift)$) coordinate (#3) {};
\path ($(#1)+(#2)+(XYshift)$) coordinate (fontlocation);
\path (0, 0) coordinate (#3 right);
\path (0, 0) coordinate (#3 top);
}


\newcommand{\Thistexthere}[2]{\path ($(#2)+(XYshift)$) node {#1};
}


\newcommand{\pointingarrow}[5][right]{\draw[thin, ->] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) node [#1] (fontlocation){} to [out=#3, in=#5]
($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%% 3D diagrams %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% \Cxaxis[thin]{x}{0,0}{20)

\newcommand{\Cxaxis}[4][thin]{
\draw[#1, ->] ($(#3)+(XYshift)$)  +(0,0,0) -- +(#4,0,0) coordinate (axis end);
\path ($(axis end)+ (0, -1, 0)$) node (fontlocation) {\ensuremath{\thirdfont #2}};
}

\newcommand{\Cyaxis}[4][thin]{
\draw[#1, ->] ($(#3)+(XYshift)$)  +(0,0,0) -- +(0,#4,0) coordinate (axis end);
\path ($(axis end)+ (-1, 0, 0)$) node (fontlocation) {\ensuremath{\thirdfont #2}};
}

\newcommand{\Czaxis}[4][thin]{
\draw[#1, ->] ($(#3)+(XYshift)$)  +(0,0,0) -- +(0,0,#4) coordinate (axis end);
\path ($(axis end)+ (-0.9, 0.2, 0)$) node (fontlocation) {\ensuremath{\thirdfont #2}};
}


% \csurface[thin]{0,0}{1}   \csurface[distort]{0,0}{scale}

\newcommand{\csurface}[3][1]{
\shadedraw[color=gray!20!white, draw=black, scale=#3, shift={($(#2)+(XYshift)$)}]
(0,12,0) .. controls (6,15*#1,0) and (15,7*#1,0) ..  (20,7,0)
         .. controls (20,9*#1,8) and (20,13*#1,15) .. (20,5,20)
         .. controls (7,9,20) and (14,10,20) .. (0, 9,20)
         .. controls (0,11*#1,10) and (0,11*#1,15) ..  (0,12,0);
}


% a cuboid with a surface in it.
%\ccuboid[0.1]{8,5}{x}{y}{z}{bl}{br}{fr}{fl}  bl = backleft height to surface.  [0.1] option to curve surface.



\newcommand{\ccuboid}[9][0]{
\pgfmathsetmacro{\cubex}{#3}
\pgfmathsetmacro{\cubey}{#4}
\pgfmathsetmacro{\cubez}{#5}
\pgfmathsetmacro{\cubebl}{#6}
\pgfmathsetmacro{\cubebr}{#7}
\pgfmathsetmacro{\cubefr}{#8}
\pgfmathsetmacro{\cubefl}{#9}
\draw[shift={($(#2)+(XYshift)$)},ultra thin, dashed] (0,0,0) -- (\cubex, 0,0) -- (\cubex,0,\cubez) -- (0, 0, \cubez) -- cycle;  % bottom
\draw[shift={($(#2)+(XYshift)$)},very thick, white]
(0,\cubebl,0) .. controls (0.5*\cubex, 0.5*\cubebl+0.5*\cubebr +#1,0) .. (\cubex, \cubebr,0)
              .. controls (\cubex, 0.5*\cubebr+0.5*\cubefr +#1,0.5*\cubez) ..  (\cubex,\cubefr,\cubez)
              .. controls (0.5*\cubex, 0.5*\cubefr+0.5*\cubefl +#1,\cubez) .. (0, \cubefl, \cubez)
              .. controls (0, 0.5*\cubefl+0.5*\cubebl +#1,0.5*\cubez) ..  (0,\cubebl,0); % surface
\draw[shift={($(#2)+(XYshift)$)},ultra thin, dashed] (0,0,0) -- (0,\cubebl,0) (\cubex, 0,0) -- (\cubex, \cubebr,0)
(\cubex,0,\cubez) -- (\cubex,\cubefr,\cubez) (0, 0, \cubez) -- (0, \cubefl, \cubez); % bottom sides
\draw[shift={($(#2)+(XYshift)$)},thick] (0,\cubey,0) -- (\cubex,\cubey,0) -- (\cubex,\cubey,\cubez) -- (0,\cubey,\cubez) -- cycle;  % top sides
\draw[shift={($(#2)+(XYshift)$)},thick] (0,\cubey,0) -- (0,\cubebl,0) (\cubex, \cubey,0) -- (\cubex, \cubebr,0) (\cubex,\cubey,\cubez) -- (\cubex,\cubefr,\cubez) % sides
(0, \cubey, \cubez) -- (0, \cubefl, \cubez);
}

%code below does the same

%\newcommand{\ccuboid}[9][0]{
%\draw[shift={($(#2)+(XYshift)$)},ultra thin, dashed] (0,0,0) -- (#3, 0,0) -- (#3,0,#5) -- (0, 0, #5) -- cycle;  % bottom
%\draw[shift={($(#2)+(XYshift)$)},very thick, white] (0,#6,0) .. controls (0.5*#3, 0.5*#6+0.5*#7 +#1,0) .. (#3, #7,0) .. controls (#3, 0.5*#7+0.5*#8 +#1,0.5*#5) .. (#3,#8,#5) .. controls (0.5*#3, 0.5*#8+0.5*#9 +#1,#5) .. (0, #9, #5) .. controls (0, 0.5*#9+0.5*#6 +#1,0.5*#5) ..  cycle; % surface
%\draw[shift={($(#2)+(XYshift)$)},ultra thin, dashed] (0,0,0) -- (0,#6,0) (#3, 0,0) -- (#3, #7,0) (#3,0,#5) -- (#3,#8,#5) (0, 0, #5) -- (0, #9, #5); % bottom sides
%\draw[shift={($(#2)+(XYshift)$)},thick] (0,#4,0) -- (#3,#4,0) -- (#3,#4,#5) -- (0,#4,#5) -- cycle;  % top sides
%\draw[shift={($(#2)+(XYshift)$)},thick] (0,#4,0) -- (0,#6,0) (#3, #4,0) -- (#3, #7,0) (#3,#4,#5) -- (#3,#8,#5) (0, #4, #5) -- (0, #9, #5); %sides
%}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%% HUMANS, ANTENAE, LAPTOP %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \humanEEG{size}{5,6}

\newcommand{\humanEEG}[2][1]{
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (0,0) circle(1); %head
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (-0.5,-0.5) arc (-135:-45:0.7); % smile
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (-0.4, 0.15) ellipse(0.15 and 0.1); %right eye
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (0.4, 0.15) ellipse(0.15 and 0.1);  %left eye
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (0, 0.15) -- + (0.17, -0.4) -- + (0, -0.4); %nose
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (1.3,0) arc (0:180:1.3); %EEG headset
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (75:1.3) -- + (75:2.5)-- + (75:1.3) -- + (65:2.2) -- +(75:1.3) -- (85:2.2); %antena
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (0,-1) -- +(0,-4); %body
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (-1.5,-3.5) -- + (0,-1.25) -- + (1.5, -3.5); %arms
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (-1.85,-7) --  + (-1.5, -7) -- + (0, -4) -- + (1.5, -7) -- +(1.85,-7) ; %legs
}


\newcommand{\human}[2][1]{
\path (0,0);   % test line, maybe remove this
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (0,0) circle(1); %head
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (-0.5,-0.5) arc (-135:-45:0.7); % smile
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (-0.4, 0.15) ellipse(0.15 and 0.1); %right eye
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (0.4, 0.15) ellipse(0.15 and 0.1);  %left eye
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (0, 0.15) -- + (0.17, -0.4) -- + (0, -0.4); %nose
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (0,-1) -- +(0,-4); %body
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (-1.5,-3.5) -- + (0,-1.25) -- + (1.5, -3.5); %arms
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (-1.85,-7) --  + (-1.5, -7) -- + (0, -4) -- + (1.5, -7) -- +(1.85,-7) ; %legs
}

\newcommand{\humanforward}[2][1]{
\path (0,0);
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (20:1) arc(20:340:1); %head
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (-35:1) arc(-90:-135:0.7); % smile
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (0.55, 0.15) ellipse(0.15 and 0.1);  %right eye
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (20:1) -- + (-16:1.17) -- + (-20:1); %nose
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (-0.1,0.25) -- + (-0.25,0.25) -- + (-0.2, -0.45) -- +(-0.1,-0.45) --+(0,-0.4); % -- + arc(-90:75:0.02); %ear
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (0,-1) -- +(0,-4); %body
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (0,-1.25) -- + (1.2, -2.5) -- +(2.6, -2.7); %arms
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (-1.15,-7) --  + (-1.5, -7) -- + (0, -4) -- + (1.5, -7) -- +(1.85,-7) ; %legs
}




%% \antena[size]{A}{4,2}

\newcommand{\antena}[3][1]{
\path ($(#3)+(XYshift)$) coordinate (#2) {};
\path ($(#3)+(XYshift)$) coordinate (fontlocation);
\path (0, 0) coordinate (#2 right);
\path (0, 0) coordinate (#2 top);
\draw[shift={($(#3)+(XYshift)$)}, thin, scale=#1]  + (90:0) -- + (90:2.5)-- + (90:0) -- + (70:2.2) -- +(90:0) -- (120:2.2); %antena
}


%% \laptop[size]{A}{4,2}




\newcommand{\laptop}[2][1]{
\path (0,0);
%\path (2.2, -2.9);
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (1.7,-3.1) rectangle (4.3, -2.9);
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (4.32,-2.9) -- +($(4.32,-2.9)+(75:2.6)$) -- + ($(4.32,-2.9)+(75:2.6)+(165:0.2)$) --+ ($(4.32,-2.9)+(165:0.2)$) -- cycle;
}


\newcommand{\laptoptest}[2][1]{
\path (0,0);
%\path (2.2, -2.9);
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (-1.3,-0.1) rectangle (1.3, 0.1);
\draw[shift={($(#2)+(XYshift)$)}, thin, scale=#1] + (1.32,0.1) -- +($(1.32,0.1)+(75:2.6)$) -- + ($(1.32,0.1)+(75:2.6)+(165:0.2)$) --+ ($(1.32,0.1)+(165:0.2)$) -- cycle;
}


%% small dots for in text use.

\newcommand{\smallblackcircle}{\begin{compose} \cshapefill[thin]{\acircle}{A}{5pt}{5pt}{0,0}\end{compose} }
\newcommand{\smallwhitecircle}{\begin{compose} \cshape[thin]{\acircle}{A}{5pt}{5pt}{0,0} \end{compose} }

\newcommand{\smallblacksquare}{\begin{compose} \cshapefill[thin]{\arectangle}{A}{5pt}{5pt}{0,0} \end{compose} }
\newcommand{\smallwhitesquare}{\begin{compose} \cshape[thin]{\arectangle}{A}{5pt}{5pt}{0,0} \end{compose} }


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%% JOINA with settable arrowheads (default angle 60) %%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\arrowheadA}{angle 60}

\newcommand{\setarrowheadA}[1]{\renewcommand{\arrowheadA}{#1}}



%\joinAcc[above]{A}{30}{B}{-90}

\newcommand{\joinAcc}[5][above]{\draw[thin,->-=.5, >={\arrowheadA}] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}




\newcommand{\joinAccthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


%the following commands are useful when have overlapping lines


\newcommand{\joinAccontop}[5][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5} \joinAcc[#1]{#2}{#3}{#4}{#5}}

% \joinAccontopnoarrow defined later


% \joinccontopnoarrow defined later



%\joinccvararrow[above]{A}{30}{B}{-90}{0.7}  puts arrowhead 0.7 of way along line

\newcommand{\joinAccvararrow}[6][above]{\draw[thin,->-=#6, >=arrow 60] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinAccontopvararrow}[6][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5}
\joinAccvararrow[#1]{#2}{#3}{#4}{#5}{#6}}








% \joinAtb[above]{A}{3}{B}{-4}

\newcommand{\joinAtb}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinAbt}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinAtt}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinAbb}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinAtl}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinAtr}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinAbl}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinAbr}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinAll}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinAlr}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinArl}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinArr}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinAlt}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinAlb}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinArt}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinArb}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% \joinAtc[above]{A}{3}{B}{60}

\newcommand{\joinAtc}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinAbc}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinAct}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinAcb}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinAcl}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinAcr}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinAlc}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinArc}[5][above]{\draw[thin,->-=.5, >=\arrowheadA] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


%thick line versions

\newcommand{\joinAtbthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinAbtthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinAttthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinAbbthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinAtlthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinAtrthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinAblthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinAbrthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinAllthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinAlrthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinArlthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinArrthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinAltthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinAlbthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinArtthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinArbthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}



\newcommand{\joinAtcthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinAbcthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinActthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinAcbthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinAclthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinAcrthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinAlcthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinArcthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadA] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%% JOINB with settable arrowheads (default latex) %%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\arrowheadB}{latex}

\newcommand{\setarrowheadB}[1]{\renewcommand{\arrowheadB}{#1}}



%\joinBcc[above]{A}{30}{B}{-90}

\newcommand{\joinBcc}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}




\newcommand{\joinBccthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


%the following commands are useful when have overlapping lines


\newcommand{\joinBccontop}[5][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5} \joinBcc[#1]{#2}{#3}{#4}{#5}}

% \joinBccontopnoarrow defined later


% \joinccontopnoarrow defined later



%\joinccvararrow[above]{A}{30}{B}{-90}{0.7}  puts arrowhead 0.7 of way along line

\newcommand{\joinBccvararrow}[6][above]{\draw[thin,->-=#6, >=arrow 60] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinBccontopvararrow}[6][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5}
\joinBccvararrow[#1]{#2}{#3}{#4}{#5}{#6}}








% \joinBtb[above]{A}{3}{B}{-4}

\newcommand{\joinBtb}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinBbt}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinBtt}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinBbb}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinBtl}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinBtr}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinBbl}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinBbr}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinBll}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinBlr}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinBrl}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinBrr}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinBlt}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinBlb}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinBrt}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinBrb}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% \joinBtc[above]{A}{3}{B}{60}

\newcommand{\joinBtc}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinBbc}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinBct}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinBcb}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinBcl}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinBcr}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinBlc}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinBrc}[5][above]{\draw[thin,->-=.5, >=\arrowheadB] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


%thick line versions

\newcommand{\joinBtbthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinBbtthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinBttthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinBbbthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinBtlthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinBtrthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinBblthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinBbrthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinBllthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinBlrthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinBrlthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinBrrthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinBltthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinBlbthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinBrtthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinBrbthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}



\newcommand{\joinBtcthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinBbcthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinBctthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinBcbthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinBclthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinBcrthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinBlcthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinBrcthick}[5][above]{\draw[thick,->-=.5, >=\arrowheadB] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}



%%%%%%%%%%%%%%%%%%% \joinwavycc %%%%%%%%%%%

%\tikzset{snake it/.style={decorate, decoration=snake}}

\newcommand{\joinwavycc}[5][above]{\draw[ultra thin, decorate, decoration={snake,amplitude=0.4mm,segment length=0.6mm}] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

% {snake,amplitude=2mm,segment length=3mm}
% thin, decorate, decoration=snake

%%%%%%%%%%%%%%%%%%%%%% \joinccfusion %%%%%%%%%%%%%
% decorates with -oWo- (circle, wavy line, circle)

\newcommand{\joinccfusion}[5][above]{\draw[thin,->-=0.20,->-=-0.10,-oWo-=0.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.08] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


\newcommand{\joinccfusionthick}[5][above]{\draw[thick,->-=0.20,->-=-0.10,-oWo-=0.5] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.08] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


%\joinccfusionvar{a}{90}{b}{-90}{0.7}{0.3}{-0.3}  #6 is for fusion site, #7 for first arrow and #8 for second arrow.
% as guide - choose #7=0.4#6 and #8=0.4-0.4*#6  but some fine tuning is needed.

\newcommand{\joinccfusionvar}[8][above]{\draw[thin,->-=#7,->-=#8,-oWo-=#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.08] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}

\newcommand{\joinccfusionontop}[5][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5} \joinccfusion[#1]{#2}{#3}{#4}{#5}}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%% \joinstylecc  etc %%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% extra argument for style of line
%\joinstylecc[above]{a}{90}{b}{-90}{thick, dashed}





\newcommand{\joinstylecc}[6][above]{\draw[#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


\newcommand{\joinstyleccontop}[6][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5}{#6} \joinstylecc[#1]{#2}{#3}{#4}{#5}{#6}}


\newcommand{\joinstyletb}[6][above]{\draw[#6] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinstylebt}[6][above]{\draw[#6] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinstylett}[6][above]{\draw[#6] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinstylebb}[6][above]{\draw[#6] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinstyletl}[6][above]{\draw[#6] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinstyletr}[6][above]{\draw[#6] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinstylebl}[6][above]{\draw[#6] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinstylebr}[6][above]{\draw[#6] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinstylell}[6][above]{\draw[#6] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinstylelr}[6][above]{\draw[#6] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinstylerl}[6][above]{\draw[#6] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinstylerr}[6][above]{\draw[#6] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinstylelt}[6][above]{\draw[#6] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinstylelb}[6][above]{\draw[#6] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinstylert}[6][above]{\draw[#6] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinstylerb}[6][above]{\draw[#6] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% \joinstyletc[above]{A}{3}{B}{60}

\newcommand{\joinstyletc}[6][above]{\draw[#6] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joinstylebc}[6][above]{\draw[#6] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinstylect}[6][above]{\draw[#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joinstylecb}[6][above]{\draw[#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joinstylecl}[6][above]{\draw[#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joinstylecr}[6][above]{\draw[#6] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joinstylelc}[6][above]{\draw[#6] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joinstylerc}[6][above]{\draw[#6] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%% \joincustomcc  etc %%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% I CAN'T GET THIS WORKING!!



\newcommand{\customstyle}{thin}

\newcommand{\setcustomstyle}[1]{\renewcommand{\customstyle}{#1}}



\newcommand{\joincustomcc}[5][above]{\draw[\customstyle] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=#5]
node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}


\newcommand{\joincustomccontop}[5][above]{\joinccthickwhite[#1]{#2}{#3}{#4}{#5} \joincustomcc[#1]{#2}{#3}{#4}{#5}}


\newcommand{\joincustomtb}[5][above]{\draw[\customstyle] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joincustombt}[5][above]{\draw[\customstyle] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincustomtt}[5][above]{\draw[\customstyle] ($(#2)+(#2 top)+(#3,0)$)to [out=90,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincustombb}[5][above]{\draw[\customstyle] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joincustomtl}[5][above]{\draw[\customstyle] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincustomtr}[5][above]{\draw[\customstyle] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joincustombl}[5][above]{\draw[\customstyle] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincustombr}[5][above]{\draw[\customstyle] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=0] node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joincustomll}[5][above]{\draw[\customstyle] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincustomlr}[5][above]{\draw[\customstyle] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joincustomrl}[5][above]{\draw[\customstyle] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=180]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincustomrr}[5][above]{\draw[\customstyle] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=0]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joincustomlt}[5][above]{\draw[\customstyle] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincustomlb}[5][above]{\draw[\customstyle] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joincustomrt}[5][above]{\draw[\customstyle] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=90]   node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincustomrb}[5][above]{\draw[\customstyle] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=-90]   node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}

% \joincustomtc[above]{A}{3}{B}{60}

\newcommand{\joincustomtc}[5][above]{\draw[\customstyle] ($(#2)+(#2 top)+(#3,0)$)to [out=90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$) ;}
\newcommand{\joincustombc}[5][above]{\draw[\customstyle] ($(#2)-(#2 top)+(#3,0)$)to [out=-90, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joincustomct}[5][above]{\draw[\customstyle] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3,  in=90] node [#1=0.07] (fontlocation){} ($(#4)+(#4 top)+(#5,0)$);}
\newcommand{\joincustomcb}[5][above]{\draw[\customstyle] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=-90] node [#1=0.07] (fontlocation){} ($(#4)-(#4 top)+(#5,0)$);}
\newcommand{\joincustomcl}[5][above]{\draw[\customstyle] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=180]    node [#1=0.07] (fontlocation){} ($(#4)-(#4 right)+(0, #5)$);}
\newcommand{\joincustomcr}[5][above]{\draw[\customstyle] ($(#2)+ cos(#3)*(#2 right) + sin(#3)*(#2 top)$) to [out=#3, in=0]  node [#1=0.07] (fontlocation){} ($(#4)+(#4 right)+(0, #5)$);}
\newcommand{\joincustomlc}[5][above]{\draw[\customstyle] ($(#2)-(#2 right)+(0,#3)$)to [out=180, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}
\newcommand{\joincustomrc}[5][above]{\draw[\customstyle] ($(#2)+(#2 right)+(0,#3)$)to [out=0, in=#5] node [#1=0.07] (fontlocation){} ($(#4)+ cos(#5)*(#4 right) + sin(#5)*(#4 top)$);}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%  The commands below are more "custom" in nature.  There is work to be done to rewrite the code below
%%%%%  in the spirit of the code written above.  There are also a bunch of non-TikZ commands I use.  %%%%%%%
%%%%%  I copied the stuff below across from the old tscustomcommands.sty just so it is in one place. %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newcommand{\convertsto}{\abovebaseline[-1.5pt]{\stackunder[-0.8pt]{=}{\smile}}}
\newcommand{\convertsto}{\leftrightharpoons}


\newcommand{\bcomment}{\begin{comment} }

\newcommand{\ecomment}{\end{comment} }


%% The below command allows us to put text above/below a long arrow
%% eg. \extleftrightarrow[\text{reverse}]{\text{time}}
\makeatletter
\newcommand\extleftrightarrow[2][]{\ext@arrow 0099{\longleftrightarrowfill@}{#1}{#2}}
\def\longleftrightarrowfill@{\arrowfill@\leftarrow\relbar\rightarrow}
\makeatother

%%% just right arrow version
\makeatletter
\newcommand\extrightarrow[2][]{\ext@arrow 0099{\longrightarrowfill@}{#1}{#2}}
\def\longrightarrowfill@{\arrowfill@\relbar\relbar\rightarrow}
\makeatother





%\placeAupleftBupright[0pt]{\sim}{4pt}{0pt}{w}{0pt}{0pt}  places a \sim above the w.
%The optional argument adjust the relative horizontal displacement (adjusted so sim on w works well is at 0pt).
% This basic command can be used to place one thing relative to another.  The left and right options might be
%important to provide horizontal space between adjacent symbols.
\newcommand{\placeAupleftBupright}[7][0pt]{  \kern #4 \raisebox{#3}{\rlap{$#2$}} \kern -1.5pt \kern #1
                                         \raisebox{#6}{\rlap{$#5$}} \kern #7  }

\newcommand{\simonw}{\placeAupleftBupright{\sim}{4pt}{1.5pt}{w}{0pt}{7.5pt} }

\newcommand{\simunderw}{\placeAupleftBupright[0.73pt]{\sim}{-4.35pt}{1.5pt}{w}{0pt}{7.5pt} }

% puts square brackets round something but using less space [1]
\newcommand{\sqrbracketsclose}[2][0]{[\negs \kern #1pt #2 \kern #1pt \negs ]}

% puts (round) brackets round something but using less space (1)
\newcommand{\bracketsclose}[2][0]{ {(\negs \kern #1pt #2 \kern #1pt \negs )} }


%\gamma_\lowsub[1]{a} puts a lower subscript on gamma than just using \gamma_a
\newcommand{\lowsub}[1]{ {\rule{0pt}{1.5ex}#1} }

% sometimes following is better - not as low as \lowsub.
\newcommand{\mediumlowsub}[1]{ {\rule{0pt}{1.1ex}#1} }


% a redefinition of \pmb  from tex.StackExchange
\makeatletter
\def\pmb@#1#2{\setbox8\hbox{$\m@th#1{#2}$}%
  \setboxz@h{$\m@th#1\mkern.5mu$}\pmbraise@\wdz@
  \binrel@{#2}%
  \dimen@-\wd8 %
  \binrel@@{%
    \mkern-.1mu\copy8 %
    \kern\dimen@\mkern-.15mu\copy8 %
    \kern\dimen@\mkern-.2mu\copy8 %
    \kern\dimen@\mkern.1mu\copy8 %
    \kern\dimen@\mkern.2mu\copy8 %
    \kern\dimen@\mkern.15mu\copy8 %
    %\kern\dimen@\mkern.4mu\raise\pmbraise@\copy8 %
    \kern\dimen@\mkern.4mu\box8 }%
}
\makeatother

%% \sqbrackets{1} does {[1]}
\newcommand{\sqbrackets}[1]{ {\left[ #1\right]} }

%%% below command puts a bar over the 1.

\newcommand{\sqbracketsbar}[1]{ {\left[\bar{\scriptscriptstyle{#1}}\right]} }

%% below two commands put a white or black rectangle over the symbol.  The option shifts this to the left.
% unfortunately, these commands don't work inside compose drawing as they clash with tikz.
%!!! use the \overrectwhite \overrectblack commands below!!!

\newcommand{\overrectanglew}[2][-0.4]{\overset{\tikz \draw[thin] (-0.12,-0.017) rectangle (0.05,0.017);
\hspace{#1 pt}}{#2}}

\newcommand{\overrectangleb}[2][-0.4]{\overset{\tikz \draw[thin, fill=black] (-0.12,-0.017) rectangle (0.05,0.017);
\hspace{#1 pt}}{#2}}

%%% These commands put a white or black rectangle over the symbol (without using tikz so should work in tikz).
%%% The first command defines a rectangle (from back to back \sqsubset and \sqsupset) - I found this on the web.
%%% The command has an optional argument to move the rectangle to the right by #1 pt (default is 1pt).



\newcommand{\rectanglefromsqsupbset}{{ \ooalign{$\sqsubset\mkern3mu$\cr$\mkern8mu\sqsupset$\cr}  }}

\newcommand{\overrectwhite}[2][1]{\overset{\raisebox{-3pt}{\hspace{#1pt}
\resizebox{6pt}{1.6pt}{$\rectanglefromsqsupbset$}}}{#2}}

\newcommand{\overrectblack}[2][1]{\overset{\raisebox{-3pt}{\hspace{#1pt}
\resizebox{6pt}{1.5pt}{$\blacksquare$} }}{#2}}


%% the first two commands draw blackwhite rectangles and the second two commands allow this to be placed over
%% a symbol.  E.G \overrectwb{\alpha} places a wb rectangle over \alpha.
\newcommand{\whiteblackrect}{
\placeAupleftBupright[0pt]
{\resizebox{4pt}{1.6pt}{$\rectanglefromsqsupbset~$~}}{0pt}{0pt}
{\resizebox{2.2pt}{1.315pt}{$\blacksquare$}}{0.3pt}{0pt}
}

\newcommand{\blackwhiterect}{
\placeAupleftBupright[0pt]
{\resizebox{2.2pt}{1.315pt}{$\blacksquare$}}{0.3pt}{0pt}
{\resizebox{4pt}{1.6pt}{$\rectanglefromsqsupbset~$~}}{0pt}{0pt}
}

\newcommand{\overrectwb}[1]{ \overset{\raisebox{-4pt}{\whiteblackrect \kern 1.3pt}}{#1} }

\newcommand{\overrectbw}[1]{ \overset{\raisebox{-4pt}{\blackwhiterect \kern 1.3pt  }}{#1} }





% These commands draw a squashed triangle.  Option changes how close it is to the postceeding, preceeding symbol.
%Defaults shown in square brackets (not zero)

\newcommand{\leftphystriangle}[1][-4.5]{\raisebox{-0.9pt}{\resizebox{3pt}{8pt}{ $\blacktriangleleft$\hspace{#1pt} }} }

\newcommand{\rightphystriangle}[1][-1.5]{\raisebox{-0.9pt}{\hspace{#1pt}\resizebox{5pt}{8pt}{ $\blacktriangleright$ }} }

%% below commands put squares over symbol

\newcommand{\oversquarewhite}[1]{\overset{\square}{#1}}

\newcommand{\oversquareblack}[1]{\overset{\blacksquare}{#1}}

\newcommand{\leftobject}[1]{(\negsss(#1|}
\newcommand{\rightobject}[1]{|#1)\negsss)}

\newcommand{\Leftobject}[1]{\left(\negsss\left(#1\right.\right.\negsss|}
\newcommand{\Rightobject}[1]{|\negsss\left.\left. #1\right)\negsss\right)}

\newcommand*{\leftHilb}{\raisebox{2.8pt}{\rlap{$\lefthalfcap$}\kern 1.3pt}\mathcal{H}}

\newcommand*{\rightHilb}{\mathcal{H}\hspace{-5pt}\raisebox{2.8pt}{\rlap{$\righthalfcap$}\kern -0.0pt}\hspace{6pt}}





%\newcommand*{\lefteigen}[1]{\raisebox{1.1pt}{\rlap{$\shortmid$}\kern 2.5pt}{#1}}

%\newcommand*{\righteigen}[1]{{#1}\hspace{-2.5pt}\raisebox{1pt}{\rlap{$\shortmid$}\kern 0.0pt}\hspace{4pt}}


\newcommand*{\lefteigen}[1]{\raisebox{-4pt}{\rlap{\scalebox{0.85}{$\leftharpoondown$}}}{#1}}

\newcommand*{\righteigen}[1]{\raisebox{-4pt}{\rlap{\scalebox{0.85}{$\rightharpoondown$}}}{#1}}



\newcommand*{\oldlefteigen}[1]{\raisebox{-1.8pt}{\rlap{$\lefthalfcup$}\kern 1.3pt}{#1}}

\newcommand*{\oldrighteigen}[1]{{#1}\hspace{-5pt}\raisebox{-1.8pt}{\rlap{$\righthalfcup$}\kern -0.0pt}\hspace{6pt}}

\newcommand*{\oldphysicalise}[1]{\raisebox{1.1pt}{\rlap{$\ulcorner$}\kern 1.3pt}{#1}
\raisebox{0.9pt}{\kern -2pt\rlap{$\lrcorner$}\kern 3.5pt }}

\newcommand*{\Physicalise}[1]{\raisebox{-1.3pt}{\rlap{$\lefthalfcap$}\kern 5.4pt} {#1}
\raisebox{2.8pt}{\rlap{$\righthalfcup$}}  \kern 3.5pt }

%% option to physicalise adds space before left \ulcorner - useful in mathsf boldface.

\newcommand*{\cornersphysicalise}[2][0]{\raisebox{-3.3pt}{\rlap{$\ulcorner$}\kern 3pt \kern #1pt} {#2}
                                  \raisebox{5.8pt}{\kern -0.6pt \rlap{$\lrcorner$}} \kern 3pt  }


\newcommand*{\physicalise}[2][0]{\raisebox{0pt}{\rlap{\resizebox{2pt}{3pt}{$\vert$}}\kern 1.3pt \kern #1pt} {#2}
                                  \raisebox{4.6pt}{\kern -0.2pt \rlap{\resizebox{2pt}{3pt}{$\vert$}}} \kern 3pt  }


%%% corners.

\newcommand*{\leftcorners}[1]{\raisebox{0.4pt}{\rlap{$\ulcorner$}}
                              \raisebox{1.1pt}{\rlap{$\llcorner$}\kern 1.8pt}{#1}
}

\newcommand*{\rightcorners}[1]{
{#1}
\raisebox{0.4pt}{\kern -2pt\rlap{$\urcorner$}}
\raisebox{1.1pt}{\rlap{$\lrcorner$}\kern 3.5pt}
}


\newcommand*{\fourcorners}[1]{\raisebox{0.4pt}{\rlap{$\ulcorner$}}
                              \raisebox{1.1pt}{\rlap{$\llcorner$}\kern 1.8pt}{#1}
\raisebox{0.4pt}{\kern -2pt\rlap{$\urcorner$}}
\raisebox{1.1pt}{\rlap{$\lrcorner$}\kern 3.5pt}
}


% the optional parameter allows fine tuning in the horizontal placement of the lefthalfcap/righthalfcup.
\newcommand*{\maxresult}[2][0]{\raisebox{3.4pt}{\rlap{$\lefthalfcap$}\kern 1.1pt\kern #1pt}{#2}}

\newcommand*{\maxprep}[2][0]{{#2}\hspace{-4.5pt}\hspace{-#1pt}\raisebox{-1.8pt}{\rlap{$\righthalfcup$}\kern -0.0pt}\hspace{6pt}}

% I decided to turn off (or not!) these commands so the following two commands do nothing (I had played with them doing above
% and then redefining \lefteigen and \righteigen as above).
%\newcommand*{\maxresult}[2][0]{#2}
%\newcommand*{\maxprep}[2][0]{#2}

\newcommand*{\maxresultsfb}[2][0]{\raisebox{3.4pt}{\rlap{$\lefthalfcap$}\kern 1.1pt\kern #1pt}{\mathsfb{#2}}}

\newcommand*{\maxprepsfb}[2][0]{{\mathsfb{#2}}\hspace{-4.5pt}\hspace{-#1pt}\raisebox{-1.8pt}{\rlap{$\righthalfcup$}\kern -0.0pt}\hspace{6pt}}

\newcommand*{\maxresultboldsym}[2][0]{\raisebox{3.4pt}{\rlap{$\lefthalfcap$}\kern 0.1pt\kern #1pt}
                                      {\boldsymbol{#2}}}

\newcommand*{\maxresultopbold}[2][0]{\raisebox{3.4pt}{\rlap{$\lefthalfcap$}\kern 0.1pt\kern #1pt}
                                      \mathopbold{\rule[8.5pt]{0pt}{0pt} {#2} } }

\newcommand*{\maxprepboldsym}[2][0]{{\boldsymbol{#2}}\hspace{-5.5pt}\hspace{-#1pt}
\raisebox{-1.8pt}{\rlap{$\righthalfcup$}\kern -0.0pt}\hspace{6pt}}

\newcommand*{\maxprepopbold}[2][0]{{\mathopbold{#2}}\hspace{-5.5pt}\hspace{-#1pt}
\raisebox{-1.8pt}{\rlap{$\righthalfcup$}\kern -0.0pt}\hspace{6pt}}

\newcommand{\flatacute}[2][thin]{\overset{\begin{Compose}{0}{-0.3} \draw[#1] (-0.05,-0.1) -- (0.2,0.1); \end{Compose}}{#2}  }

\newcommand{\flatgrave}[2][thin]{\overset{\begin{Compose}{0}{-0.3} \draw[#1] (0.45,-0.1) -- (0.2,0.1); \end{Compose}}{#2}  }


\newcommand{\postbar}[1]{\mkern 1.5mu\overline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}
\newcommand{\prebar}[1]{\mkern 1.5mu\underline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}


%\newcommand{\flatacute}[2][thin]{\overset{\begin{Compose}{0}{-0.3} \draw[#1] (-0.1,-0.1) -- (0.2,0.2); \end{Compose}}{#2}  }

%\newcommand{\flatgrave}[2][thin]{\overset{\begin{Compose}{0}{-0.3} \draw[#1] (0.5,-0.1) -- (0.2,0.2); \end{Compose}}{#2}  }



%\ifone{1}{HelloWorld} prints HelloWorld \ifone{0}{HelloWorld} prints nothing.
\newcommand{\ifone}[2]{\IfEqCase{#1}{{1}{#2} {0}{} } }

%\IfZeroOrOne{a}{Hello}{World}  prints Hello if a=0 and World if a=1
\newcommand{\IfZeroOrOne}[3]{\IfEqCase{#1}{{0}{#2} {1}{#3} } }


%%%% the stuff below was to define \begin{note} blah \end{note} but it isn't working so I am commenting it all out.
% this sets \notestate for use in note environment.
%\newcommand{\notestate}{0}
%\IfZeroOrOne{\notestate}{\excludecomment{note}}{\specialcomment{note}{\begin{quote}\textbf{Note:~}}{\end{quote}}}

% following command creates environment \begin{note} Hello World \end{note} if \notestate stet to 1 it prints the Note: Hello world as a quote,
%if it set to zero, it comments it out.
%\IfEqCase{\notestate}{ {0}{\excludecomment{note}} {1}{\specialcomment{note}{\textbf{Begin note:~}}{\textbf{end note}}} }

\newcommand{\negh }{\hspace{-0.5pt}}
\newcommand{\negs }{\hspace{-1pt}}
\newcommand{\negsh }{\hspace{-1.5pt}}
\newcommand{\negss }{\hspace{-2pt}}
\newcommand{\negsss }{\hspace{-3pt}}

\DeclareMathAlphabet{\mathpzc}{OT1}{pzc}{m}{it} %for \mathpzc font.


\newcommand{\fromin}{\invbackneg\negss\vert}
\newcommand{\fromout}{\backneg\negss\vert}

\newcommand{\correspondsto}{\Longmapsto}


\newcommand{\modelledby}{\Leftarrow \hspace{-4.2pt} \boxempty}  % couldn't use \boxLeft from txfonts because of too many alphabets error
%\newcommand{\modelledby}{\stackrel{\tiny \text{model}}{\Longleftarrow}}
\newcommand{\modelledbybar}{\Leftarrow \hspace{-4.2pt} \bar{\boxempty}}

\newcommand{\ubar}[1]{\text{\b{$#1$}}}
\newcommand{\modelledbyubar}{\Leftarrow \hspace{-4.2pt} \ubar{\boxempty}}


\newcommand{\modelledto}{  \boxempty \hspace{-4.2pt} \Rightarrow  }

%%% using this to denote TF object modelled by TS object, etc.

\newcommand{\FmodelbyS}{\resizebox{5.5pt}{\height}{$\Leftarrow$} \hspace{-1.2pt} \bar{\boxempty}\hspace{-4.2pt}=\hspace{-4.2pt}\boxempty }



\newcommand{\SmodelbyF}{\resizebox{5.5pt}{\height}{$\Leftarrow$} \hspace{-1.2pt} \boxempty\hspace{-4.2pt}=\hspace{-4.2pt}\bar{\boxempty} }



%\usepackage{fixmath} % for \mathbold

\newcommand{\mathttb}[1]{{\pmb{\mathtt{#1}}}}
\newcommand{\mathsfb}[1]{{\boldsymbol{\mathsf{#1}}}}

\newcommand{\mathsfs}{\mathsf}
\newcommand{\mathtts}{\mathtt}
\newcommand{\mathsfc}{\mathsfb}
\newcommand{\mathttc}{\mathttb}

\newcommand{\mathfidc}[1]{\mathpzc{#1}}
\newcommand{\mathpfidc}[1]{{#1}}

\newcommand{\mathopbold}[1]{\boldsymbol{\hat{#1}}}

%\newcommand{\mathfidc}[1]{\pmb{\mathpzc{#1}}}
%\newcommand{\mathpfidc}[1]{\boldsymbol{#1}}



\newcommand{\cdarrow}{angle 60}


\newcommand{\qcwavyr}{\hspace{-4.5pt}\left.\vphantom{()}\right\lwavy\vphantom{A}\hspace{-2.2pt}}
\newcommand{\qcwavyl}{\hspace{-2.5pt}\left.\vphantom{()}\right\lwavy\vphantom{A}\hspace{-3.8pt}}
%\newcommand*{\vv}[1]{\vec{\mkern0mu#1}}



%\newcommand{\qcwavy}{\hspace{-4.5pt}\left.\vphantom{()}\right\lwavy\vphantom{A}\hspace{-2.2pt}}




\newcommand\presub[1]{ \prescript{}{#1} \negss}
\newcommand\presup[1]{ \prescript{#1}{} \negss }



%% These commands are for the time reverse cups and caps.

%\newcommand{\CcupTR}[5][thin]{ \Ccup[#1]{#2}{#3}{#4}{#5}  \ccircle[thin, fill=white]{#2 circ}{0.6}{$(#5)+(0,-#3+#4)$} \csymbol[0,-3]{\sim} }

\newcommand{\ccupTR}[5][thin]{\ccup[#1]{#2}{#3}{#4}{#5} \ccircle[thin, fill=white]{#2 circ}{0.6}{$(#5)+(0,-#3+#4)$} \csymbol[0,-3]{\sim} }

%\newcommand{\CcapTR}[5][thin]{ \Ccap[#1]{#2}{#3}{#4}{#5} \ccircle[thin, fill=white]{#2 circ}{0.6}{$(#5)+(0,#3-#4)$} \csymbol[0,-3]{\sim} }

\newcommand{\ccapTR}[5][thin]{\ccap[#1]{#2}{#3}{#4}{#5}  \ccircle[thin, fill=white]{#2 circ}{0.6}{$(#5)+(0,#3-#4)$} \csymbol[0,-3]{\sim} }

\newcommand{\ccupspecial}[5][thin]{\ccup[#1]{#2}{#3}{#4}{#5} \ccircle[thin, fill=white]{#2 circ}{0.6}{$(#5)+(0,-#3+#4)$} \csymbol[0,0]{-} }

%\newcommand{\CcapTR}[5][thin]{ \Ccap[#1]{#2}{#3}{#4}{#5} \ccircle[thin, fill=white]{#2 circ}{0.6}{$(#5)+(0,#3-#4)$} \csymbol[0,-3]{\sim} }

\newcommand{\ccapspecial}[5][thin]{\ccap[#1]{#2}{#3}{#4}{#5}  \ccircle[thin, fill=white]{#2 circ}{0.6}{$(#5)+(0,#3-#4)$} \csymbol[0,0]{-} }



%%% These are for the pointer cups and caps (horizontal rather than vertical)

\newcommand{\chcupTR}[5][thick]{\chcup[#1]{#2}{#3}{#4}{#5} \ccircle[thin, fill=white]{#2 circ}{0.6}{$(#5)+(-#3-#4,0)$} \csymbol[0,-3]{\sim} }


\newcommand{\chcapTR}[5][thick]{\chcap[#1]{#2}{#3}{#4}{#5}  \ccircle[thin, fill=white]{#2 circ}{0.6}{$(#5)+(+#3+#4,0)$} \csymbol[0,-3]{\sim} }

\newcommand{\chcupspecial}[5][thick]{\chcup[#1]{#2}{#3}{#4}{#5} \ccircle[thin, fill=white]{#2 circ}{0.6}{$(#5)+(-#3-#4,0)$} \csymbol[0,0]{-} }


\newcommand{\chcapspecial}[5][thick]{\chcap[#1]{#2}{#3}{#4}{#5}  \ccircle[thin, fill=white]{#2 circ}{0.6}{$(#5)+(+#3+#4,0)$} \csymbol[0,0]{-} }



\newcommand{\cmirrorleft}[4][thin]{
             \crectangle[thin,pattern={Lines[distance=0.8mm,angle=-45, line width=0.26pt]}]{#2}{0.25}{#3}{#4}
             \crectangle[fill=black]{#2}{0.075}{#3}{$(#4)+(-0.2,0)$}  }


\newcommand{\cmirrorright}[4][thin]{
             \crectangle[thin,pattern={Lines[distance=0.8mm,angle=-45, line width=0.26pt]}]{#2}{0.25}{#3}{#4}
             \crectangle[fill=black]{#2}{0.075}{#3}{$(#4)+(0.2,0)$}  }

\newcommand{\cmirrordown}[4][thin]{
             \crectangle[thin,pattern={Lines[distance=0.8mm,angle=-45, line width=0.26pt]}]{#2}{#3}{0.25}{#4}
             \crectangle[fill=black]{#2}{#3}{0.075}{$(#4)+(0,-0.2)$}  }

\newcommand{\cmirrorup}[4][thin]{
             \crectangle[thin,pattern={Lines[distance=0.8mm,angle=-45, line width=0.26pt]}]{#2}{#3}{0.25}{#4}
             \crectangle[fill=black]{#2}{#3}{0.075}{$(#4)+(0,0.2)$}  }


\newcommand{\cmirrorleftsmoke}[4][thin]{
             \crectangle[fill=black]{#2}{0.075}{#3}{$(#4)+(-0.375,0)$}
             \crectangle[thin,inner color=gray!50!white]{#2}{0.3}{#3}{#4} }

\newcommand{\cmirrorrightsmoke}[4][thin]{
             \crectangle[fill=black]{#2}{0.075}{#3}{$(#4)+(0.375,0)$}
             \crectangle[thin,inner color=gray!50!white]{#2}{0.3}{#3}{#4} }

\newcommand{\cmirrordownsmoke}[4][thin]{
             \crectangle[fill=black]{#2}{#3}{0.075}{$(#4)+(0,-0.375)$}
             \crectangle[thin,inner color=gray!50!white]{#2}{#3}{0.3}{#4} }

\newcommand{\cmirrorupsmoke}[4][thin]{
             \crectangle[fill=black]{#2}{#3}{0.075}{$(#4)+(0,0.375)$}
             \crectangle[thin,inner color=gray!50!white]{#2}{#3}{0.3}{#4} }


\newcommand{\cmirrorleftphys}[4][thin]{
             \crectangle[thin,pattern={Lines[distance=0.8mm,angle=-45, line width=0.26pt]}]{#2}{0.45}{#3}{#4}
             \csnakerightrectangle[fill=black]{#2}{0.2}{#3}{$(#4)+(-0.22,0)$}  }

\newcommand{\cmirrorrightphys}[4][thin]{
             \crectangle[thin,pattern={Lines[distance=0.8mm,angle=-45, line width=0.26pt]}]{#2}{0.45}{#3}{#4}
             \csnakeleftrectangle[fill=black]{#2}{0.2}{#3}{$(#4)+(0.22,0)$}  }

\newcommand{\cmirrorleftsmokephys}[4][thin]{
             \crectangle[thin,inner color=gray!50!white]{#2}{0.5}{#3}{#4} \csnakerightrectangle[fill=black]{#2}{0.2}{#3}{$(#4)+(-0.375,0)$}}

\newcommand{\cmirrorrightsmokephys}[4][thin]{
             \crectangle[thin,inner color=gray!50!white]{#2}{0.5}{#3}{#4} \csnakeleftrectangle[fill=black]{#2}{0.2}{#3}{$(#4)+(0.375,0)$}}



\newcommand{\cmirrordownphys}[4][thin]{
             \crectangle[thin,pattern={Lines[distance=0.8mm,angle=-45, line width=0.26pt]}]{#2}{#3}{0.45}{#4}
             \csnaketoprectangle[fill=black]{#2}{#3}{0.20}{$(#4)+(0,-0.25)$}  }

\newcommand{\cmirrorupphys}[4][thin]{
             \crectangle[thin,pattern={Lines[distance=0.8mm,angle=-45, line width=0.26pt]}]{#2}{#3}{0.45}{#4}
             \csnakebottomrectangle[fill=black]{#2}{#3}{0.20}{$(#4)+(0,0.25)$}  }


\newcommand{\cmirrordownsmokephys}[4][thin]{
             \crectangle[thin,inner color=gray!50!white]{#2}{#3}{0.5}{#4}
             \csnaketoprectangle[fill=black]{#2}{#3}{0.20}{$(#4)+(0,-0.375)$}
             }

\newcommand{\cmirrorupsmokephys}[4][thin]{
             \crectangle[thin,inner color=gray!50!white]{#2}{#3}{0.5}{#4}
             \csnakebottomrectangle[fill=black]{#2}{#3}{0.20}{$(#4)+(0,0.375)$}
             }




\newcommand{\cmirrorleftphysOLD}[4][thin]{
             \crectangle[thin,pattern={Lines[distance=1mm,angle=0, line width=0.26pt]}]{#2}{0.25}{#3}{#4}
             \crectangle[fill=black]{#2}{0.075}{#3}{$(#4)+(-0.2,0)$}  }


\newcommand{\cmirrorrightphysOLD}[4][thin]{
             \crectangle[thin,pattern={Lines[distance=1mm,angle=0, line width=0.26pt]}]{#2}{0.25}{#3}{#4}
             \crectangle[fill=black]{#2}{0.075}{#3}{$(#4)+(0.2,0)$}  }

\newcommand{\cmirrordownphysOLD}[4][thin]{
             \crectangle[thin,pattern={Lines[distance=1mm,angle=-90, line width=0.26pt]}]{#2}{#3}{0.25}{#4}
             \crectangle[fill=black]{#2}{#3}{0.075}{$(#4)+(0,-0.2)$}  }

\newcommand{\cmirrorupphysOLD}[4][thin]{
             \crectangle[thin,pattern={Lines[distance=1mm,angle=-90, line width=0.26pt]}]{#2}{#3}{0.25}{#4}
             \crectangle[fill=black]{#2}{#3}{0.075}{$(#4)+(0,0.2)$}  }


\newcommand{\cmirrorleftphysicalOLD}[4][thin]{
             \crectangle[thin,pattern=grid]{#2}{0.25}{#3}{#4}
             \crectangle[fill=black]{#2}{0.075}{#3}{$(#4)+(-0.2,0)$}  }

\newcommand{\cmirrorrightphysicalOLD}[4][thin]{
             \crectangle[thin,pattern=grid]{#2}{0.25}{#3}{#4}
             \crectangle[fill=black]{#2}{0.075}{#3}{$(#4)+(0.2,0)$}  }

\newcommand{\cmirrordownphysicalOLD}[4][thin]{
             \crectangle[thin,pattern=grid]{#2}{#3}{0.25}{#4}
             \crectangle[fill=black]{#2}{#3}{0.075}{$(#4)+(0,-0.2)$}  }

\newcommand{\cmirrorupphysicalOLD}[4][thin]{
             \crectangle[thin,pattern=grid]{#2}{#3}{0.25}{#4}
             \crectangle[fill=black]{#2}{#3}{0.075}{$(#4)+(0,0.2)$}  }



\newcommand{\Csemidleft}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,#3-0.2)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,-#3+0.2)$}  }
{+2}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,#3-0.2)$}   }
{-2}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,-#3+0.2)$}  }
}
\Cleftdoublesemi{#2}{#3}{#4} }

\newcommand{\Csemidright}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,#3-0.2)$}   }
{-1}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,-#3+0.2)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,#3-0.2)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,-#3+0.2)$}  }
}
\Crightdoublesemi{#2}{#3}{#4} }

\newcommand{\csemidleft}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,#3-0.2)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,-#3+0.2)$}  }
{+2}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,#3-0.2)$}   }
{-2}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,-#3+0.2)$}  }
}
\cleftdoublesemi{#2}{#3}{#4} }

\newcommand{\csemidright}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,#3-0.2)$}   }
{-1}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,-#3+0.2)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,#3-0.2)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,-#3+0.2)$}  }
}
\crightdoublesemi{#2}{#3}{#4} }

\newcommand{\csemidleftshaded}[4][0]{
\cleftdoublesemi[fill=gray!50!white]{#2}{#3}{#4}
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,#3-0.2)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,-#3+0.2)$}  }
}
\cleftdoublesemi{#2}{#3}{#4} }

\newcommand{\csemidrightshaded}[4][0]{
\crightdoublesemi[fill=gray!50!white]{#2}{#3}{#4}
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,#3-0.2)$}   }
{-1}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,-#3+0.2)$}  }
}
\crightdoublesemi{#2}{#3}{#4} }


% under construction - works but may be problem with triangle sticking out or not fitting in corner of semicircle.
\newcommand{\Csemidlefttriangle}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(-0.3,#3-0.35)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(-0.3,-#3+0.35)$}  }
{+2}{\ctriangle[fill=white]{#2 marker}{-0.3}{-0.3}{$(#2)+(-0.3,#3-0.35)$}   }
{-2}{\ctriangle[fill=white]{#2 marker}{-0.3}{0.3}{$(#2)+(-0.3,-#3+0.35)$}  }
}
\Cleftdoublesemi{#2}{#3}{#4} }

\newcommand{\Csemidrighttriangle}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+2}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(0.3,#3-0.35)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(0.3,-#3+0.35)$}  }
{+1}{\ctriangle[fill=white]{#2 marker}{0.3}{-0.3}{$(#2)+(0.3,#3-0.35)$}   }
{-1}{\ctriangle[fill=white]{#2 marker}{0.3}{0.3}{$(#2)+(0.3,-#3+0.35)$}  }
}
\Crightdoublesemi{#2}{#3}{#4} }

\newcommand{\csemidlefttriangle}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(-0.3,#3-0.35)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(-0.3,-#3+0.35)$}  }
{+2}{\ctriangle[fill=white]{#2 marker}{-0.3}{-0.3}{$(#2)+(-0.3,#3-0.35)$}   }
{-2}{\ctriangle[fill=white]{#2 marker}{-0.3}{0.3}{$(#2)+(-0.3,-#3+0.35)$}  }
}
\cleftdoublesemi{#2}{#3}{#4} }

\newcommand{\csemidrighttriangle}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+2}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(0.3,#3-0.35)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(0.3,-#3+0.35)$}  }
{+1}{\ctriangle[fill=white]{#2 marker}{0.3}{-0.3}{$(#2)+(0.3,#3-0.35)$}   }
{-1}{\ctriangle[fill=white]{#2 marker}{0.3}{0.3}{$(#2)+(0.3,-#3+0.35)$}  }
}
\crightdoublesemi{#2}{#3}{#4} }

\newcommand{\csemidlefttrishaded}[4][0]{
\cleftdoublesemi[fill=gray!50!white]{#2}{#3}{#4}
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(-0.3,#3-0.35)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(-0.3,-#3+0.35)$}  }
{+2}{\ctriangle[fill=white]{#2 marker}{-0.3}{-0.3}{$(#2)+(-0.3,#3-0.35)$}   }
{-2}{\ctriangle[fill=white]{#2 marker}{-0.3}{0.3}{$(#2)+(-0.3,-#3+0.35)$}  }
}
\cleftdoublesemi{#2}{#3}{#4} }

\newcommand{\csemidrighttrishaded}[4][0]{
\crightdoublesemi[fill=gray!50!white]{#2}{#3}{#4}
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+2}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(0.3,#3-0.35)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(0.3,-#3+0.35)$}  }
{+1}{\ctriangle[fill=white]{#2 marker}{0.3}{-0.3}{$(#2)+(0.3,#3-0.35)$}   }
{-1}{\ctriangle[fill=white]{#2 marker}{0.3}{0.3}{$(#2)+(0.3,-#3+0.35)$}  }
}
\crightdoublesemi{#2}{#3}{#4} }


% these put a flipped triangle in given corner.
\newcommand{\csemidrighttriflip}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+2}{\ctriangle[fill=black]{#2 marker}{-0.25}{0.25}{$(#2)+(0.28,#3-0.53)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{-0.25}{-0.25}{$(#2)+(0.28,-#3+0.53)$}  }
{+1}{\ctriangle[fill=white]{#2 marker}{-0.25}{0.25}{$(#2)+(0.3,#3-0.53)$}   }
{-1}{\ctriangle[fill=white]{#2 marker}{-0.25}{-0.25}{$(#2)+(0.3,-#3+0.53)$}  }
}
\crightdoublesemi{#2}{#3}{#4} }

\newcommand{\csemidlefttriflip}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{0.25}{0.25}{$(#2)+(-0.3,#3-0.53)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{0.25}{-0.25}{$(#2)+(-0.3,-#3+0.53)$}  }
{+2}{\ctriangle[fill=white]{#2 marker}{0.25}{0.25}{$(#2)+(-0.28,#3-0.53)$}   }
{-2}{\ctriangle[fill=white]{#2 marker}{0.25}{-0.25}{$(#2)+(-0.28,-#3+0.53)$}  }
}
\cleftdoublesemi{#2}{#3}{#4} }

% these put a flipped triangle in given corner with shading
\newcommand{\csemidrighttriflipshaded}[4][0]{
\crightdoublesemi[fill=gray!50!white]{#2}{#3}{#4}
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+2}{\ctriangle[fill=black]{#2 marker}{-0.25}{0.25}{$(#2)+(0.28,#3-0.53)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{-0.25}{-0.25}{$(#2)+(0.28,-#3+0.53)$}  }
{+1}{\ctriangle[fill=white]{#2 marker}{-0.25}{0.25}{$(#2)+(0.3,#3-0.53)$}   }
{-1}{\ctriangle[fill=white]{#2 marker}{-0.25}{-0.25}{$(#2)+(0.3,-#3+0.53)$}  }
}
\crightdoublesemi{#2}{#3}{#4} }

\newcommand{\csemidlefttriflipshaded}[4][0]{
\cleftdoublesemi[fill=gray!50!white]{#2}{#3}{#4}
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{0.25}{0.25}{$(#2)+(-0.3,#3-0.53)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{0.25}{-0.25}{$(#2)+(-0.3,-#3+0.53)$}  }
{+2}{\ctriangle[fill=white]{#2 marker}{0.25}{0.25}{$(#2)+(-0.28,#3-0.53)$}   }
{-2}{\ctriangle[fill=white]{#2 marker}{0.25}{-0.25}{$(#2)+(-0.28,-#3+0.53)$}  }
}
\cleftdoublesemi{#2}{#3}{#4} }


\newcommand{\Ccircledmark}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,#3-0.2)$}
     \crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,#3-0.2)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,-#3+0.2)$}
     \crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,-#3+0.2)$}}
}
\Ccircledouble{#2}{#3}{#4} }



\newcommand{\ccircledmark}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,#3-0.2)$}
     \crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,#3-0.2)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-0.2,-#3+0.2)$}
     \crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2)+(0.2,-#3+0.2)$}}
}
\ccircledouble{#2}{#3}{#4} }


\newcommand{\ccircledtriangle}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(-0.32,#3-0.35)$}
     \ctriangle[fill=white]{#2 marker}{0.3}{-0.3}{$(#2)+(0.32,#3-0.35)$}   }
{+2}{\ctriangle[fill=white]{#2 marker}{-0.3}{-0.3}{$(#2)+(-0.32,#3-0.35)$}
     \ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(0.32,#3-0.35)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(-0.32,-#3+0.35)$}
     \ctriangle[fill=white]{#2 marker}{0.3}{0.3}{$(#2)+(0.32,-#3+0.35)$}     }
{-2}{\ctriangle[fill=white]{#2 marker}{-0.3}{0.3}{$(#2)+(-0.32,-#3+0.35)$}
     \ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(0.32,-#3+0.35)$}     }
}
\ccircledouble{#2}{#3}{#4} }

\newcommand{\Ccircledtriangle}[4][0]{
\thispoint{#2}{#4}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(-0.32,#3-0.35)$}
     \ctriangle[fill=white]{#2 marker}{0.3}{-0.3}{$(#2)+(0.32,#3-0.35)$}   }
{+2}{\ctriangle[fill=white]{#2 marker}{-0.3}{-0.3}{$(#2)+(-0.32,#3-0.35)$}
     \ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(0.32,#3-0.35)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(-0.32,-#3+0.35)$}
     \ctriangle[fill=white]{#2 marker}{0.3}{0.3}{$(#2)+(0.32,-#3+0.35)$}     }
{-2}{\ctriangle[fill=white]{#2 marker}{-0.3}{0.3}{$(#2)+(-0.32,-#3+0.35)$}
     \ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(0.32,-#3+0.35)$}     }
}
\Ccircledouble{#2}{#3}{#4} }


\newcommand{\CeggSmark}[5][0]{
\ceggS[white]{#2}{#3}{#4}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 upper)+(-0.2,#3-0.2)$}
     \crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 upper)+(0.2,#3-0.2)$}   }
{+2}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 upper)+(-0.2,#3-0.2)$}
     \crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 upper)+(0.2,#3-0.2)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 lower)+(-0.2,-#3+0.2)$}
     \crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 lower)+(0.2,-#3+0.2)$}}
{-2}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 lower)+(-0.2,-#3+0.2)$}
     \crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 lower)+(0.2,-#3+0.2)$}}
}
\CeggS{#2}{#3}{#4}{#5}
}


\newcommand{\CeggZmark}[5][0]{
\ceggZ[white]{#2}{#3}{#4}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 upper)+(-0.2,#3-0.2)$}
     \crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 upper)+(0.2,#3-0.2)$}   }
{+2}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 upper)+(-0.2,#3-0.2)$}
     \crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 upper)+(0.2,#3-0.2)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 lower)+(-0.2,-#3+0.2)$}
     \crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 lower)+(0.2,-#3+0.2)$}}
{-2}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 lower)+(-0.2,-#3+0.2)$}
     \crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 lower)+(0.2,-#3+0.2)$}}
}
\CeggZ{#2}{#3}{#4}{#5}
}

\newcommand{\ceggZmark}[5][0]{
\ceggZ[white]{#2}{#3}{#4}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 upper)+(-0.2,#3-0.2)$}
     \crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 upper)+(0.2,#3-0.2)$}   }
{+2}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 upper)+(-0.2,#3-0.2)$}
     \crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 upper)+(0.2,#3-0.2)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 lower)+(-0.2,-#3+0.2)$}
     \crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 lower)+(0.2,-#3+0.2)$}}
{-2}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 lower)+(-0.2,-#3+0.2)$}
     \crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 lower)+(0.2,-#3+0.2)$}}
}
\ceggZ{#2}{#3}{#4}{#5}
}


\newcommand{\ceggSmark}[5][0]{
\ceggS[white]{#2}{#3}{#4}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 upper)+(-0.2,#3-0.2)$}
     \crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 upper)+(0.2,#3-0.2)$}   }
{+2}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 upper)+(-0.2,#3-0.2)$}
     \crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 upper)+(0.2,#3-0.2)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 lower)+(-0.2,-#3+0.2)$}
     \crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 lower)+(0.2,-#3+0.2)$}}
{-2}{\crectangle[fill=white]{#2 marker}{0.2}{0.2}{$(#2 lower)+(-0.2,-#3+0.2)$}
     \crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 lower)+(0.2,-#3+0.2)$}}
}
\ceggS{#2}{#3}{#4}{#5}
}


%%%%%%%%%%%%%%%%%%%%


%{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(-0.3,#3-0.35)$}   }
%{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(-0.3,-#3+0.35)$}  }
%{+2}{\ctriangle[fill=white]{#2 marker}{-0.3}{-0.3}{$(#2)+(-0.3,#3-0.35)$}   }
%{-2}{\ctriangle[fill=white]{#2 marker}{-0.3}{0.3}{$(#2)+(-0.3,-#3+0.35)$}  }

%{+2}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(0.3,#3-0.35)$}   }
%{-2}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(0.3,-#3+0.35)$}  }
%{+1}{\ctriangle[fill=white]{#2 marker}{0.3}{-0.3}{$(#2)+(0.3,#3-0.35)$}   }
%{-1}{\ctriangle[fill=white]{#2 marker}{0.3}{0.3}{$(#2)+(0.3,-#3+0.35)$}  }


\newcommand{\CeggStriangle}[5][0]{
\ceggS[white]{#2}{#3}{#4}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2 upper)+(-0.32,#3-0.35)$}
     \ctriangle[fill=white]{#2 marker}{0.3}{-0.3}{$(#2 upper)+(0.32,#3-0.35)$}   }
{+2}{\ctriangle[fill=white]{#2 marker}{-0.3}{-0.3}{$(#2 upper)+(-0.32,#3-0.35)$}
     \ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2 upper)+(0.32,#3-0.35)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2 lower)+(-0.32,-#3+0.35)$}
     \ctriangle[fill=white]{#2 marker}{0.3}{0.3}{$(#2 lower)+(0.32,-#3+0.35)$}     }
{-2}{\ctriangle[fill=white]{#2 marker}{-0.3}{0.3}{$(#2 lower)+(-0.32,-#3+0.35)$}
     \ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2 lower)+(0.32,-#3+0.35)$}     }
}
\CeggS{#2}{#3}{#4}{#5}
}


\newcommand{\CeggZtriangle}[5][0]{
\ceggZ[white]{#2}{#3}{#4}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2 upper)+(-0.32,#3-0.35)$}
     \ctriangle[fill=white]{#2 marker}{0.3}{-0.3}{$(#2 upper)+(0.32,#3-0.35)$}   }
{+2}{\ctriangle[fill=white]{#2 marker}{-0.3}{-0.3}{$(#2 upper)+(-0.32,#3-0.35)$}
     \ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2 upper)+(0.32,#3-0.35)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2 lower)+(-0.32,-#3+0.35)$}
     \ctriangle[fill=white]{#2 marker}{0.3}{0.3}{$(#2 lower)+(0.32,-#3+0.35)$}     }
{-2}{\ctriangle[fill=white]{#2 marker}{-0.3}{0.3}{$(#2 lower)+(-0.32,-#3+0.35)$}
     \ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2 lower)+(0.32,-#3+0.35)$}     }
}
\CeggZ{#2}{#3}{#4}{#5}
}

\newcommand{\ceggZtriangle}[5][0]{
\ceggZ[white]{#2}{#3}{#4}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2 upper)+(-0.32,#3-0.35)$}
     \ctriangle[fill=white]{#2 marker}{0.3}{-0.3}{$(#2 upper)+(0.32,#3-0.35)$}   }
{+2}{\ctriangle[fill=white]{#2 marker}{-0.3}{-0.3}{$(#2 upper)+(-0.32,#3-0.35)$}
     \ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2 upper)+(0.32,#3-0.35)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2 lower)+(-0.32,-#3+0.35)$}
     \ctriangle[fill=white]{#2 marker}{0.3}{0.3}{$(#2 lower)+(0.32,-#3+0.35)$}     }
{-2}{\ctriangle[fill=white]{#2 marker}{-0.3}{0.3}{$(#2 lower)+(-0.32,-#3+0.35)$}
     \ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2 lower)+(0.32,-#3+0.35)$}     }
}
\ceggZ{#2}{#3}{#4}{#5}
}


\newcommand{\ceggStriangle}[5][0]{
\ceggS[white]{#2}{#3}{#4}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2 upper)+(-0.32,#3-0.35)$}
     \ctriangle[fill=white]{#2 marker}{0.3}{-0.3}{$(#2 upper)+(0.32,#3-0.35)$}   }
{+2}{\ctriangle[fill=white]{#2 marker}{-0.3}{-0.3}{$(#2 upper)+(-0.32,#3-0.35)$}
     \ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2 upper)+(0.32,#3-0.35)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2 lower)+(-0.32,-#3+0.35)$}
     \ctriangle[fill=white]{#2 marker}{0.3}{0.3}{$(#2 lower)+(0.32,-#3+0.35)$}     }
{-2}{\ctriangle[fill=white]{#2 marker}{-0.3}{0.3}{$(#2 lower)+(-0.32,-#3+0.35)$}
     \ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2 lower)+(0.32,-#3+0.35)$}     }
}
\ceggS{#2}{#3}{#4}{#5}
}



%%%%%%%%%%%%%%%%%






%\crectangledleft[+1]{A}{1}{1}{0,0} +1 puts marker in top corner.
\newcommand{\crectangledleft}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,-#4+0.36)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,#4-0.35)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,-#4+0.36)$}  }
}
\cleftthinbox{#2}{#3}{#4}{#5} }

\newcommand{\Crectangledleft}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,-#4+0.36)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,#4-0.35)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,-#4+0.36)$}  }
}
\Cleftthinbox{#2}{#3}{#4}{#5} }


\newcommand{\crectangledleftold}[5][0]{
\pgfmathsetmacro{\sizex}{#3-0.08}
\pgfmathsetmacro{\sizey}{#4-0.16}
\crectangle[thick]{#2 inner}{\sizex}{\sizey}{$(#5)+(+0.08,0)$}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(-#3+0.28,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(-#3+0.28,-#4+0.36)$}  }
}
\crectangle[thick]{#2}{#3}{#4}{#5} }

\newcommand{\crectangledright}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,-#4+0.36)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,#4-0.35)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,-#4+0.36)$}  }

}
\crightthinbox{#2}{#3}{#4}{#5} }

\newcommand{\Crectangledright}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,-#4+0.36)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,#4-0.35)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,-#4+0.36)$}  }
}
\Crightthinbox{#2}{#3}{#4}{#5} }



\newcommand{\crectangledleftshaded}[5][0]{
\cleftthinbox[fill=gray!50!white]{#2}{#3}{#4}{#5}
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,-#4+0.36)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,#4-0.35)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,-#4+0.36)$}  }
}
\cleftthinbox{#2}{#3}{#4}{#5} }

\newcommand{\crectangledrightshaded}[5][0]{
\crightthinbox[fill=gray!50!white]{#2}{#3}{#4}{#5}
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,-#4+0.36)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,#4-0.35)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,-#4+0.36)$}  }
}
\crightthinbox{#2}{#3}{#4}{#5} }

% These are S and Z boxes (they have double border in shape of S or Z) that allow sq. dot markings

\newcommand{\crectangleSbox}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,-#4+0.36)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,#4-0.35)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,-#4+0.36)$}  }
}
\ctransposeboxS{#2}{#3}{#4}{#5} }

\newcommand{\CrectangleSbox}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,-#4+0.36)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,#4-0.35)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,-#4+0.36)$}  }
}
\CtransposeboxS{#2}{#3}{#4}{#5} }

\newcommand{\crectangleZbox}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,-#4+0.36)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,#4-0.35)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,-#4+0.36)$}  }
}
\ctransposeboxZ{#2}{#3}{#4}{#5} }

\newcommand{\CrectangleZbox}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,-#4+0.36)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,#4-0.35)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,-#4+0.36)$}  }
}
\CtransposeboxZ{#2}{#3}{#4}{#5} }


% These place a small triangle (rather than a square) in corner.

\newcommand{\crectangleZboxtriangle}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(-#3+0.3,#4-0.45)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(-#3+0.3,-#4+0.46)$}  }
{+2}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(#3-0.3,#4-0.45)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(#3-0.3,-#4+0.46)$}  }
}
\ctransposeboxZ{#2}{#3}{#4}{#5} }

\newcommand{\CrectangleZboxtriangle}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(-#3+0.3,#4-0.45)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(-#3+0.3,-#4+0.46)$}  }
{+2}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(#3-0.3,#4-0.45)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(#3-0.3,-#4+0.46)$}  }
}
\CtransposeboxZ{#2}{#3}{#4}{#5} }


\newcommand{\crectangleSboxtriangle}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(-#3+0.3,#4-0.45)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(-#3+0.3,-#4+0.46)$}  }
{+2}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(#3-0.3,#4-0.45)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(#3-0.3,-#4+0.46)$}  }
}
\ctransposeboxS{#2}{#3}{#4}{#5} }

\newcommand{\CrectangleSboxtriangle}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(-#3+0.3,#4-0.45)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(-#3+0.3,-#4+0.46)$}  }
{+2}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(#3-0.3,#4-0.45)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(#3-0.3,-#4+0.46)$}  }
}
\CtransposeboxS{#2}{#3}{#4}{#5} }


% These place a small triangle in corner


\newcommand{\crectangledlefttriangle}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(-#3+0.3,#4-0.45)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(-#3+0.3,-#4+0.46)$}  }
{+2}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(#3-0.3,#4-0.45)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(#3-0.3,-#4+0.46)$}  }
}
\cleftthinbox{#2}{#3}{#4}{#5} }

\newcommand{\Crectangledlefttriangle}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(-#3+0.3,#4-0.45)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(-#3+0.3,-#4+0.46)$}  }
{+2}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(#3-0.3,#4-0.45)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(#3-0.3,-#4+0.46)$}  }
}
\Cleftthinbox{#2}{#3}{#4}{#5} }

\newcommand{\crectangledrighttriangle}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+2}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(-#3+0.3,#4-0.45)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(-#3+0.3,-#4+0.46)$}  }
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(#3-0.3,#4-0.45)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(#3-0.3,-#4+0.46)$}  }
}
\crightthinbox{#2}{#3}{#4}{#5} }


\newcommand{\Crectangledrighttriangle}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+2}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(-#3+0.3,#4-0.45)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(-#3+0.3,-#4+0.46)$}  }
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(#3-0.3,#4-0.45)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(#3-0.3,-#4+0.46)$}  }
}
\Crightthinbox{#2}{#3}{#4}{#5} }


% These place a small flipped triangle in corner

\newcommand{\crectangledrighttriflip}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+2}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(-#3+0.37,#4-0.45)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(-#3+0.37,-#4+0.40)$}  }
{+1}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(#3-0.44,#4-0.44)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(#3-0.44,-#4+0.44)$}  }
}
\crightthinbox{#2}{#3}{#4}{#5} }


\newcommand{\crectangledlefttriflip}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(-#3+0.44,#4-0.44)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(-#3+0.44,-#4+0.44)$}  }
{+2}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(#3-0.37,#4-0.45)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{0.25}{-0.25}{$(#2)+(#3-0.32,-#4+0.40)$}  }
}
\cleftthinbox{#2}{#3}{#4}{#5} }




% These place a small diamond marker in corner


\newcommand{\crectangledleftdiamond}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.36,#4-0.35)$}   }
{-1}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.36,-#4+0.36)$}  }
{+2}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.36,#4-0.35)$}   }
{-2}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.36,-#4+0.36)$}  }
}
\cleftthinbox{#2}{#3}{#4}{#5} }

\newcommand{\Crectangledleftdiamond}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.36,#4-0.35)$}   }
{-1}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.36,-#4+0.36)$}  }
{+2}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.36,#4-0.35)$}   }
{-2}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.36,-#4+0.36)$}  }
}
\Cleftthinbox{#2}{#3}{#4}{#5} }


\newcommand{\crectangledrightdiamond}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.36,#4-0.35)$}   }
{-1}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.36,-#4+0.36)$}  }
{+2}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.36,#4-0.35)$}   }
{-2}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.36,-#4+0.36)$}  }

}
\crightthinbox{#2}{#3}{#4}{#5} }


\newcommand{\Crectangledrightdiamond}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.36,#4-0.35)$}   }
{-1}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.36,-#4+0.36)$}  }
{+2}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.36,#4-0.35)$}   }
{-2}{\cdiamond[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.36,-#4+0.36)$}  }

}
\Crightthinbox{#2}{#3}{#4}{#5} }



% next two commands place a small circle in corner (depending on option) two commands after that put a square.
\newcommand{\crectanglethindot}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ccircle[fill=black]{#2 marker}{0.2}{$(#2)+(-#3+0.4,#4-0.4)$}   }
{-1}{\ccircle[fill=black]{#2 marker}{0.2}{$(#2)+(-#3+0.4,-#4+0.4)$}  }
{+2}{\ccircle[fill=black]{#2 marker}{0.2}{$(#2)+(#3-0.4,#4-0.4)$}   }
{-2}{\ccircle[fill=black]{#2 marker}{0.2}{$(#2)+(#3-0.4,-#4+0.4)$}  }
}
\crectangle[thin]{#2}{#3}{#4}{#5} }


\newcommand{\Crectanglethindot}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ccircle[fill=black]{#2 marker}{0.2}{$(#2)+(-#3+0.4,#4-0.4)$}   }
{-1}{\ccircle[fill=black]{#2 marker}{0.2}{$(#2)+(-#3+0.4,-#4+0.4)$}  }
{+2}{\ccircle[fill=black]{#2 marker}{0.2}{$(#2)+(#3-0.4,#4-0.4)$}   }
{-2}{\ccircle[fill=black]{#2 marker}{0.2}{$(#2)+(#3-0.4,-#4+0.4)$}  }
}
\Crectangle[thin]{#2}{#3}{#4}{#5} }


\newcommand{\crectanglethinsquaredot}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,#4-0.2)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,-#4+0.2)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,#4-0.2)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,-#4+0.2)$}  }
}
\crectangle[thin]{#2}{#3}{#4}{#5} }


\newcommand{\Crectanglethinsquaredot}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,#4-0.2)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(-#3+0.2,-#4+0.2)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,#4-0.2)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2)+(#3-0.2,-#4+0.2)$}  }
}
\Crectangle[thin]{#2}{#3}{#4}{#5} }


%\crectangledright[thick]{A}{1}{1}{0,0}
\newcommand{\crectangledrightold}[5][0]{
\pgfmathsetmacro{\sizex}{#3-0.08}
\pgfmathsetmacro{\sizey}{#4-0.16}
\crectangle[thick]{#2 inner}{\sizex}{\sizey}{$(#5)+(-0.08,0)$}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(#3-0.28,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(#3-0.28,-#4+0.36)$}  }
}
\crectangle[thick]{#2}{#3}{#4}{#5} }

%\Crectangledleft[thick]{A}{1}{1}{0,0}
\newcommand{\Crectangledleftold}[5][0]{
\pgfmathsetmacro{\sizex}{#3-0.08}
\pgfmathsetmacro{\sizey}{#4-0.16}
\crectangle[thick]{#2 inner}{\sizex}{\sizey}{$(#5)+(+0.08,0)$}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(-#3+0.28,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(-#3+0.28,-#4+0.36)$}  }
}
\Crectangle[thick]{#2}{#3}{#4}{#5} }

%\Crectangledright[thick]{A}{1}{1}{0,0}
\newcommand{\Crectangledrightold}[5][0]{
\pgfmathsetmacro{\sizex}{#3-0.08}
\pgfmathsetmacro{\sizey}{#4-0.16}
\crectangle[thick]{#2 inner}{\sizex}{\sizey}{$(#5)+(-0.08,0)$}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(#3-0.28,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(#3-0.28,-#4+0.36)$}  }
}
\Crectangle[thick]{#2}{#3}{#4}{#5} }

%\Crectangledmark[-1]{A}{1}{1}{0,0}
\newcommand{\Crectangledmark}[5][0]{
\pgfmathsetmacro{\sizex}{#3-0.08}
\pgfmathsetmacro{\sizey}{#4-0.16}
\thispoint{#2 inner}{$(#5)+(-0.08,0)$}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(-#3+0.28,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(-#3+0.28,-#4+0.36)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(#3-0.28,#4-0.35)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(#3-0.28,-#4+0.36)$}  }
}
\Crectangledouble{#2}{#3}{#4}{#5} }


%\Crectangledmark[thick]{A}{1}{1}{0,0}
\newcommand{\crectangledmark}[5][0]{
\pgfmathsetmacro{\sizex}{#3-0.08}
\pgfmathsetmacro{\sizey}{#4-0.16}
\thispoint{#2 inner}{$(#5)+(-0.08,0)$}
\IfEqCase{#1}{
{0}{}
{+1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(-#3+0.28,#4-0.35)$}   }
{-1}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(-#3+0.28,-#4+0.36)$}  }
{+2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(#3-0.28,#4-0.35)$}   }
{-2}{\crectangle[fill=black]{#2 marker}{0.2}{0.2}{$(#2 inner)+(#3-0.28,-#4+0.36)$}  }
}
\crectangledouble{#2}{#3}{#4}{#5} }







%\Crectangledmark[thick]{A}{1}{1}{0,0}
\newcommand{\crectangledmarktriangle}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(-#3+0.3,#4-0.45)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(-#3+0.3,-#4+0.46)$}  }
{+2}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(#3-0.3,#4-0.45)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(#3-0.3,-#4+0.46)$}  }
}
\crectangledouble{#2}{#3}{#4}{#5} }




%\Crectangledmark[-1]{A}{1}{1}{0,0}
\newcommand{\Crectangledmarktriangle}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(-#3+0.3,#4-0.45)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(-#3+0.3,-#4+0.46)$}  }
{+2}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(#3-0.3,#4-0.45)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(#3-0.3,-#4+0.46)$}  }
}
\Crectangledouble{#2}{#3}{#4}{#5} }


% Haven't fully tested below yet

\newcommand{\crectangledmarktriflip}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(-#3+0.44,#4-0.44)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(-#3+0.44,-#4+0.44)$}  }
{+2}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(#3-0.44,#4-0.44)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(#3-0.44,-#4+0.44)$}  }
}
\crectangledouble{#2}{#3}{#4}{#5} }


\newcommand{\Crectangledmarktriflip}[5][0]{
\thispoint{#2}{#5}
\IfEqCase{#1}{
{0}{}
{+1}{\ctriangle[fill=black]{#2 marker}{-0.3}{0.3}{$(#2)+(-#3+0.44,#4-0.44)$}   }
{-1}{\ctriangle[fill=black]{#2 marker}{-0.3}{-0.3}{$(#2)+(-#3+0.44,-#4+0.44)$}  }
{+2}{\ctriangle[fill=black]{#2 marker}{0.3}{0.3}{$(#2)+(#3-0.44,#4-0.44)$}   }
{-2}{\ctriangle[fill=black]{#2 marker}{0.3}{-0.3}{$(#2)+(#3-0.44,-#4+0.44)$}  }
}
\Crectangledouble{#2}{#3}{#4}{#5} }




%\fiddedupwire{name}{position}{symbol}
\newcommand{\fiddyupwire}[3]{  \supsysfid{#1 fid}{$(#2,5.5)+(#1)$} \thispoint{#1 point}{$(#2,7)+(#1)$} \csymbolalt[0,20]{#3} \jointbnoarrow{#1 fid}{0}{#1 point}{0} \jointbnoarrowdotswb[right]{#1}{#2}{#1 fid}{0}\csymbolthird[10,0]{#3} }
\newcommand{\fiddydownwire}[3]{\sdownsysfid{#1 fid}{$(#2,-5.5)+(#1)$} \thispoint{#1 point}{$(#2,-7)+(#1)$} \csymbolalt[0,-20]{#3} \joinbtnoarrow{#1 fid}{0}{#1 point}{0} \joinbtnoarrowdotswb[right]{#1}{#2}{#1 fid}{0}\csymbolthird[10,0]{#3} }
\newcommand{\fidopupwire}[3]{\supopfid{#1 fid}{$(#2,5.5)+(#1)$} \thispoint{#1 point}{$(#2,7)+(#1)$} \csymbolalt[0,20]{#3} \jointbnoarrow{#1 fid}{0}{#1 point}{0} \jointbnoarrowdotswb[right]{#1}{#2}{#1 fid}{0}\csymbolthird[10,0]{#3} }
\newcommand{\fidopdownwire}[3]{\sdownopfid{#1 fid}{$(#2,-5.5)+(#1)$} \thispoint{#1 point}{$(#2,-7)+(#1)$} \csymbolalt[0,-20]{#3} \joinbtnoarrow{#1 fid}{0}{#1 point}{0} \joinbtnoarrowdotswb[right]{#1}{#2}{#1 fid}{0}\csymbolthird[10,0]{#3} }
%
\newcommand{\cfiddyupwire}[3]{  \supsysfid{#1 fid}{$(#2,3)+(#1)+(#1 top)$} \thispoint{#1 point}{$(#2,4.5)+(#1)+(#1 top)$} \csymbolalt[0,20]{#3} \jointbnoarrow{#1 fid}{0}{#1 point}{0} \jointbnoarrowdotswb[right]{#1}{#2}{#1 fid}{0}\csymbolthird[10,0]{#3} }
\newcommand{\cfiddydownwire}[3]{\sdownsysfid{#1 fid}{$(#2,-3)+(#1)-(#1 top)$} \thispoint{#1 point}{$(#2,-4.5)+(#1)-(#1 top)$} \csymbolalt[0,-20]{#3} \joinbtnoarrow{#1 fid}{0}{#1 point}{0} \joinbtnoarrowdotswb[right]{#1}{#2}{#1 fid}{0}\csymbolthird[10,0]{#3} }
\newcommand{\cfidopupwire}[3]{\supopfid{#1 fid}{$(#2,3)+(#1)+(#1 top)$} \thispoint{#1 point}{$(#2,4.5)+(#1)+(#1 top)$} \csymbolalt[0,20]{#3} \jointbnoarrow{#1 fid}{0}{#1 point}{0} \jointbnoarrowdotswb[right]{#1}{#2}{#1 fid}{0}\csymbolthird[10,0]{#3} }
\newcommand{\cfidopdownwire}[3]{\sdownopfid{#1 fid}{$(#2,-3)+(#1)-(#1 top)$} \thispoint{#1 point}{$(#2,-4.5)+(#1)-(#1 top)$} \csymbolalt[0,-20]{#3} \joinbtnoarrow{#1 fid}{0}{#1 point}{0} \joinbtnoarrowdotswb[right]{#1}{#2}{#1 fid}{0}\csymbolthird[10,0]{#3} }
%

\newcommand{\fiddyrightwire}[3]{  \sleftdatafid{#1 fid}{$(4.5, #2)+(#1)$} \thispoint{#1 point}{$(7, #2)+(#1)$} \csymbolalt[20,0]{#3}
\joinrlnoarrowthick{#1 fid}{0}{#1 point}{0} \joinrlnoarrowwb[above]{#1}{#2}{#1 fid}{0}\csymbolthird[0,10]{#3} }
\newcommand{\fiddyleftwire}[3]{\srightdatafid{#1 fid}{$(-4.5,#2)+(#1)$} \thispoint{#1 point}{$(-7,#2)+(#1)$} \csymbolalt[-20,0]{#3}
\joinlrnoarrowthick{#1 fid}{0}{#1 point}{0} \joinlrnoarrowwb[above]{#1}{#2}{#1 fid}{0}\csymbolthird[0,10]{#3} }

\newcommand{\cfiddyrightwire}[3]{  \sleftdatafid{#1 fid}{$(3, #2)+(#1)+(#1 right)$} \thispoint{#1 point}{$(4.5, #2)+(#1)+(#1 right)$} \csymbolalt[20,0]{#3}
\joinrlnoarrowthick{#1 fid}{0}{#1 point}{0} \joinrlnoarrowwb[above]{#1}{#2}{#1 fid}{0}\csymbolthird[0,10]{#3} }
\newcommand{\cfiddyleftwire}[3]{\srightdatafid{#1 fid}{$(-3,#2)+(#1)-(#1 right)$} \thispoint{#1 point}{$(-4.5,#2)+(#1)-(#1 right)$} \csymbolalt[-20,0]{#3}
\joinlrnoarrowthick{#1 fid}{0}{#1 point}{0} \joinlrnoarrowwb[above]{#1}{#2}{#1 fid}{0}\csymbolthird[0,10]{#3} }

\newcommand{\cfidoprightwire}[3]{  \sleftvecfid{#1 fid}{$(3, #2)+(#1)+(#1 right)$} \thispoint{#1 point}{$(4.5, #2)+(#1)+(#1 right)$} \csymbolalt[20,0]{#3}
\joinrlnoarrowthick{#1 fid}{0}{#1 point}{0} \joinrlnoarrowwb[above]{#1}{#2}{#1 fid}{0}\csymbolthird[0,10]{#3} }
\newcommand{\cfidopleftwire}[3]{\srightvecfid{#1 fid}{$(-3,#2)+(#1)-(#1 right)$} \thispoint{#1 point}{$(-4.5,#2)+(#1)-(#1 right)$} \csymbolalt[-20,0]{#3}
\joinlrnoarrowthick{#1 fid}{0}{#1 point}{0} \joinlrnoarrowwb[above]{#1}{#2}{#1 fid}{0}\csymbolthird[0,10]{#3} }


\newcommand{\fiddyrightwirebw}[3]{  \sleftdatafid{#1 fid}{$(4.5, #2)+(#1)$} \thispoint{#1 point}{$(7, #2)+(#1)$} \csymbolalt[20,0]{#3}
\joinrlnoarrowthick{#1 fid}{0}{#1 point}{0} \joinrlnoarrowbw[above]{#1}{#2}{#1 fid}{0}\csymbolthird[0,10]{#3} }
\newcommand{\fiddyleftwirewb}[3]{\srightdatafid{#1 fid}{$(-4.5,#2)+(#1)$} \thispoint{#1 point}{$(-7,#2)+(#1)$} \csymbolalt[-20,0]{#3}
\joinlrnoarrowthick{#1 fid}{0}{#1 point}{0} \joinlrnoarrowbw[above]{#1}{#2}{#1 fid}{0}\csymbolthird[0,10]{#3} }

\newcommand{\fidoprightwire}[3]{  \sleftvecfid{#1 fid}{$(4.5, #2)+(#1)$} \thispoint{#1 point}{$(7, #2)+(#1)$} \csymbolalt[20,0]{#3}
\joinrlnoarrowthick{#1 fid}{0}{#1 point}{0} \joinrlnoarrowwb[above]{#1}{#2}{#1 fid}{0}\csymbolthird[0,10]{#3} }
\newcommand{\fidopleftwire}[3]{\srightvecfid{#1 fid}{$(-4.5,#2)+(#1)$} \thispoint{#1 point}{$(-7,#2)+(#1)$} \csymbolalt[-20,0]{#3}
\joinlrnoarrowthick{#1 fid}{0}{#1 point}{0} \joinlrnoarrowwb[above]{#1}{#2}{#1 fid}{0}\csymbolthird[0,10]{#3} }

\newcommand{\fidoprightwirebw}[3]{  \sleftvecfid{#1 fid}{$(4.5, #2)+(#1)$} \thispoint{#1 point}{$(7, #2)+(#1)$} \csymbolalt[20,0]{#3}
\joinrlnoarrowthick{#1 fid}{0}{#1 point}{0} \joinrlnoarrowbw[above]{#1}{#2}{#1 fid}{0}\csymbolthird[0,10]{#3} }
\newcommand{\fidopleftwirewb}[3]{\srightvecfid{#1 fid}{$(-4.5,#2)+(#1)$} \thispoint{#1 point}{$(-7,#2)+(#1)$} \csymbolalt[-20,0]{#3}
\joinlrnoarrowthick{#1 fid}{0}{#1 point}{0} \joinlrnoarrowbw[above]{#1}{#2}{#1 fid}{0}\csymbolthird[0,10]{#3} }





% \newcommand{\upwire}[3]{  \thispoint{#1 point}{#2,5}  \csymbolalt[0,20]{#3} \jointbnoarrow{#1}{#2}{#1 point}{0}  }
\newcommand{\upwire}[3]{ \relpoint{#1}{#2,5}{#1 point}  \csymbolalt[0,20]{#3} \jointbnoarrow{#1}{#2}{#1 point}{0}  }
\newcommand{\downwire}[3]{ \relpoint{#1}{#2,-5}{#1 point} \csymbolalt[0,-20]{#3} \joinbtnoarrow{#1}{#2}{#1 point}{0} }
%\thispoint{#1 point}{#2,-5} \csymbolalt[0,-20]{#3} \joinbtnoarrow{#1}{#2}{#1 point}{0} }

\newcommand{\cupwire}[3]{ \relpoint{$(#1)+(#1 top)$}{#2,2}{#1 point}  \csymbolalt[0,20]{#3} \jointbnoarrow{#1}{#2}{#1 point}{0}  }
\newcommand{\cdownwire}[3]{ \relpoint{$(#1)-(#1 top)$}{#2,-2}{#1 point} \csymbolalt[0,-20]{#3} \joinbtnoarrow{#1}{#2}{#1 point}{0} }


\newcommand{\dotfiddownwire}[3]{\supsysfid{#1 fid}{$(#2,-4.5)+(#1)$} \blackdot{#1 point}{$(#2,-6)+(#1)$} \csymbolthird[0,-24]{#3} \joinbtnoarrow{#1 fid}{0}{#1 point}{0} \joinbtnoarrow[right]{#1}{#2}{#1 fid}{0}\csymbolalt[5,0]{#3} }
\newcommand{\dotfidupwire}[3]{\sdownsysfid{#1 fid}{$(#2,4.5)+(#1)$} \blackdot{#1 point}{$(#2,6)+(#1)$} \csymbolthird[0,24]{#3} \jointbnoarrow{#1 fid}{0}{#1 point}{0} \jointbnoarrow[right]{#1}{#2}{#1 fid}{0}\csymbolalt[5,0]{#3} }
\newcommand{\whitedotfiddownwire}[3]{\supsysfid{#1 fid}{$(#2,-4.5)+(#1)$} \whitedot{#1 point}{$(#2,-6)+(#1)$} \csymbolthird[0,-24]{#3} \joinbtnoarrow{#1 fid}{0}{#1 point}{0} \joinbtnoarrow[right]{#1}{#2}{#1 fid}{0}\csymbolalt[5,0]{#3} }
\newcommand{\whitedotfidupwire}[3]{\sdownsysfid{#1 fid}{$(#2,4.5)+(#1)$} \whitedot{#1 point}{$(#2,6)+(#1)$} \csymbolthird[0,24]{#3} \jointbnoarrow{#1 fid}{0}{#1 point}{0} \jointbnoarrow[right]{#1}{#2}{#1 fid}{0}\csymbolalt[5,0]{#3} }


%
\newcommand{\dotupwire}[3]{   \blackdot{#1 point}{$(#2,5)+(#1)$}  \csymbolthird[0,25]{#3} \jointbnoarrow{#1}{#2}{#1 point}{0}  }
\newcommand{\dotdownwire}[3]{ \blackdot{#1 point}{$(#2,-5)+(#1)$} \csymbolthird[0,-25]{#3} \joinbtnoarrow{#1}{#2}{#1 point}{0} }
\newcommand{\whitedotupwire}[3]{   \whitedot{#1 point}{$(#2,5)+(#1)$}  \csymbolthird[0,25]{#3} \jointbnoarrow{#1}{#2}{#1 point}{0}  }
\newcommand{\whitedotdownwire}[3]{ \whitedot{#1 point}{$(#2,-5)+(#1)$} \csymbolthird[0,-25]{#3} \joinbtnoarrow{#1}{#2}{#1 point}{0} }
%
% following four commands not tested.
\newcommand{\blacksquarerightwire}[3]{   \blackdotsq{#1 point}{$(2,#2)+(#1)$}  \csymbolthird[25,0]{#3} \joinrlnoarrow{#1}{#2}{#1 point}{0}  }
\newcommand{\blacksquareleftwire}[3]{ \blackdotsq{#1 point}{$(-2, #2)+(#1)$} \csymbolthird[-25, 0]{#3} \joinlrnoarrow{#1}{#2}{#1 point}{0} }
\newcommand{\whitesquarerightwire}[3]{   \whitedotsq{#1 point}{$(2,#2)+(#1)$}  \csymbolthird[25,0]{#3} \joinrlnoarrow{#1}{#2}{#1 point}{0}  }
\newcommand{\whitesquareleftwire}[3]{ \whitedotsq{#1 point}{$(-2, #2)+(#1)$} \csymbolthird[-25, 0]{#3} \joinlrnoarrow{#1}{#2}{#1 point}{0} }


% \incomewire[5]{A}{d}{45}  attach wire to circle A with d at angle 45 with font placed at [10,15].  Option is lenght of wire.
\newcommand{\incomewirecc}[4][5]{
\relpoint{#2}{#4:#1}{#3}   \joincc{#3}{180+#4}{#2}{#4} \relpoint{#2}{#4:#1}{#3}
}

\newcommand{\outcomewirecc}[4][5]{
\relpoint{#2}{#4:#1}{#3}   \joincc{#2}{#4}{#3}{180+#4} \relpoint{#2}{#4:#1}{#3}
}



%\incomewire[wider]{A}{position on A}{symbol}  \incomewire{B}{0}{x}
\newcommand{\incomewire}[4][1]{\path[thick] (-3*#1,#3)+(#2) coordinate (R); \thispoint{R #2}{R} \csymbol[-20,0]{\mathtt{#4}}
\joinlrnoarrowthick[above]{#2}{#3}{R #2}{0} }
\newcommand{\outcomewire}[4][1]{\path[thick] (3*#1,#3)+(#2) coordinate (R); \thispoint{R #2}{R} \csymbol[20,0]{\mathtt{#4}}
\joinrlnoarrowthick[above]{#2}{#3}{R #2}{0} }

\newcommand{\cincomewire}[4][1]{\path[thick] ($(-2*#1,#3)+(#2)-(#2 right)$) coordinate (R); \thispoint{R #2}{R} \csymbol[-20,0]{\mathtt{#4}}
\joinlrnoarrowthick[above]{#2}{#3}{R #2}{0} }
\newcommand{\coutcomewire}[4][1]{\path[thick] (2*#1,#3)+(#2) + (#2 right) coordinate (R); \thispoint{R #2}{R} \csymbol[20,0]{\mathtt{#4}}
\joinrlnoarrowthick[above]{#2}{#3}{R #2}{0} }


%\Rincome[wider]{A}{position on A}{symbol}  \Rincome{B}{0}{x}
\newcommand{\Rincome}[4][1]{\path (-4*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R} \csymbol{\mathsf{R}}
\joinlrnoarrowthick[above]{#2}{#3}{R #2}{0} \csymbol{\mathtt{#4}} }
\newcommand{\Routcome}[4][1]{\path (4*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R} \csymbol{\mathsf{R}}
\joinrlnoarrowthick[above]{#2}{#3}{R #2}{0} \csymbol{\mathtt{#4}} }

%\Rincomedouble[wider]{A}{position on A}{symbol}  \Rincome{B}{0}{x}
\newcommand{\Rincomedouble}[4][1]{\path (-4*#1,#3)+(#2) coordinate (R); \crectangledouble{R #2}{0.8}{1}{R} \csymbol{\mathsf{R}}
\joinlrnoarrowthick[above]{#2}{#3}{R #2}{0} \csymbolthird{\mathtt{#4}} }
\newcommand{\Routcomedouble}[4][1]{\path (4*#1,#3)+(#2) coordinate (R); \crectangledouble{R #2}{0.8}{1}{R} \csymbol{\mathsf{R}}
\joinrlnoarrowthick[above]{#2}{#3}{R #2}{0} \csymbolthird{\mathtt{#4}} }


%\cxconditionincome[wider]{A}{position on A}{symbol}  \Rincome{B}{0}{x}
\newcommand{\cxconditionincome}[4][1]{\path (-4*#1,#3)+(#2) coordinate (R); \cincome{R #2}{0.7}{0.9}{R} \csymbolfourth{#4}
\joinlrnoarrowthick[above]{#2}{#3}{R #2}{0} \csymbol{\mathtt{#4}} }
\newcommand{\cxconditionoutcome}[4][1]{\path (4*#1,#3)+(#2) coordinate (R); \coutcome{R #2}{0.7}{0.9}{R} \csymbolfourth{#4}
\joinrlnoarrowthick[above]{#2}{#3}{R #2}{0} \csymbol{\mathtt{#4}} }

\newcommand{\cxpreselectincome}[4][1]{\path (-4*#1,#3)+(#2) coordinate (R); \cpreselect{R #2}{0.7}{0.9}{R} \csymbolfourth{#4}
\joinlrnoarrowthick[above]{#2}{#3}{R #2}{0} \csymbol{\mathtt{#4}} }

%  I haven't tested the command below but it should work as the one above works.
\newcommand{\cxpostselectoutcome}[4][1]{\path (4*#1,#3)+(#2) coordinate (R); \cpostselect{R #2}{0.7}{0.9}{R} \csymbolfourth{#4}
\joinrlnoarrowthick[above]{#2}{#3}{R #2}{0} \csymbol{\mathtt{#4}} }



\newcommand{\cxconditionincomedouble}[4][1]{\path (-4*#1,#3)+(#2) coordinate (R); \cincome[fill=white]{R #2}{0.8}{1}{R} \csymbolfourth{#4}
\joinlrnoarrowthick[above]{#2}{#3}{R #2}{0} \csymbol{\mathtt{#4}} \cincome[thick, double]{R #2}{0.8}{1}{R} \csymbolfourth{#4} }
\newcommand{\cxconditionoutcomedouble}[4][1]{\path (4*#1,#3)+(#2) coordinate (R); \coutcome[fill=white]{R #2}{0.8}{1}{R} \csymbolfourth{#4}
\joinrlnoarrowthick[above]{#2}{#3}{R #2}{0} \csymbol{\mathtt{#4}} \coutcome[thick, double]{R #2}{0.8}{1}{R} \csymbolfourth{#4}  }


%\Rincomedouble[wider]{A}{position on A}{symbol}  \Rincome{B}{0}{x}
%\newcommand{\Rincomedouble}[4][1]{\path (-4*#1,#3)+(#2) coordinate (R); \crectangledouble{R #2}{0.8}{1}{R} \csymbol{\mathsf{R}}
%\joinlrnoarrowthick[above]{#2}{#3}{R #2}{0} \csymbolthird{\mathtt{#4}} }
%\newcommand{\Routcomedouble}[4][1]{\path (4*#1,#3)+(#2) coordinate (R); \crectangledouble{R #2}{0.8}{1}{R} \csymbol{\mathsf{R}}
%\joinrlnoarrowthick[above]{#2}{#3}{R #2}{0} \csymbolthird{\mathtt{#4}} }

%
% \Rxboxincome[wider]{name}{position}{symbol}
\newcommand{\Rxboxincome}[4][1]{\path (-8*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R} \csymbol{\mathsf{R}} \path (-5*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinlrnoarrowthick[above]{#2}{#3}{x #2}{0} \csymbol{\mathtt{#4}} \joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#4}}   }
\newcommand{\Rxboxoutcome}[4][1]{\path (8*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R} \csymbol{\mathsf{R}} \path (5*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinrlnoarrowthick[above]{#2}{#3}{x #2}{0} \csymbol{\mathtt{#4}} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#4}}   }

%
% \Rxboxincome[wider]{name}{position}{symbolinbox}{symbolonwire}
\newcommand{\Rxboxyincome}[5][1]{\path (-8*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R}
\csymbol{\mathsf{R}} \path (-5*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinlrnoarrowthick[above]{#2}{#3}{x #2}{0} \csymbol{\mathtt{#5}}
\joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }
\newcommand{\Rxboxyoutcome}[5][1]{\path (8*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R}
\csymbol{\mathsf{R}} \path (5*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinrlnoarrowthick[above]{#2}{#3}{x #2}{0} \csymbol{\mathtt{#5}} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0}
\csymbol{\mathtt{#5}}   }



%\RxBoxincome[wider]{A}{width of A}{position on A}{symbol}  \RxBoxincome{B}{2}{0}{x}
\newcommand{\RxBoxincome}[5][1]{\path (-4.6*#1-#3-2.1,#4)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R} \csymbol{\mathsf{R}}
\path (-2.3*#1-#3-0.7,#4)+(#2) coordinate (x);
\crectangle{x #2}{0.7}{0.7}{x} \csymbolnorm{#5}
\joinlrnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }
\newcommand{\RxBoxoutcome}[5][1]{\path (4.6*#1+#3+2.1,#4)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R} \csymbol{\mathsf{R}}
\path (2.3*#1+#3+0.7,#4)+(#2) coordinate (x);
\crectangle{x #2}{0.7}{0.7}{x} \csymbolnorm{#5}
\joinrlnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }

%\RxdifBoxincome[wider x box]{A}{width of A}{position on A}{symbol}{symbol in x box}  \RxdifBoxincome{B}{2}{0}{x}{x'}
\newcommand{\RxdifBoxincome}[6][1]{\path (-4.6-#3-0.7-1.4*#1,#4)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R} \csymbol{\mathsf{R}}
\path (-2.3-#3-0.7*#1,#4)+(#2) coordinate (x);
\crectangle{x #2}{0.7*#1}{0.8}{x} \csymbolfourth{#6}
\joinlrnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }
\newcommand{\RxdifBoxoutcome}[6][1]{\path (4.6+#3+0.7+1.4*#1,#4)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R} \csymbol{\mathsf{R}}
\path (2.3+#3+0.7*#1,#4)+(#2) coordinate (x);
\crectangle{x #2}{0.7*#1}{0.8}{x} \csymbolfourth{#6}
\joinrlnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }


%\GenxBoxincome[wider]{A}{width of A}{position on A}{symbol x}{symbol R}  \GenxBoxincome{B}{2}{0}{x}{R}
% note that can use \csymbol after this - it puts a symbol in the R box location.
\newcommand{\GenxBoxincome}[6][1]{\path (-4.6*#1-#3-2.1,#4)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R} \csymbol{\mathsf{#6}}
\path (-2.3*#1-#3-0.7,#4)+(#2) coordinate (x);
\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#5}
\joinlrnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}}
\joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}} \thispoint{R #2}{R}  }

\newcommand{\GenxBoxoutcome}[6][1]{\path (4.6*#1+#3+2.1,#4)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R} \csymbol{\mathsf{#6}}
\path (2.3*#1+#3+0.7,#4)+(#2) coordinate (x);
\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#5}
\joinrlnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0}
\csymbol{\mathtt{#5}}  \thispoint{R #2}{R}  }

\newcommand{\GenxBoxincomedouble}[6][1]{\path (-4.6*#1-#3-2.1,#4)+(#2) coordinate (R); \crectangledouble{R #2}{0.8}{0.9}{R} \csymbol{#6}
\path (-2.3*#1-#3-0.7,#4)+(#2) coordinate (x);
\crectangledouble{x #2}{0.75}{0.75}{x} \csymbolfourth{#5}
\joinlrnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{#5}   }
\newcommand{\GenxBoxoutcomedouble}[6][1]{\path (4.6*#1+#3+2.1,#4)+(#2) coordinate (R); \crectangledouble{R #2}{0.8}{0.9}{R} \csymbol{#6}
\path (2.3*#1+#3+0.7,#4)+(#2) coordinate (x);
\crectangledouble{x #2}{0.75}{0.75}{x} \csymbolfourth{#5}
\joinrlnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }


%\GenxdifBoxincome[wider x box]{A}{width of A}{position on A}{symbol}{symbol in x box}{symbol R}  \RxdifBoxincome{B}{2}{0}{x}{x'}
\newcommand{\GenxdifBoxincome}[7][1]{\path (-4.6-#3-0.7-1.4*#1,#4)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R} \csymbol{\mathsf{#7}}
\path (-2.3-#3-0.7*#1,#4)+(#2) coordinate (x);
\crectangle{x #2}{0.7*#1}{0.8}{x} \csymbolfourth{#6}
\joinlrnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }
\newcommand{\GenxdifBoxoutcome}[7][1]{\path (4.6+#3+0.7+1.4*#1,#4)+(#2) coordinate (R); \crectangle{R #2}{0.7}{0.9}{R} \csymbol{\mathsf{#7}}
\path (2.3+#3+0.7*#1,#4)+(#2) coordinate (x);
\crectangle{x #2}{0.7*#1}{0.8}{x} \csymbolfourth{#6}
\joinrlnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }


%\GenxdifBoxincome[wider x box]{A}{width of A}{position on A}{symbol}{symbol in x box}{symbol R}  \RxdifBoxincome{B}{2}{0}{x}{x'}
\newcommand{\GenxdifBoxincomedouble}[7][1]{\path (-4.6-#3-0.7-1.4*#1,#4)+(#2) coordinate (R); \crectangledouble{R #2}{0.8}{1}{R} \csymbol{#7}
\path (-2.3-#3-0.7*#1,#4)+(#2) coordinate (x);
\crectangledouble{x #2}{0.8*#1}{0.9}{x} \csymbolfourth{#6}
\joinlrnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbolfourth{\mathtt{#5}}   }
\newcommand{\GenxdifBoxoutcomedouble}[7][1]{\path (4.6+#3+0.7+1.4*#1,#4)+(#2) coordinate (R); \crectangledouble{R #2}{0.8}{1}{R} \csymbolfourth{#7}
\path (2.3+#3+0.7*#1,#4)+(#2) coordinate (x);
\crectangledouble{x #2}{0.7*#1}{0.8}{x} \csymbolfourth{#6}
\joinrlnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }



\newcommand{\Rxboxincomedouble}[4][1]{\path (-8*#1,#3)+(#2) coordinate (R); \crectangledouble{R #2}{0.8}{1}{R} \csymbolfourth{R}
\path (-5*#1,#3)+(#2) coordinate (x);\crectangledouble{x #2}{0.8}{0.8}{x} \csymbolfourth{#4}
\joinlrnoarrowthick[above]{#2}{#3}{x #2}{0} \csymbolfourth{\mathtt{#4}} \joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#4}}   }
\newcommand{\Rxboxoutcomedouble}[4][1]{\path (8*#1,#3)+(#2) coordinate (R); \crectangledouble{R #2}{0.8}{1}{R} \csymbolfourth{R}
\path (5*#1,#3)+(#2) coordinate (x);\crectangledouble{x #2}{0.8}{0.8}{x} \csymbolfourth{#4}
\joinrlnoarrowthick[above]{#2}{#3}{x #2}{0} \csymbolfourth{\mathtt{#4}} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#4}}   }

\newcommand{\Rboldxboxincomedouble}[4][1]{\path (-8*#1,#3)+(#2) coordinate (R); \crectangledouble{R #2}{0.9}{1}{R}
\csymbolfourth{\boldsymbol{R}}
\path (-5*#1,#3)+(#2) coordinate (x);\crectangledouble{x #2}{0.8}{0.8}{x} \csymbolnorm{#4}
\joinlrnoarrowthick[above]{#2}{#3}{x #2}{0} \csymbolfourth{\mathtt{#4}} \joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#4}}   }
\newcommand{\Rboldxboxoutcomedouble}[4][1]{\path (8*#1,#3)+(#2) coordinate (R); \crectangledouble{R #2}{0.9}{1}{R}
\csymbolfourth{\boldsymbol{R}}
\path (5*#1,#3)+(#2) coordinate (x);\crectangledouble{x #2}{0.8}{0.8}{x} \csymbolnorm{#4}
\joinrlnoarrowthick[above]{#2}{#3}{x #2}{0} \csymbolfourth{\mathtt{#4}} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#4}}   }



%\RxBoxincome[wider]{A}{width of A}{position on A}{symbol}  double versions not tested yet.
\newcommand{\RxBoxincomedouble}[5][0.8]{\path (-5*#1-#3-2.4,#4)+(#2) coordinate (R); \crectangledouble{R #2}{0.8}{1}{R} \csymbolfourth{R}
\path (-2.5*#1-#3-0.8,#4)+(#2) coordinate (x);
\crectangledouble{x #2}{0.8}{0.8}{x} \csymbolnorm{#5}
\joinlrnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }
\newcommand{\RxBoxoutcomedouble}[5][0.8]{\path (5*#1+#3+2.4,#4)+(#2) coordinate (R); \crectangledouble{R #2}{0.8}{1}{R} \csymbolfourth{R}
\path (2.5*#1+#3+0.8,#4)+(#2) coordinate (x);
\crectangledouble{x #2}{0.8}{0.8}{x} \csymbolfourth{#5}
\joinrlnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }

\newcommand{\RboldxBoxincomedouble}[5][0.8]{\path (-5*#1-#3-2.4,#4)+(#2) coordinate (R);
\crectangledouble{R #2}{0.9}{1}{R} \csymbolfourth{\boldsymbol{R}}
\path (-2.5*#1-#3-0.8,#4)+(#2) coordinate (x);
\crectangledouble{x #2}{0.8}{0.8}{x} \csymbolnorm{#5}
\joinlrnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }
\newcommand{\RboldxBoxoutcomedouble}[5][0.8]{\path (5*#1+#3+2.4,#4)+(#2) coordinate (R);
\crectangledouble{R #2}{0.9}{1}{R} \csymbolfourth{\boldsymbol{R}}
\path (2.5*#1+#3+0.8,#4)+(#2) coordinate (x);
\crectangledouble{x #2}{0.8}{0.8}{x} \csymbolfourth{#5}
\joinrlnoarrowthick[above]{#2}{#4}{x #2}{0} \csymbol{\mathtt{#5}} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbol{\mathtt{#5}}   }



\newcommand{\joinwithpointerfids}[4]{
\path ($0.5*(#1)+0.5*(#3)$) coordinate (mid); \path (mid)+ (-1.1,0) coordinate (midleft); \path (mid)+ (1.1,0) coordinate (midright);
\sleftdatafid{fidl}{midleft} \srightdatafid{fidr}{midright}
\joinrlnoarrowwb{#1}{#2}{fidl}{0} \joinrlnoarrowthick{fidl}{0}{fidr}{0} \joinrlnoarrowbw{fidr}{0}{#3}{#4} }


\newcommand{\joinwithpointerfidsdual}[4]{
\path ($0.5*(#1)+0.5*(#3)$) coordinate (mid); \path (mid)+ (-2.7,0) coordinate (midleft);
\path (mid)+ (2.7,0) coordinate (midright);
\srightdatafid{fidl}{midleft} \sleftdatafid{fidr}{midright}
\joinrlnoarrowthick{#1}{#2}{fidl}{0} \joinrlnoarrowsqbwwb{fidl}{0}{fidr}{0} \joinrlnoarrowthick{fidr}{0}{#3}{#4} }

\newcommand{\joinwithvecfids}[4]{
\path ($0.5*(#1)+0.5*(#3)$) coordinate (mid); \path (mid)+ (-1.1,0) coordinate (midleft); \path (mid)+ (1.1,0) coordinate (midright);
\sleftvecfid{fidl}{midleft} \srightvecfid{fidr}{midright}
\joinrlnoarrowwb{#1}{#2}{fidl}{0} \joinrlnoarrowthick{fidl}{0}{fidr}{0} \joinrlnoarrowbw{fidr}{0}{#3}{#4} }


%joinwithpointerfidsx{A}{0}{-1}{B}{x}  the x is the symbol to be placed on the path.
\newcommand{\joinwithpointerfidsx}[5]{
\path ($0.5*(#1)+0.5*(#3)$) coordinate (mid); \path (mid)+ (-1.6,0) coordinate (midleft); \path (mid)+ (1.6,0) coordinate (midright);
\sleftdatafid{fidl}{midleft} \srightdatafid{fidr}{midright}
\joinrlnoarrowwb[above]{#1}{#2}{fidl}{0} \csymbolfourth[0,10]{#5}
\joinrlnoarrowthick[above]{fidl}{0}{fidr}{0} \csymbolfourth[0,0]{\mathtt{#5}}
\joinrlnoarrowbw[above]{fidr}{0}{#3}{#4} \csymbolfourth[0,10]{#5}   }
\newcommand{\joinwithvecfidsx}[5]{
\path ($0.5*(#1)+0.5*(#3)$) coordinate (mid); \path (mid)+ (-1.6,0) coordinate (midleft); \path (mid)+ (1.6,0) coordinate (midright);
\sleftvecfid{fidl}{midleft} \srightvecfid{fidr}{midright}
\joinrlnoarrowwb[above]{#1}{#2}{fidl}{0} \csymbolfourth[0,10]{#5}
\joinrlnoarrowthick[above]{fidl}{0}{fidr}{0} \csymbolfourth[0,0]{\mathtt{#5}}
\joinrlnoarrowbw[above]{fidr}{0}{#3}{#4} \csymbolfourth[0,10]{#5}
%\joinrlnoarrowwb{#1}{#2}{fidl}{0} \joinrlnoarrowthick{fidl}{0}{fidr}{0} \joinrlnoarrowbw{fidr}{0}{#3}{#4}
}



\newcommand{\Rxboxincomefids}[4][1]{\path (-20*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.8}{0.9}{R} \csymbolthird{R} \path (-10*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinwithpointerfids{x #2}{0}{#2}{#3}  \joinwithpointerfids{R #2}{0}{x #2}{0}   }




\newcommand{\Rxboxincomefiddual}[4][1]{\path (-20*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.8}{0.9}{R}
\csymbolthird{R} \path (-10*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x}
\csymbolfourth{\mathnormal{#4}}
\joinwithpointerfidsdual{x #2}{0}{#2}{#3} \joinwithpointerfidsdual{R #2}{0}{x #2}{0}   }

\newcommand{\Rxboxoutcomefids}[4][1]{\path (20*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.8}{0.9}{R} \csymbolthird{R} \path (10*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinwithpointerfids{#2}{#3}{x #2}{0}  \joinwithpointerfids{x #2}{0}{R #2}{0}   }


\newcommand{\Rxboxoutcomefiddual}[4][1]{\path (20*#1,#3)+(#2) coordinate (R);
\crectangle{R #2}{0.8}{0.9}{R} \csymbolthird{R} \path (10*#1,#3)+(#2) coordinate (x);
\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{\mathnormal{#4}}
\joinwithpointerfidsdual{#2}{#3}{x #2}{0}  \joinwithpointerfidsdual{x #2}{0}{R #2}{0}   }

\newcommand{\Rxboxoutcomefidsdual}[4][1]{\path (20*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.8}{0.9}{R} \csymbolfourth{R} \path (10*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinwithpointerfids{#2}{#3}{x #2}{0}  \joinwithpointerfids{x #2}{0}{R #2}{0}   }

\newcommand{\Rxboxincomefidsdouble}[4][1]{\path (-20*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.8}{1}{R} \csymbolthird{R}
\path (-10*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.8}{0.8}{x} \csymbolfourth{#4}
\joinwithvecfids{x #2}{0}{#2}{#3}  \joinwithvecfids{R #2}{0}{x #2}{0}   }
\newcommand{\Rxboxoutcomefidsdouble}[4][1]{\path (20*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.8}{1}{R} \csymbolthird{R}
\path (10*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.8}{0.8}{x} \csymbolfourth{#4}
\joinwithvecfids{#2}{#3}{x #2}{0}  \joinwithvecfids{x #2}{0}{R #2}{0}   }

\newcommand{\joinwithsystemfids}[4]{
\path ($0.5*(#1)+0.5*(#3)$) coordinate (mid); \path (mid)+ (0,-1.1) coordinate (midleft); \path (mid)+ (0,1.1) coordinate (midright);
\supsysfid{fidd}{midleft} \sdownsysfid{fidu}{midright}
\jointbnoarrowdotswb{#1}{#2}{fidd}{0} \jointbnoarrow{fidd}{0}{fidu}{0} \jointbnoarrowdotsbw{fidu}{0}{#3}{#4}
}

\newcommand{\joinwithopfids}[4]{
\path ($0.5*(#1)+0.5*(#3)$) coordinate (mid); \path (mid)+ (0,-1.1) coordinate (midleft); \path (mid)+ (0,1.1) coordinate (midright);
\supopfid{fidd}{midleft} \sdownopfid{fidu}{midright}
\jointbnoarrowdotswb{#1}{#2}{fidd}{0} \jointbnoarrow{fidd}{0}{fidu}{0} \jointbnoarrowdotsbw{fidu}{0}{#3}{#4}
}

\newcommand{\joinwithsystemfidsdual}[4]{
\path ($0.5*(#1)+0.5*(#3)$) coordinate (mid); \path (mid)+ (0,-2.7) coordinate (midleft); \path (mid)+ (0,2.7) coordinate (midright);
\sdownsysfid{fidd}{midleft} \supsysfid{fidu}{midright}
\jointbnoarrow{#1}{#2}{fidd}{0} \jointbnoarrowdotsbwwb{fidd}{0}{fidu}{0} \jointbnoarrow{fidu}{0}{#3}{#4}
}

%% following two commands under construction
%% They aren't great. They don't support nonzero displacements for the second and fourth arguments
%% Neither do the above similar commands... . Now I have sort of fixed this problem.
%% Though I still can't place font using \csymbol...

\newcommand{\joinwithsystemfidsdualwb}[4]{
\path ($0.5*(#1)+0.5*(#3)$) coordinate (mid);
\path ($0.5*(#2,0)+0.5*(#4,0)$) coordinate (Hdisp);
\path ($(mid)+(Hdisp) + (0,-2)$) coordinate (midleft);
\path ($(mid)+ (Hdisp) + (0,2)$) coordinate (midright);
\sdownsysfid{fidd}{midleft} \supsysfid{fidu}{midright}
\jointbnoarrow{#1}{#2}{fidd}{0} \jointbnoarrowdotswb{fidd}{0}{fidu}{0} \jointbnoarrow{fidu}{0}{#3}{#4}
}

\newcommand{\joinwithsystemfidsdualbw}[4]{
\path ($0.5*(#1)+0.5*(#3)$) coordinate (mid);
\path ($0.5*(#2,0)+0.5*(#4,0)$) coordinate (Hdisp);
\path ($(mid)+(Hdisp) + (0,-2)$) coordinate (midleft);
\path ($(mid)+ (Hdisp) + (0,2)$) coordinate (midright);
\sdownsysfid{fidd}{midleft} \supsysfid{fidu}{midright}
\jointbnoarrow{#1}{#2}{fidd}{0} \jointbnoarrowdotsbw{fidd}{0}{fidu}{0} \jointbnoarrow{fidu}{0}{#3}{#4}
}


\newcommand{\Rxboxincomewbbw}[4][1]{\path (-16*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.8}{0.9}{R} \csymbolthird{R} \path (-8*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinlrnoarrowsqwbbw[above]{#2}{#3}{x #2}{0} \csymbolfourth[0,5]{#4} \joinlrnoarrowsqwbbw[above]{x #2}{0}{R #2}{0} \csymbolfourth[0,5]{#4}   }

\newcommand{\Rxboxincomebwwb}[4][1]{\path (-16*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.8}{0.9}{R} \csymbolthird{R} \path (-8*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinlrnoarrowsqbwwb[above]{#2}{#3}{x #2}{0} \csymbolfourth[0,5]{#4} \joinlrnoarrowsqbwwb[above]{x #2}{0}{R #2}{0} \csymbolfourth[0,5]{#4}   }


\newcommand{\Rxboxoutcomewbbw}[4][1]{\path (16*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.8}{0.9}{R} \csymbolthird{R} \path (8*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinrlnoarrowsqwbbw[above]{#2}{#3}{x #2}{0} \csymbolfourth[0,5]{#4} \joinrlnoarrowsqwbbw[above]{x #2}{0}{R #2}{0} \csymbolfourth[0,5]{#4}   }

\newcommand{\Rxboxoutcomebwwb}[4][1]{\path (16*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.8}{0.9}{R} \csymbolthird{R} \path (8*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinrlnoarrowsqwbbw[above]{#2}{#3}{x #2}{0} \csymbolfourth[0,5]{#4} \joinrlnoarrowsqwbbw[above]{x #2}{0}{R #2}{0} \csymbolfourth[0,5]{#4}   }



\newcommand{\Rxboxincomecalc}[4][1]{\path (-8*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.8}{0.9}{R} \csymbolthird{R} \path (-5*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinlrnoarrowthick[above]{#2}{#3}{x #2}{0} \csymbolfourth{#4} \joinlrnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbolfourth{#4}   }
\newcommand{\Rxboxoutcomecalc}[4][1]{\path (8*#1,#3)+(#2) coordinate (R); \crectangle{R #2}{0.8}{0.9}{R} \csymbolthird{R} \path (5*#1,#3)+(#2) coordinate (x);\crectangle{x #2}{0.7}{0.7}{x} \csymbolfourth{#4}
\joinrlnoarrowthick[above]{#2}{#3}{x #2}{0} \csymbolfourth{#4} \joinrlnoarrowthick[above]{x #2}{0}{R #2}{0} \csymbolfourth{#4}   }
%


%% Table 1 diagrams

\newcommand{\AboxTS}{\begin{Compose}{0}{0}\setsecondfont{\mathtt} \setthirdfont{\mathsfb}
\crectangle{U}{2}{2}{0,0} \csymbol{A} \thispoint{AL}{-5,0} \csymbolalt[-20,0]{x} \thispoint{AR}{5,0} \csymbolalt[20,0]{y}
\joinlrnoarrowthick{U}{0}{AL}{0} \joinrlnoarrowthick{U}{0}{AR}{0}
\thispoint{a}{0,-5} \csymbolthird[0,-20]{a} \jointbnoarrow{a}{0}{U}{0}
\thispoint{d}{0,5} \csymbolthird[0,20]{b} \joinbtnoarrow{d}{0}{U}{0}
\end{Compose}}

\newcommand{\RleftTS}{\begin{Compose}{0}{0} \setsecondfont{\mathtt}
\Crectangle{R}{0.7}{0.9}{0,0} \thispoint{p}{4,0} \csymbolalt[20,0]{u} \joinrlnoarrowthick{R}{0}{p}{0}
\end{Compose}}

\newcommand{\RrightTS}{\begin{Compose}{0}{0}\setsecondfont{\mathtt}
\Crectangle{R}{0.7}{0.9}{0,0}  \thispoint{p}{-4,0} \csymbolalt[-20,0]{v} \joinlrnoarrowthick{R}{0}{p}{0}
\end{Compose}}

\newcommand{\xboxTS}{\begin{Compose}{0}{0}\setsecondfont{\mathtt}
\crectangle{A}{0.6}{0.7}{0,0} \csymbolthird{x} \relpoint{A}{-2.5,0}{AL} \csymbolalt[-18,0]{x}
\relpoint{A}{2.5,0}{AR} \csymbolalt[15,0]{x}
\joinlrnoarrowthick{A}{0}{AL}{0}
\joinrlnoarrowthick{A}{0}{AR}{0}
\end{Compose}}

\newcommand{\MboxTS} {\begin{Compose}{0}{0}
\crectangle{M}{3}{2}{0,0} \csymbol{M}
\thispoint{u}{-6,0} \csymbol[-20,0]{u}
\thispoint{v}{6,0} \csymbol[20,0]{v}
\joinrlnoarrowthick[above]{u}{0}{M}{0}
\joinrlnoarrowthick[above]{M}{0}{v}{0}
\end{Compose}}


\newcommand{\XfidoutcomeTS}{\begin{Compose}{0}{-0.4}\setsecondfont{\mathtt}
\Crectangle{X}{0.8}{0.8}{0,0}
\thispoint{p}{0,3} \csymbol[0,20]{x} \jointbnoarrow[left]{X}{0}{p}{0}
\thispoint{pp}{-3,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{X}{0}{pp}{0}
\end{Compose}}

\newcommand{\XfidincomeTS}{\begin{Compose}{0}{-0.4}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\Crectangle{X}{0.8}{0.8}{0,3}
\thispoint{p}{0,0} \csymbolthird[0,-20]{x} \jointbnoarrow[left]{p}{0}{X}{0}
\thispoint{pp}{3,3} \csymbolalt[20,0]{x} \joinlrnoarrowthick[left]{pp}{0}{X}{0}
\end{Compose}}

\newcommand{\IoutcomeTS}{\begin{Compose}{0}{0}\setsecondfont{\mathtt} \setthirdfont{\mathsfb}
\crectangle{X}{0.8}{0.8}{0,-3} \csymbol{I}
\thispoint{Y}{0,2.5}\csymbolthird[0,20]{x} \jointbnoarrow[right]{X}{0}{Y}{0}
\end{Compose}}

\newcommand{\IincomeTS}{\begin{Compose}{0}{0}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{X}{0.8}{0.8}{0,3} \csymbol{I}
\thispoint{Y}{0,-2.5}\csymbolthird[0,-20]{x} \joinbtnoarrow[right]{X}{0}{Y}{0}
\end{Compose}}

\newcommand{\VboxTS}{\begin{Compose}{0}{0}\setsecondfont{\mathtt} \setthirdfont{\mathsfb}
\crectangle{U}{2}{2}{0,0} \csymbol{V}
\thispoint{a}{0,-5} \csymbolthird[0,-20]{a} \jointbnoarrow{a}{0}{U}{0}
\thispoint{d}{0,5} \csymbolthird[0,20]{b} \joinbtnoarrow{d}{0}{U}{0}
\end{Compose}}

\newcommand{\BboxTS}{\begin{Compose}{0}{0}
\Crectangle{B}{2}{2}{0,0}
\end{Compose} }

% complex operator table diagrams

\newcommand{\RCoperatorout}{\begin{Compose}{0}{0} \setsecondfont{\mathttc} \setfourthfont{\mathbf}
\ccircledouble{R}{1}{0,0} \csymbolfourth{\boldsymbol{R}} \thispoint{p}{4,0} \csymbolalt[20,0]{x}
\joinccthick{R}{0}{p}{180}
\end{Compose}}

\newcommand{\RCoperatorin}{\begin{Compose}{0}{0} \setsecondfont{\mathttc} \setfourthfont{\mathbf}
\ccircledouble{R}{1}{0,0} \csymbolfourth{\boldsymbol{R}} \thispoint{p}{4,0} \csymbolalt[20,0]{x}
\joinccthick{p}{180}{R}{0}
\end{Compose}}

\newcommand{\xboxCoperator}{\begin{Compose}{0}{0}\setsecondfont{\mathttc}
\ccircledouble{A}{0.8}{0,0} \csymbolthird{x} \relpoint{A}{-2.5,0}{AL} \csymbolalt[-18,0]{x}
\relpoint{A}{2.5,0}{AR} \csymbolalt[15,0]{x}
\joinccthick{AL}{0}{A}{180}
\joinccthick{A}{0}{AR}{180}
\end{Compose}}

\newcommand{\XmaximalCoperator}{\begin{Compose}{0}{-0.4}\setdefaultfont{\mathsfc}\setsecondfont{\mathttc}
\ccircledouble{X}{1.2}{0,0} \csymbolfourth{\hat{\boldsymbol{X}}}
\thispoint{p}{45:3} \csymbol[10,20]{x} \joincc[left]{X}{45}{p}{-135}
\thispoint{pp}{-135:3} \csymbolalt[-10,-20]{x} \joinccthick{pp}{45}{X}{-135}
\end{Compose}}

\newcommand{\XmaximalCoperatorR}{\begin{Compose}{0}{-0.4}\setdefaultfont{\mathsfc}\setsecondfont{\mathttc}
\ccircledouble{X}{1.2}{0,0} \csymbolfourth{\hat{\boldsymbol{X}}}
\thispoint{p}{45:3} \csymbol[10,20]{x} \joincc[left]{p}{-135}{X}{45}
\thispoint{pp}{-135:3} \csymbolalt[-10,-20]{x} \joinccthick{X}{-135}{pp}{45}
\end{Compose}}

\newcommand{\ICoperatorout}{\begin{Compose}{0}{0} \setsecondfont{\mathsfc} \setfourthfont{\mathbf}
\ccircledouble{R}{1}{0,0} \csymbolfourth{\hat{\boldsymbol{I}}} \thispoint{p}{4,0} \csymbolalt[20,0]{a}
\joinccthick{R}{0}{p}{180}
\end{Compose}}

\newcommand{\ICoperatorin}{\begin{Compose}{0}{0} \setsecondfont{\mathsfc} \setfourthfont{\mathbf}
\ccircledouble{R}{1}{0,0} \csymbolfourth{\hat{\boldsymbol{I}}} \thispoint{p}{4,0} \csymbolalt[20,0]{a}
\joinccthick{p}{180}{R}{0}
\end{Compose}}


% Table 2 diagrams

\newcommand{\AboxTSop}{\begin{Compose}{0}{0}\setsecondfont{\mathtt} \setthirdfont{\mathsfb}
\crectangledouble{U}{2}{2}{0,0} \csymbolfourth{\hat{A}} \thispoint{AL}{-5,0} \csymbolalt[-20,0]{x} \thispoint{AR}{5,0} \csymbolalt[20,0]{y}
\joinlrnoarrowthick{U}{0}{AL}{0} \joinrlnoarrowthick{U}{0}{AR}{0}
\thispoint{a}{0,-5} \csymbolthird[0,-20]{a} \jointbnoarrow{a}{0}{U}{0}
\thispoint{d}{0,5} \csymbolthird[0,20]{b} \joinbtnoarrow{d}{0}{U}{0}
\end{Compose}}

\newcommand{\RleftTSop}{\begin{Compose}{0}{0} \setsecondfont{\mathtt}
\crectangledouble{R}{0.8}{1}{0,0} \csymbolfourth{R} \thispoint{p}{4,0} \csymbolalt[20,0]{u} \joinrlnoarrowthick{R}{0}{p}{0}
\end{Compose}}

\newcommand{\RrightTSop}{\begin{Compose}{0}{0}\setsecondfont{\mathtt}
\crectangledouble{R}{0.8}{1}{0,0} \csymbolfourth{R} \thispoint{p}{-4,0} \csymbolalt[-20,0]{v} \joinlrnoarrowthick{R}{0}{p}{0}
\end{Compose}}

\newcommand{\RleftTSopbold}{\begin{Compose}{0}{0} \setsecondfont{\mathtt} \setfourthfont{\boldsymbol}
\crectangledouble{R}{0.9}{1}{0,0} \csymbolfourth{R} \thispoint{p}{4,0} \csymbolalt[20,0]{x} \joinrlnoarrowthick{R}{0}{p}{0}
\end{Compose}}

\newcommand{\RrightTSopbold}{\begin{Compose}{0}{0}\setsecondfont{\mathtt} \setfourthfont{\boldsymbol}
\crectangledouble{R}{0.9}{1}{0,0} \csymbolfourth{R} \thispoint{p}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{R}{0}{p}{0}
\end{Compose}}

\newcommand{\xboxTSop}{\begin{Compose}{0}{0}\setsecondfont{\mathtt}
\crectangledouble{A}{0.7}{0.8}{0,0} \csymbolthird{x} \relpoint{A}{-2.5,0}{AL} \csymbolalt[-18,0]{x}
\relpoint{A}{2.5,0}{AR} \csymbolalt[15,0]{x}
\joinlrnoarrowthick{A}{0}{AL}{0}
\joinrlnoarrowthick{A}{0}{AR}{0}
\end{Compose}}

\newcommand{\MboxTSop} {\begin{Compose}{0}{0}
\crectangledouble{M}{3}{2}{0,0} \csymbolfourth{\hat{M}}
\thispoint{u}{-6,0} \csymbol[-20,0]{u}
\thispoint{v}{6,0} \csymbol[20,0]{v}
\joinrlnoarrowthick[above]{u}{0}{M}{0}
\joinrlnoarrowthick[above]{M}{0}{v}{0}
\end{Compose}}


\newcommand{\XfidoutcomeTSop}{\begin{Compose}{0}{-0.4}\setsecondfont{\mathtt}
\crectangledouble{X}{0.9}{0.9}{0,0} \csymbolfourth{\hat{X}}
\thispoint{p}{0,3} \csymbol[0,20]{x} \jointbnoarrow[left]{X}{0}{p}{0}
\thispoint{pp}{-3,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{X}{0}{pp}{0}
\end{Compose}}

\newcommand{\XfidincomeTSop}{\begin{Compose}{0}{-0.4}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangledouble{X}{0.9}{0.9}{0,3} \csymbolfourth{\hat{X}}
\thispoint{p}{0,0} \csymbolthird[0,-20]{x} \jointbnoarrow[left]{p}{0}{X}{0}
\thispoint{pp}{3,3} \csymbolalt[20,0]{x} \joinlrnoarrowthick[left]{pp}{0}{X}{0}
\end{Compose}}

\newcommand{\IoutcomeTSop}{\begin{Compose}{0}{0}\setsecondfont{\mathtt} \setthirdfont{\mathsfb}
\crectangledouble{X}{0.9}{0.9}{0,-3} \csymbolfourth{\hat{I}}
\thispoint{Y}{0,2.5}\csymbolthird[0,20]{x} \jointbnoarrow[right]{X}{0}{Y}{0}
\end{Compose}}

\newcommand{\IincomeTSop}{\begin{Compose}{0}{0}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangledouble{X}{0.9}{0.9}{0,3} \csymbolfourth{\hat{I}}
\thispoint{Y}{0,-2.5}\csymbolthird[0,-20]{x} \joinbtnoarrow[right]{X}{0}{Y}{0}
\end{Compose}}


\newcommand{\XfidoutcomeTSopbold}{\begin{Compose}{0}{-0.4}\setsecondfont{\mathtt}
\crectangledouble{X}{0.9}{0.9}{0,0} \csymbolfourth{\boldsymbol{\hat{X}}}
\thispoint{p}{0,3} \csymbol[0,20]{x} \jointbnoarrow[left]{X}{0}{p}{0}
\thispoint{pp}{-3,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{X}{0}{pp}{0}
\end{Compose}}

\newcommand{\XfidincomeTSopbold}{\begin{Compose}{0}{-0.4}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangledouble{X}{0.9}{0.9}{0,3} \csymbolfourth{\boldsymbol{\hat{X}}}
\thispoint{p}{0,0} \csymbolthird[0,-20]{x} \jointbnoarrow[left]{p}{0}{X}{0}
\thispoint{pp}{3,3} \csymbolalt[20,0]{x} \joinlrnoarrowthick[left]{pp}{0}{X}{0}
\end{Compose}}


\newcommand{\XfidoutcomeTSophc}{\begin{Compose}{0}{-0.4}\setsecondfont{\mathtt}
\crectangledouble{X}{1}{1}{0,0} \csymbolnorm{\hat{\maxprep[2]{\boldsymbol{X}}}}
\thispoint{p}{0,3} \csymbol[0,20]{x} \jointbnoarrow[left]{X}{0}{p}{0}
\thispoint{pp}{-3,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{X}{0}{pp}{0}
\end{Compose}}

\newcommand{\XfidincomeTSophc}{\begin{Compose}{0}{-0.4}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangledouble{X}{1}{1}{0,3} \csymbolnorm{\hat{\maxresult[-1.5]{\boldsymbol{X}}}}
\thispoint{p}{0,0} \csymbolthird[0,-20]{x} \jointbnoarrow[left]{p}{0}{X}{0}
\thispoint{pp}{3,3} \csymbolalt[20,0]{x} \joinlrnoarrowthick[left]{pp}{0}{X}{0}
\end{Compose}}


\newcommand{\IoutcomeTSopbold}{\begin{Compose}{0}{0}\setsecondfont{\mathtt} \setthirdfont{\mathsfb}
\crectangledouble{X}{0.9}{0.9}{0,-3} \csymbolfourth{\boldsymbol{\hat{I}}}
\thispoint{Y}{0,2.5}\csymbolthird[0,20]{x} \jointbnoarrow[right]{X}{0}{Y}{0}
\end{Compose}}

\newcommand{\IincomeTSopbold}{\begin{Compose}{0}{0}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangledouble{X}{0.9}{0.9}{0,3} \csymbolfourth{\boldsymbol{\hat{I}}}
\thispoint{Y}{0,-2.5}\csymbolthird[0,-20]{x} \joinbtnoarrow[right]{X}{0}{Y}{0}
\end{Compose}}

\newcommand{\VboxTSop}{\begin{Compose}{0}{0}\setsecondfont{\mathtt} \setthirdfont{\mathsfb}
\crectangledouble{U}{2}{2}{0,0} \csymbolfourth{\hat{V}}
\thispoint{a}{0,-5} \csymbolthird[0,-20]{a} \jointbnoarrow{a}{0}{U}{0}
\thispoint{d}{0,5} \csymbolthird[0,20]{b} \joinbtnoarrow{d}{0}{U}{0}
\end{Compose}}

\newcommand{\BboxTSop}{\begin{Compose}{0}{0}
\Crectangledouble{B}{2}{2}{0,0}
\end{Compose} }


\newcommand{\Zcase} {
\begin{Compose}{0}{0}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{E}{0.8}{0.8}{0,-1.5} \crectangle{F}{0.8}{0.8}{0,1.5}
\incomewire[0.7]{F}{0}{ } \outcomewire[0.7]{E}{0}{ }
\jointbnoarrow[left]{E}{0}{F}{0}
\end{Compose}
}

\newcommand{\revZcase} {
\begin{Compose}{0}{0}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{E}{0.8}{0.8}{0,-1.5} \crectangle{F}{0.8}{0.8}{0,1.5}
\outcomewire[0.7]{F}{0}{ } \incomewire[0.7]{E}{0}{ }
\jointbnoarrow[left]{E}{0}{F}{0}
\end{Compose}
}

\newcommand{\revCcase} {
\begin{Compose}{0}{0}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{E}{0.8}{0.8}{0,-1.5} \crectangle{F}{0.8}{0.8}{0,1.5}
\incomewire[0.7]{F}{0}{ } \incomewire[0.7]{E}{0}{ }
\jointbnoarrow[left]{E}{0}{F}{0}
\end{Compose}
}


\newcommand{\Ccase} {
\begin{Compose}{0}{0}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{E}{0.8}{0.8}{0,-1.5} \crectangle{F}{0.8}{0.8}{0,1.5}
\outcomewire[0.7]{F}{0}{ } \outcomewire[0.7]{E}{0}{ }
\jointbnoarrow[left]{E}{0}{F}{0}
\end{Compose}
}

\newcommand{\Tcase} {
\begin{Compose}{0}{0}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{E}{0.8}{0.8}{0,-1.5} \crectangle{F}{0.8}{0.8}{0,1.5}
\incomewire[0.7]{F}{0}{ } \outcomewire[0.7]{F}{0}{ }
\jointbnoarrow[left]{E}{0}{F}{0}
\end{Compose}
}

\newcommand{\flippedTcase} {
\begin{Compose}{0}{0}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{E}{0.8}{0.8}{0,-1.5} \crectangle{F}{0.8}{0.8}{0,1.5}
\incomewire[0.7]{E}{0}{ } \outcomewire[0.7]{E}{0}{ }
\jointbnoarrow[left]{E}{0}{F}{0}
\end{Compose}
}


% \Funitalxyab[shift]{1}{1}{1}{0} a 1 turns on the corresponding leg. shift moves up by shift.
\newcommand{\Funitalxyab}[5][0]{
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#2}{\crectangle{CL}{0.8}{0.8}{-4.5,0}\csymbol{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangle{A}{0.8}{0.8}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~\equiv ~
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{2,0} \csymbol{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose}
}

\newcommand{\Bunitalyxba}[5][0]{
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangle{CR}{0.8}{0.8}{4.5,0} \csymbol{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangle{B}{0.8}{0.8}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~\equiv ~
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{-2,0} \csymbol{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}

\newcommand{\Funitalinequalxyab}[5][0]{
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#2}{\crectangle{CL}{0.8}{0.8}{-4.5,0}\csymbol{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangle{A}{0.8}{0.8}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~\underset{T}{\leqq} ~
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{2,0} \csymbol{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose}
}

\newcommand{\Bunitalinequalyxba}[5][0]{
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangle{CR}{0.8}{0.8}{4.5,0} \csymbol{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangle{B}{0.8}{0.8}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~\underset{T}{\leqq} ~
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{-2,0} \csymbol{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}


\newcommand{\FunitalboldxyabB}[6][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangle{C}{1.3}{1.3}{0,0} \csymbol{#6}
\ifone{#2}{\crectangle{CL}{0.8}{0.8}{-4.5,0}\csymbol{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt[0,5]{y}  }
\ifone{#4}{\crectangle{A}{0.8}{0.8}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~\equiv ~
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{2,0} \csymbol{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt[0,5]{y} }
\end{Compose}
}

\newcommand{\BunitalboldyxbaB}[6][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangle{C}{1.3}{1.3}{0,0} \csymbol{#6}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangle{CR}{0.8}{0.8}{4.5,0} \csymbol{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangle{B}{0.8}{0.8}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~\equiv ~
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{-2,0} \csymbol{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}

%%%



\newcommand{\FunitalgeqTFxyab}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangle{C}{1.3}{1.3}{0,0} \csymbolfourth{\overline{\mathsf{B}}}
\ifone{#2}{\crectangle{CL}{0.8}{0.8}{-4.5,0}\csymbol{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt[0,5]{y}  }
\ifone{#4}{\crectangle{A}{0.8}{0.8}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~\underset{\overline{T}}{\leq}~
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{2,0} \csymbol{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt[0,5]{y} }
\end{Compose}
}

\newcommand{\FunitalstargeqTFxyab}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangle{C}{1.3}{1.3}{0,0} \csymbolfourth{\overline{\mathsf{B}}_{*}}
\ifone{#2}{\crectangle{CL}{0.8}{0.8}{-4.5,0}\csymbol{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt[0,5]{y}  }
\ifone{#4}{\crectangle{A}{0.8}{0.8}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~\underset{\overline{T}}{\leq}~
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{2,0} \csymbol{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt[0,5]{y} }
\end{Compose}
}

\newcommand{\BunitalgeqTFyxba}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangle{C}{1.3}{1.3}{0,0} \csymbolfourth{\overline{\mathsf{B}}}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangle{CR}{0.8}{0.8}{4.5,0} \csymbol{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangle{B}{0.8}{0.8}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~\underset{\overline{T}}{\leq}~
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{-2,0} \csymbol{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}

\newcommand{\FunitalgeqTBxyab}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangle{C}{1.3}{1.3}{0,0} \csymbolfourth{\underline{\mathsf{B}}}
\ifone{#2}{\crectangle{CL}{0.8}{0.8}{-4.5,0}\csymbol{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt[0,5]{y}  }
\ifone{#4}{\crectangle{A}{0.8}{0.8}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~\underset{\underline{T}}{\leqq}~
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{2,0} \csymbol{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt[0,5]{y} }
\end{Compose}
}

\newcommand{\BunitalgeqTByxba}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangle{C}{1.3}{1.3}{0,0} \csymbolfourth{\underline{\mathsf{B}}}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangle{CR}{0.8}{0.8}{4.5,0} \csymbol{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangle{B}{0.8}{0.8}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~\underset{\underline{T}}{\leqq}~
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{-2,0} \csymbol{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}

\newcommand{\BunitalstargeqTByxba}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangle{C}{1.3}{1.3}{0,0} \csymbolfourth{\underline{\mathsf{B}}^{*}}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangle{CR}{0.8}{0.8}{4.5,0} \csymbol{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangle{B}{0.8}{0.8}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~\underset{\underline{T}}{\leqq}~
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{-2,0} \csymbol{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}

\newcommand{\Funitalboldxyab}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangle{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#2}{\crectangle{CL}{0.8}{0.8}{-4.5,0}\csymbol{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangle{A}{0.8}{0.8}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~\equiv ~
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb} \setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{2,0} \csymbol{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose}
}

\newcommand{\Bunitalboldyxba}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangle{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangle{CR}{0.8}{0.8}{4.5,0} \csymbol{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangle{B}{0.8}{0.8}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~\equiv ~
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{-2,0} \csymbol{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}

%%%% construction here

\newcommand{\Funitalboldinequalxyab}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangle{C}{1.3}{1.3}{0,0} \csymbolnorm{\mathsf{B}}
\ifone{#2}{\crectangle{CL}{0.8}{0.8}{-4.5,0}\csymbol{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangle{A}{0.8}{0.8}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~\underset{T}{\leqq} ~
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb} \setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{2,0} \csymbol{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose}
}

\newcommand{\Bunitalboldinequalyxba}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangle{C}{1.3}{1.3}{0,0} \csymbolnorm{\mathsf{B}}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangle{CR}{0.8}{0.8}{4.5,0} \csymbol{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangle{B}{0.8}{0.8}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~\underset{T}{\leqq} ~
\begin{Compose}{0}{#1}\setdefaultfont{\mathsfb}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{-2,0} \csymbol{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}




% \Funitalxyab[shift]{1}{1}{1}{0} a 1 turns on the corresponding leg. shift moves up by shift.
\newcommand{\Funitaldoublexyab}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#2}{\crectangledouble{CL}{0.9}{0.9}{-4.5,0}\csymbolfourth{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangledouble{A}{0.9}{0.9}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~= ~
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{-0.3,0} \csymbol{I} \thispoint{BR}{-0.3,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{2,0} \csymbolfourth{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose}
}

\newcommand{\Bunitaldoubleyxba}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangledouble{CR}{0.9}{0.9}{4.5,0} \csymbolfourth{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangledouble{B}{0.9}{0.9}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~= ~
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{0.3,0} \csymbol{I} \thispoint{BR}{0.3,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{-2,0} \csymbolfourth{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}


\newcommand{\Funitaldoubleboldxyab}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathopbold}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}\setfourthfont{\boldsymbol}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#2}{\crectangledouble{CL}{0.9}{0.9}{-4.5,0}\csymbolfourth{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangledouble{A}{0.9}{0.9}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~= ~
\begin{Compose}{0}{#1}\setdefaultfont{\mathopbold}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}\setfourthfont{\boldsymbol}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{-0.3,0} \csymbol{I} \thispoint{BR}{-0.3,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{2,0} \csymbolfourth{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose}
}

\newcommand{\Bunitaldoubleboldyxba}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathopbold}\setsecondfont{\mathtt}\setthirdfont{\mathsfs} \setfourthfont{\boldsymbol}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangledouble{CR}{0.9}{0.9}{4.5,0} \csymbolfourth{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangledouble{B}{0.9}{0.9}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~= ~
\begin{Compose}{0}{#1}\setdefaultfont{\mathopbold}\setsecondfont{\mathtt}\setthirdfont{\mathsfs} \setfourthfont{\boldsymbol}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{0.3,0} \csymbol{I} \thispoint{BR}{0.3,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{-2,0} \csymbolfourth{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}


%
\newcommand{\FunitaldoubleboldxyabB}[6][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathopbold}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}\setfourthfont{\boldsymbol}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{#6}
\ifone{#2}{\crectangledouble{CL}{0.9}{0.9}{-4.5,0}\csymbolfourth{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangledouble{A}{0.9}{0.9}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~= ~
\begin{Compose}{0}{#1}\setdefaultfont{\mathopbold}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}\setfourthfont{\boldsymbol}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{-0.3,0} \csymbol{I} \thispoint{BR}{-0.3,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{2,0} \csymbolfourth{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose}
}

\newcommand{\BunitaldoubleboldyxbaB}[6][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\mathopbold}\setsecondfont{\mathtt}\setthirdfont{\mathsfs} \setfourthfont{\boldsymbol}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{#6}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangledouble{CR}{0.9}{0.9}{4.5,0} \csymbolfourth{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangledouble{B}{0.9}{0.9}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~= ~
\begin{Compose}{0}{#1}\setdefaultfont{\mathopbold}\setsecondfont{\mathtt}\setthirdfont{\mathsfs} \setfourthfont{\boldsymbol}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{0.3,0} \csymbol{I} \thispoint{BR}{0.3,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{-2,0} \csymbolfourth{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}


% \FunitalxyabScale[shift]{1}{1}{1}{0}{0.75} a 1 turns on the corresponding leg. shift moves up by shift. {0.75} scales by this factor.
\newcommand{\FunitalxyabScale}[6][0]{
\scalebox{#6}{
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#2}{\crectangle{CL}{0.8}{0.8}{-4.5,0}\csymbol{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangle{A}{0.8}{0.8}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose} }
~\equiv ~
\scalebox{#6}{
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{2,0} \csymbolfourth{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose} }
}

\newcommand{\BunitalyxbaScale}[6][0]{
\scalebox{#6}{
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangle{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangle{CR}{0.8}{0.8}{4.5,0} \csymbol{R} \joinrlnoarrow{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangle{B}{0.8}{0.8}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose} }
~\equiv ~
\scalebox{#6}{
\begin{Compose}{0}{#1}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\ifone{#5}{\crectangle{B}{0.8}{0.8}{0,0} \csymbol{I} \thispoint{BR}{0,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangle{BD}{0.8}{0.8}{-2,0} \csymbol{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose} }
}

% \Funitalxyab[shift]{1}{1}{1}{0}{0.75} a 1 turns on the corresponding leg. shift moves up by shift.
\newcommand{\FunitaldoublexyabScale}[6][0]{
\scalebox{#6}{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#2}{\crectangledouble{CL}{0.9}{0.9}{-4.5,0}\csymbolfourth{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangledouble{A}{0.9}{0.9}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose} }
~= ~
\scalebox{#6}{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{-0.3,0} \csymbol{I} \thispoint{BR}{-0.3,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{2,0} \csymbolfourth{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose} }
}

\newcommand{\BunitaldoubleyxbaScale}[6][0]{
\scalebox{#6}{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangledouble{CR}{0.9}{0.9}{4.5,0} \csymbolfourth{R} \joinrlnoarrow{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangledouble{B}{0.9}{0.9}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose} }
~= ~
\scalebox{#6}{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfb}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{0.3,0} \csymbol{I} \thispoint{BR}{0.3,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{-2,0} \csymbolfourth{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose} }
}

%double with leq


\newcommand{\Funitaldoubleleqxyab}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#2}{\crectangledouble{CL}{0.9}{0.9}{-4.5,0}\csymbolfourth{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangledouble{A}{0.9}{0.9}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~\underset{T}{\leq} ~
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{-0.3,0} \csymbol{I} \thispoint{BR}{-0.3,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{2,0} \csymbolfourth{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose}
}

\newcommand{\Bunitaldoubleleqyxba}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangledouble{CR}{0.9}{0.9}{4.5,0} \csymbolfourth{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangledouble{B}{0.9}{0.9}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~ \underset{T}{\leq} ~
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{0.3,0} \csymbol{I} \thispoint{BR}{0.3,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{-2,0} \csymbolfourth{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}

%% double with trianglemarkings note #6 is +1 or whatever for position of triangle mark

\newcommand{\Funitaldoubletrileqxyab}[6][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangledmarktriangle[#6]{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#2}{\crectangledouble{CL}{0.9}{0.9}{-4.5,0}\csymbolfourth{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangledouble{A}{0.9}{0.9}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~\underset{T}{\leq} ~
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{-0.3,0} \csymbol{I} \thispoint{BR}{-0.3,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{2,0} \csymbolfourth{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose}
}

\newcommand{\Bunitaldoubletrileqyxba}[6][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangledmarktriangle[#6]{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangledouble{CR}{0.9}{0.9}{4.5,0} \csymbolfourth{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangledouble{B}{0.9}{0.9}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~ \underset{T}{\leq} ~
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{0.3,0} \csymbol{I} \thispoint{BR}{0.3,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{-2,0} \csymbolfourth{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}


%% double with trianglemarkings note #6 is +1 or whatever for position of triangle mark

\newcommand{\Funitaldoubletrileqyxbainverted}[6][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangledmarktriangle[#6]{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#2}{\crectangledouble{CL}{0.9}{0.9}{-4.5,0}\csymbolfourth{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{y} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{x}  }
\ifone{#4}{\crectangledouble{A}{0.9}{0.9}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{b}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{a} }
\end{Compose}
~\underset{T}{\leq} ~
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{-0.3,0} \csymbol{I} \thispoint{BR}{-0.3,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{a} }
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{2,0} \csymbolfourth{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}

\newcommand{\Bunitaldoubletrileqxyabinverted}[6][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangledmarktriangle[#6]{C}{1.3}{1.3}{0,0} \csymbol{B}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{y} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangledouble{CR}{0.9}{0.9}{4.5,0} \csymbolfourth{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{x} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{b} }
\ifone{#4}{\crectangledouble{B}{0.9}{0.9}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{a} }
\end{Compose}
~ \underset{T}{\leq} ~
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{0.3,0} \csymbol{I} \thispoint{BR}{0.3,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{b}}
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{-2,0} \csymbolfourth{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose}
}


%% TF inequal

\newcommand{\FunitaldoubleleqTFxyab}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{\overline{B}}
\ifone{#2}{\crectangledouble{CL}{0.9}{0.9}{-4.5,0}\csymbolfourth{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangledouble{A}{0.9}{0.9}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~\underset{\oveline{T}}{\leq} ~
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{-0.3,0} \csymbol{I} \thispoint{BR}{-0.3,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{2,0} \csymbolfourth{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose}
}

\newcommand{\BunitaldoubleleTFqyxba}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{\overline{B}}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangledouble{CR}{0.9}{0.9}{4.5,0} \csymbolfourth{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangledouble{B}{0.9}{0.9}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~ \underset{\overline{T}}{\leq} ~
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{0.3,0} \csymbol{I} \thispoint{BR}{0.3,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{-2,0} \csymbolfourth{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}

% TB case

\newcommand{\FunitaldoubleleqTBxyab}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{\underline{B}}
\ifone{#2}{\crectangledouble{CL}{0.9}{0.9}{-4.5,0}\csymbolfourth{R} \joinlrnoarrowthick{C}{0}{CL}{0} \csymbolalt{x} }
\ifone{#3}{\thispoint{CR}{4,0} \joinrlnoarrowthick[above]{C}{0}{CR}{0} \csymbolalt{y}  }
\ifone{#4}{\crectangledouble{A}{0.9}{0.9}{0,-4.5} \csymbol{I} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a}  }
\ifone{#5}{\thispoint{B}{0,3.5} \jointbnoarrow[left]{C}{0}{B}{0} \csymbolthird{b} }
\end{Compose}
~\underset{\undeline{T}}{\leq} ~
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{-0.3,0} \csymbol{I} \thispoint{BR}{-0.3,3.5} \jointbnoarrow[right]{B}{0}{BR}{0}\csymbolthird{b} }
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{2,0} \csymbolfourth{R} \thispoint{BRD}{4.5,0} \joinrlnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{y} }
\end{Compose}
}

\newcommand{\BunitaldoubleleTBqyxba}[5][0]{
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\crectangledouble{C}{1.3}{1.3}{0,0} \csymbol{\underline{B}}
\ifone{#3}{\thispoint{CL}{-4,0} \csymbolalt[-20,0]{x} \joinlrnoarrowthick{C}{0}{CL}{0} }
\ifone{#2}{\crectangledouble{CR}{0.9}{0.9}{4.5,0} \csymbolfourth{R} \joinrlnoarrowthick{C}{0}{CR}{0} \csymbolalt[0,5]{y} }
\ifone{#5}{\thispoint{A}{0,-3.5} \jointbnoarrow[left]{A}{0}{C}{0} \csymbolthird{a} }
\ifone{#4}{\crectangledouble{B}{0.9}{0.9}{0,4.5} \csymbol{I} \jointbnoarrow[left]{C}{0}{B}{0}\csymbolthird{b} }
\end{Compose}
~ \underset{\underline{T}}{\leq} ~
\begin{Compose}{0}{#1}\setdefaultfont{\hat}\setsecondfont{\mathtt}\setthirdfont{\mathsfs}
\ifone{#5}{\crectangledouble{B}{0.9}{0.9}{0.3,0} \csymbol{I} \thispoint{BR}{0.3,-3.5} \joinbtnoarrow[left]{B}{0}{BR}{0} \csymbolthird{a}}
\ifone{#3}{\crectangledouble{BD}{0.9}{0.9}{-2,0} \csymbolfourth{R} \thispoint{BRD}{-4.5,0} \joinlrnoarrowthick[above]{BD}{0}{BRD}{0}\csymbolalt{x} }
\end{Compose}
}
